<!DOCTYPE html><html><head>
      <title>数字图像处理</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\LingJiaXiaoHu\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="前言">前言 </h1>
<h2 id="1-什么是数字图像">1、什么是数字图像 </h2>
<p>一幅图像可以定义为一个二维函数f(x,y)，其中x和y是空间（平面）坐标，而f在任意坐标(x,y)处的幅度称为图像在该点处的亮度或灰度。当x、y和f的幅度值都是有限的离散值时，称该图像为数字图像。</p>
<p>数字图像由有限数量的元素组成，每个元素都有一个特定的位置和数值。这些元素称为图画元素，图像元素或像素。</p>
<h2 id="2-数字图像的表示">2、数字图像的表示 </h2>
<p>由数值f(x,y)组成的一个阵列（矩阵）表示，可以用公式将一个M×N矩阵表示为</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187200147-6dc4f735-996a-4040-a575-2314d4485d6b.png" alt=""></p>
<p>右边实数矩阵表示数字图像，每个元素称为像素。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187235177-759a6898-bd3a-4dd4-89c3-9902ac262923.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187241886-6e3431ad-5d2f-4222-bbe9-a7ba7b2cb550.png" alt=""></p>
<p>图像数字化要求对M值、N值和离散灰度级数L进行判定。对于M和N,除必须取正整数外并无其他限制。然而，出于存储和量化硬件的考虑，灰度级数通常取2的整数次幂，即</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187289841-0aa90f8b-3e48-4609-995b-cae148ef9a63.png" alt=""></p>
<p>式中，k是整数。假设离散灰度级是等间隔的，且它们是区间[0,L-1]内的整数。</p>
<h2 id="特别篇如何访问像素">特别篇：如何访问像素 </h2>
<pre data-role="codeBlock" data-info="plain" class="language-plain plain"><code>访问（j,i）处像素
以8位（0~255）灰度图像和BGR彩色图像为例，用at可以访问图像像素：
//灰度图像
image.at&lt;uchar&gt;(j, i) //j为行数，i为列数
//BGR彩色图像   Vec3f或Vec3b
image.at&lt;Vec3b&gt;(j, i)[0] //B分量
image.at&lt;Vec3b&gt;(j, i)[1] //G分量
image.at&lt;Vec3b&gt;(j, i)[2] //R分量

</code></pre><p>灰度级越大，图像的颜色越偏向白色；灰度级越小，图像的颜色越偏向黑色。</p>
<h1 id="基本操作">基本操作 </h1>
<h2 id="1图像读取与显示">1.图像读取与显示 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span> <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>			
	<span class="token comment">//D:\\新桌面\\漫画人物壁纸\\1648229235164_1648228777745.jpg</span>
	<span class="token comment">//string path = R"(A005.png)";	//图片的路径名 R"(相对路径 文件粘贴在主文件目录下为文件名 或 绝对路径\\ 或 /)"</span>
	string path <span class="token operator">=</span> <span class="token string">"A005.png"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//将图片加载后赋值到图像变量img中</span>

	<span class="token comment">//Mat类是OpenCV库中用于表示图像或矩阵的一个核心数据结构，imread 函数在未能正确加载图片时返回的是一个空的 Mat 对象，因此你应该检查 img.empty() 而不是 path.empty()</span>
	<span class="token comment">//检查文件是否打开 没打开时执行打印语句</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"file not loaded"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> 
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//结束程序运行</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个窗口来显示图像img</span>
	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不断刷新图像</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/*
1、waitKey()函数的功能是不断刷新图像，频率为delay，单位是ms。
2、delay为0时，则会一直显示这一帧。
3、delay不为0时，则在显示完一帧图像后程序等待“delay"ms再显示下一帧图像。
*/</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256206562-80321c57-90c4-4615-981e-57eb36c95d25.png" alt=""></p>
<h2 id="2图像预处理">2.图像预处理 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>
<span class="token comment">//#include&lt;vector&gt;    //std::vector是一个动态数组，可以自动调整大小</span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	string path <span class="token operator">=</span> <span class="token string">"A005.png"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

	Mat imgGray<span class="token punctuation">,</span> imgBlur<span class="token punctuation">,</span> imgCanny<span class="token punctuation">,</span> imgDil<span class="token punctuation">,</span> imgErode<span class="token punctuation">;</span>  <span class="token comment">//创建空的数据矩阵</span>

	<span class="token comment">//将照片转换为灰度</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> imgGray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//高斯模糊  (输入图像，输出图像，高斯内核（宽，高）【可以不同，必正奇数】，x反向偏差，y方向偏差（若y是0，则函数会自动使y与x相同，若x和y都是0，xy将由高斯内核的两个值计算而来））</span>
	<span class="token function">GaussianBlur</span><span class="token punctuation">(</span>imgGray<span class="token punctuation">,</span> imgBlur<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//Canny边缘检测器  一般在使用Canny边缘检测器之前会做一些模糊处理  第3和第4个参数分别代表底阈值和高阈值，其中底阈值常取高阈值的1/2或1/3</span>
	<span class="token function">Canny</span><span class="token punctuation">(</span>imgBlur<span class="token punctuation">,</span> imgCanny<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//创建一个可以使用膨胀的内核</span>
	Mat kernel <span class="token operator">=</span> <span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//图像膨胀</span>
	<span class="token function">dilate</span><span class="token punctuation">(</span>imgCanny<span class="token punctuation">,</span> imgDil<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//图像侵蚀</span>
	<span class="token function">erode</span><span class="token punctuation">(</span>imgDil<span class="token punctuation">,</span> imgErode<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token comment">//结果呈现  WINDOW_FREERATIO和WINDOW_NORMAL是OpenCV中用于窗口显示的两种模式</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image Gray"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Gray"</span><span class="token punctuation">,</span> imgGray<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image Blur"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Blur"</span><span class="token punctuation">,</span> imgBlur<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image Canny"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Canny"</span><span class="token punctuation">,</span> imgCanny<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image Dilation"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Dilation"</span><span class="token punctuation">,</span> imgDil<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Image Erode"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Erode"</span><span class="token punctuation">,</span> imgErode<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256585500-301fd310-cf13-4b5f-bcc2-c2422dc13280.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256605156-02c09bfb-841e-47ee-b781-87fedecf156b.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256620448-07a0d51f-a329-4b4f-a809-770694220f5b.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256636412-25133c70-bcd3-47fd-a159-a3818a05acad.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256649333-01e00c48-fce5-4e95-8b85-cbab9c19c2d8.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256664370-d31347b5-a8a4-48a7-9440-ad26b2d70dd3.png" alt=""></p>
<h2 id="3图像裁剪">3.图像裁剪 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	string path <span class="token operator">=</span> <span class="token string">"A005.png"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat imgResize<span class="token punctuation">,</span> imgCrop<span class="token punctuation">;</span>

	<span class="token comment">//调整图像大小</span>
	cout <span class="token operator">&lt;&lt;</span> img<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token comment">//查看原图像的大小</span>
	<span class="token comment">//resize(img, imgResize, Size(640, 480));   //按自定义的宽度与高度缩放</span>
	<span class="token function">resize</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> imgResize<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//按比例缩放</span>

	<span class="token comment">//图像裁剪</span>
	Rect <span class="token function">roi</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//前面两个参数为距左上原点的x方向与y方向的距离，后两个参数为延伸的x，y长度</span>
	imgCrop <span class="token operator">=</span> <span class="token function">img</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Resize"</span><span class="token punctuation">,</span> imgResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Crop"</span><span class="token punctuation">,</span> imgCrop<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725272290224-69267621-fd17-4c50-a7bd-43dfe3c82ce5.png" alt=""></p>
<h2 id="4图像堆叠拼接">4.图像堆叠拼接 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">/*
#include &lt;iostream&gt;
#include &lt;opencv2/opencv.hpp&gt;
#include &lt;vector&gt;

int main()
{
	//图片深度要一样
	cv::Mat image = cv::imread("B1.png");
	cv::Mat image2 = cv::imread("B2.png");

	cv::Mat output;
	cv::hconcat(image, image2, output);

	// 创建一个窗口并显示图像    WINDOW_FREERATIO和WINDOW_NORMAL是OpenCV中用于窗口显示的两种模式
	cv::namedWindow("hcontact", cv::WindowFlags::WINDOW_NORMAL);

	cv::imshow("hcontact", output);

	cv::waitKey(0);

	return 0;
}
*/</span>
</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//把多张图片水平拼接</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">0</span> </span></span>
    <span class="token comment">//不知道为啥拼接是黑的看不到图片</span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"tubiao/setting.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat image2 <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"tubiao/save.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat image3 <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"tubiao/picture.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"B1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat image2 <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"B1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat image3 <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"B1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>cv<span class="token double-colon punctuation">::</span>Mat<span class="token operator">&gt;</span> images<span class="token punctuation">;</span>
    images<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    images<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    images<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image3<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token double-colon punctuation">::</span>Mat output2<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">hconcat</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> output2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建一个窗口并显示图像    WINDOW_FREERATIO和WINDOW_NORMAL是OpenCV中用于窗口显示的两种模式</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"hcontact2"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>WindowFlags<span class="token double-colon punctuation">::</span>WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"hcontact2"</span><span class="token punctuation">,</span> output2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725272612671-1f814320-92c9-4d5e-ad82-6ed6061cafd6.png" alt=""></p>
<h2 id="5绘制形状和添加文本">5.绘制形状和添加文本 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token comment">//绘制形状和添加文本</span>
<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//创建空白图像  img(宽度，高度，BGR彩色图像，初始化每个像素的值（白色））  黑色（0,0,0）</span>
	Mat <span class="token function">img</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//绘制圆形 线条宽度为10</span>
	<span class="token function">circle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token comment">//circle(img, Point(256, 256), 155, Scalar(0, 69, 255), FILLED，10);</span>
	<span class="token comment">//函数参数分别是 输出到图像img，圆心，半径，颜色，厚度（FILLED 表示填满）</span>

	<span class="token comment">//绘制矩形</span>
	<span class="token function">rectangle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">382</span><span class="token punctuation">,</span> <span class="token number">286</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FILLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//函数参数分别是 输出到图像img，矩形左上角顶点坐标，右下角顶点坐标，颜色，厚度</span>

	<span class="token comment">//绘制线段</span>
	<span class="token function">line</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">296</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">382</span><span class="token punctuation">,</span> <span class="token number">296</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//函数参数分别是 输出到图像img，两个端点坐标，颜色，厚度</span>

	<span class="token comment">//添加文本  OpenCV支持多种Hershey字体，例如FONT_HERSHEY_SIMPLEX, FONT_HERSHEY_PLAIN, FONT_HERSHEY_DUPLEX等。</span>
	<span class="token function">putText</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">"Murtaza's Workshop"</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">262</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FONT_HERSHEY_DUPLEX<span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//函数参数分别是 输出到图像img，文本内容，左下角起点，字体，大小，颜色，厚度</span>

	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725256992321-2f4b51cb-af17-42c0-8a1d-20300be30261.png" alt=""></p>
<h2 id="6透视变换">6.透视变换 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> w <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">,</span> h <span class="token operator">=</span> <span class="token number">350</span><span class="token punctuation">;</span>
Mat matrix<span class="token punctuation">,</span> imgWarp<span class="token punctuation">;</span>   <span class="token comment">//matrix将用于存储透视变换矩阵，imgWarp将用于存储变换后的图像。</span>
<span class="token comment">// 透视变换</span>
<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	string path <span class="token operator">=</span> <span class="token string">"card.png"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//包含4个Point2f类型元素的数组，表示源图像上的四个点。 Point2f是一个二维点，由两个浮点数表示，这里是四个点的坐标</span>
	<span class="token comment">//Point2f src[4] = { {529,142},{771,190},{405,395},{674,457} };</span>


	<span class="token comment">/*
	* 可以利用Halcon放大器标点读值 像素的位置
*   Q的坐标
*  （322,9）          （276,279）
*  （628,35）         （567,342）

*   J的坐标
*   （106,715）   （83,953）
*   （352,781）   （327,1050）

*   9的坐标
*   (383,677)      (434,957)
*   (700,586)      (753,912)
	*/</span>


	<span class="token comment">//用Halcon  放大镜找出Q的四点位置（行，列） （322,9）          （276,279）     （628, 35）         （567, 342）</span>
	<span class="token comment">//Point2f src[4] = { {9,322},{279,276},{35,628},{342,567} };</span>
	<span class="token comment">//J的四点位置</span>
	Point2f src<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">715</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">953</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">781</span><span class="token punctuation">,</span><span class="token number">352</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">1050</span><span class="token punctuation">,</span><span class="token number">327</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//9的四点位置</span>
	<span class="token comment">//Point2f src[4] = { {677,383},{957,434},{586,700},{912,753} };</span>

	Point2f dst<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span><span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>w<span class="token punctuation">,</span><span class="token number">0.0f</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">0.0f</span><span class="token punctuation">,</span>h<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>w<span class="token punctuation">,</span>h<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">//这四个点定义了透视变换后新图像的坐标位置</span>

	matrix <span class="token operator">=</span> <span class="token function">getPerspectiveTransform</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取原图像四边形到目标图像四边形的透视变换矩阵</span>
	<span class="token comment">//src为源图像四边形顶点坐标，dst为目标图像对应的四边形顶点坐标</span>
	<span class="token function">warpPerspective</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> imgWarp<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//参数分别为 输入图像，输出图像，透视变换矩阵，图像大小（宽，高）</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">circle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> src<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FILLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token comment">//在原图像中标记目标顶点</span>

	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Warp"</span><span class="token punctuation">,</span> imgWarp<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725272394170-eb9622a1-95c3-45f1-adfe-b889d93d6fc6.png" alt=""></p>
<h2 id="7颜色变换">7.颜色变换 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

Mat imgHSV<span class="token punctuation">,</span> mask<span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> hmin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> smin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> vmin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> hmax <span class="token operator">=</span> <span class="token number">179</span><span class="token punctuation">,</span> smax <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">,</span> vmax <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	string path <span class="token operator">=</span> <span class="token string">"海绵宝宝01.jpg"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//色彩空间转换函数-cvtColor</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> imgHSV<span class="token punctuation">,</span> COLOR_BGR2HSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//HSV颜色空间  H（色调）：0~180  S（饱和度）：0~255  V（亮度）：0~255</span>

	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Trackbars的窗口，大小为640*200</span>
	<span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"Hue Min"</span><span class="token punctuation">,</span> <span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hmin<span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"Hue Max"</span><span class="token punctuation">,</span> <span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hmax<span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"Sat Min"</span><span class="token punctuation">,</span> <span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>smin<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"Sat Max"</span><span class="token punctuation">,</span> <span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>smax<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"Val Min"</span><span class="token punctuation">,</span> <span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vmin<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">createTrackbar</span><span class="token punctuation">(</span><span class="token string">"Val Max"</span><span class="token punctuation">,</span> <span class="token string">"Trackbars"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vmax<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//createTrackbar函数是创建轨迹条，</span>
	<span class="token comment">//4个参数分别是 轨迹条名字，输出的窗口，一个指向整数的指针来表示当前的值，可到达的最大值</span>

	<span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//检测我们所要的颜色 设置一个遮罩 在范围内的颜色</span>
		Scalar <span class="token function">lower</span><span class="token punctuation">(</span>hmin<span class="token punctuation">,</span> smin<span class="token punctuation">,</span> vmin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HSV范围最低值</span>
		Scalar <span class="token function">upper</span><span class="token punctuation">(</span>hmax<span class="token punctuation">,</span> smax<span class="token punctuation">,</span> vmax<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//HSV范围最高值</span>
		<span class="token function">inRange</span><span class="token punctuation">(</span>imgHSV<span class="token punctuation">,</span> lower<span class="token punctuation">,</span> upper<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输入，低值，高值，输出</span>
		<span class="token comment">//inRange是将在阈值区间内的像素值设置为白色（255），而不在阈值区间内的像素值设置为黑色（0）</span>

		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image HSV"</span><span class="token punctuation">,</span> imgHSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image Mask"</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725257251827-b1caa52c-7086-48d4-8225-7ea713424a80.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725257273511-528a5cf4-218a-4fc7-ad37-7b787a59aed4.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725257449483-87a486f7-8fcc-4422-9ec9-386ef99d59ae.png" alt=""></p>
<h2 id="8形状检测和轮廓检测">8.形状检测和轮廓检测 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

Mat imgGray<span class="token punctuation">,</span> imgBlur<span class="token punctuation">,</span> imgCanny<span class="token punctuation">,</span> imgDil<span class="token punctuation">,</span> imgErode<span class="token punctuation">;</span>

<span class="token comment">//定义一个轮廓处理函数  其目的是从经过预处理的二值图像中提取轮廓，并根据轮廓的特性对其进行分类和标注</span>
<span class="token keyword keyword-void">void</span> <span class="token function">getContours</span><span class="token punctuation">(</span>Mat imgDil<span class="token punctuation">,</span> Mat img<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">//定义了一个二维向量contours,用于存储提取的轮廓信息。每个内部向量表示一个轮廓，而每个轮廓是由一系列的Point组成的。</span>
	vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;&gt;</span> contours<span class="token punctuation">;</span> <span class="token comment">//例如{ {Point(20,30),Point(50,60)},{}, {}} 三个轮廓，第一个轮廓有两个点，第二、三个为空</span>
	<span class="token comment">//定义了一个向量hierarchy，它包含了多个Vec4i类型的元素。Vec4i是一个包含4个整数的向量。这个hierarchy向量用于存储轮廓之间的层次信息，例如哪个轮廓是外部轮廓，哪个是内部轮廓</span>
	vector<span class="token operator">&lt;</span>Vec4i<span class="token operator">&gt;</span>hierarchy<span class="token punctuation">;</span> 

	<span class="token comment">//使用OpenCV的findContours函数从膨胀后的图像中提取轮廓。RETR_EXTERNAL表示只检测最外层轮廓，CHAIN_APPROX_SIMPLE是对轮廓进行压缩，只保留端点。</span>
	<span class="token function">findContours</span><span class="token punctuation">(</span>imgDil<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> hierarchy<span class="token punctuation">,</span> RETR_EXTERNAL<span class="token punctuation">,</span> CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//使用drawContours函数在图像img上绘制所有的检测到的轮廓。轮廓将以品红色（由Scalar(255, 0, 255)指定）和2像素的厚度绘制</span>
	<span class="token comment">//drawContours(img, contours, -1, Scalar(255, 0, 255), 2);</span>
	
	<span class="token comment">//定义了一个新的二维向量conPoly，其大小与检测到的轮廓数量相同。这个向量将用于存储每个轮廓的近似多边形</span>
	vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;&gt;</span><span class="token function">conPoly</span><span class="token punctuation">(</span>contours<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//定义了一个新的向量boundRect，其大小与检测到的轮廓数量相同。这个向量将用于存储每个轮廓的边界矩形（bounding rectangle）</span>
	vector<span class="token operator">&lt;</span>Rect<span class="token operator">&gt;</span> <span class="token function">boundRect</span><span class="token punctuation">(</span>contours<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> contours<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//计算轮廓的面积，并根据面积进行过滤，去除可能的噪点</span>
		<span class="token keyword keyword-int">int</span> area <span class="token operator">=</span> <span class="token function">contourArea</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> area <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token comment">//需要正确过滤的面积（过滤噪点）</span>

		<span class="token comment">//定义一个字符串变量objectType，用于存储检测到的形状的名称</span>
		string objectType<span class="token punctuation">;</span>
		<span class="token comment">//判断形状 根据轮廓的面积和顶点数，对形状进行分类（如三角形、矩形、正方形和圆形）。对于矩形和正方形，还计算长宽比以确定其确切的形状。</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>area <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">//过滤面积较小的轮廓，这些轮廓可能代表噪声或不重要的细节</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-float">float</span> peri <span class="token operator">=</span> <span class="token function">arcLength</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算当前轮廓的周长，并将结果存储在变量peri中</span>
			<span class="token comment">//找到当前轮廓的一个近似多边形，这个多边形将用于后续的形状分类。多边形的精度由参数0.02 * peri控制</span>
			<span class="token function">approxPolyDP</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> conPoly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.02</span> <span class="token operator">*</span> peri<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			cout <span class="token operator">&lt;&lt;</span> conPoly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">//输出近似多边形的顶点数，这有助于了解多边形的大致形状</span>
			boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">boundingRect</span><span class="token punctuation">(</span>conPoly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计算近似多边形的边界矩形，并将其存储在boundRect向量中</span>

			<span class="token keyword keyword-int">int</span> objCor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>conPoly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将近似多边形的顶点数转换为整数，并存储在变量objCor中</span>

			<span class="token comment">//如果多边形有3个顶点，则将其分类为三角形，并将objectType设置为"Tri"</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>objCor <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> objectType <span class="token operator">=</span> <span class="token string">"Tri"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token comment">//如果多边形有4个顶点，则进一步检查其长宽比以确定它是正方形还是矩形</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>objCor <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

				<span class="token keyword keyword-float">float</span> aspRatio <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
				cout <span class="token operator">&lt;&lt;</span> aspRatio <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>aspRatio <span class="token operator">&gt;</span> <span class="token number">0.95</span> <span class="token operator">&amp;&amp;</span> aspRatio <span class="token operator">&lt;</span> <span class="token number">1.05</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> objectType <span class="token operator">=</span> <span class="token string">"Square"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
				<span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
					objectType <span class="token operator">=</span> <span class="token string">"Rect"</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//如果多边形有超过4个顶点，则将其分类为圆形，并将objectType设置为"Circle"</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>objCor <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> objectType <span class="token operator">=</span> <span class="token string">"Circle"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

			<span class="token comment">//使用drawContours函数在原始图像img上绘制轮廓。它绘制的是conPoly中的第i个轮廓（即当前正在处理的轮廓）。</span>
			<span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> conPoly<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//描绘计数轮廓 轮廓会以品红色（RGB值为(255, 0, 255)）和2像素的厚度进行绘制</span>
			<span class="token comment">//使用rectangle函数在原始图像img上绘制一个矩形，该矩形是围绕当前正在处理的轮廓的边界矩形。boundRect[i].tl()返回边界矩形的左上角点，而boundRect[i].br()返回右下角点。</span>
			<span class="token function">rectangle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">br</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绘制边界矩形 矩形会以绿色（RGB值为(0, 255, 0)）和5像素的厚度进行绘制</span>

			<span class="token comment">//打印图形的名字  在原始图像上的边界矩形的上方标注形状的名称（如"Tri"、"Square"、"Rect"或"Circle"） </span>
			<span class="token comment">// 文本会标注在边界矩形的左上角，具体位置是矩形的x坐标不变，y坐标减去5个像素。</span>
			<span class="token comment">// 使用的字体是FONT_HERSHEY_PLAIN，字体大小为1，文本颜色为蓝紫色（RGB值为(0, 69, 255)），并且文本线的厚度为2像素。</span>
			<span class="token function">putText</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> objectType<span class="token punctuation">,</span> <span class="token punctuation">{</span> boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>boundRect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> FONT_HERSHEY_PLAIN<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">//从指定路径读取一个名为"contours.png"的图像</span>
	<span class="token comment">//string path = "contours.png";</span>
	string path <span class="token operator">=</span> <span class="token string">"xz.png"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//图像的预处理</span>
	<span class="token comment">//1.将照片转换为灰度图像,有助于简化图像处理过程，因为灰度图像只有一个通道</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> imgGray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2.高斯模糊，以减少图像中的噪声</span>
	<span class="token function">GaussianBlur</span><span class="token punctuation">(</span>imgGray<span class="token punctuation">,</span> imgBlur<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.Canny边缘检测,使用Canny算法检测图像中的边缘</span>
	<span class="token function">Canny</span><span class="token punctuation">(</span>imgBlur<span class="token punctuation">,</span> imgCanny<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//4.创建一个可以使用膨胀的内核  定义了一个3x3的结构元素（用于形态学操作），然后使用该元素对Canny边缘检测的结果进行膨胀</span>
	Mat kernel <span class="token operator">=</span> <span class="token function">getStructuringElement</span><span class="token punctuation">(</span>MORPH_RECT<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token comment">//5.图像膨胀  在进行轮廓检测之前，对Canny边缘检测的结果进行膨胀操作，可以增强轮廓并去除噪声。</span>
	<span class="token function">dilate</span><span class="token punctuation">(</span>imgCanny<span class="token punctuation">,</span> imgDil<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//获取并显示轮廓  </span>
	<span class="token function">getContours</span><span class="token punctuation">(</span>imgDil<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 显示处理后的图像</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//imshow("Image Gray", imgGray);</span>
	<span class="token comment">//imshow("Image Blur", imgBlur);</span>
	<span class="token comment">//imshow("Image Canny", imgCanny);</span>
	<span class="token comment">//imshow("Image Dilation", imgDil);</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725257538910-4ef7bad2-6947-4494-80bd-0dd512237c58.png" alt=""></p>
<h2 id="9人脸识别">9.人脸识别 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="token comment">//汇总了图像处理相关的所有头文件（15个）  只要这一个就行</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">//string path = "B3.jpg";</span>
	string path <span class="token operator">=</span> <span class="token string">"person.jpg"</span><span class="token punctuation">;</span>
	Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

	CascadeClassifier faceCascade<span class="token punctuation">;</span><span class="token comment">//创建级联分类器</span>
	<span class="token comment">//载入训练模型  这是OpenCV库中一个常用于面部检测的模型  在sources/data/haarcascades_cuda文件夹中 D:/OpenCV - 4.8.1/opencv/sources/data/haarcascades_cuda/haarcascade_frontalface_default.xml</span>
	faceCascade<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"haarcascade_frontalface_default.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>faceCascade<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"XML file not loaded"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token comment">//检查文件是否打开 没打开时执行打印语句</span>

	vector<span class="token operator">&lt;</span>Rect<span class="token operator">&gt;</span>faces<span class="token punctuation">;</span><span class="token comment">//创建人脸存放的vector</span>
	<span class="token comment">// faceCascade.detectMultiScale(img, faces, scaleFactor, minNeighbors);  </span>
	<span class="token comment">// faces：这是一个输出向量，用于存储检测到的人脸的矩形区域  scaleFactor：通常设置为1.1  minNeighbors：指定每一个目标至少被检测到几次才算是真的目标。通常设置为3-6。</span>
	faceCascade<span class="token punctuation">.</span><span class="token function">detectMultiScale</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//detectMultiScale函数可以检测出图片中所有的人脸，并用vector保存各个人脸的坐标、大小</span>

	<span class="token comment">//使用try-catch语句捕获异常，并打印出更详细的错误信息</span>
	<span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
		faceCascade<span class="token punctuation">.</span><span class="token function">detectMultiScale</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

		<span class="token comment">//在原图像中画出人脸矩形边框</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> faces<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">rectangle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> faces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> faces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">br</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725257670599-d0543ced-b23a-4cea-ad7f-fbc153d13472.png" alt=""></p>
<h1 id="图像增强">图像增强 </h1>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187537246-05096ed0-b541-4b6c-98b4-b1fb82c7c715.png" alt=""></p>
<h2 id="一-灰度变换">一、灰度变换 </h2>
<p>灰度变换可使图像动态范围增大，图像对比度扩展，图像变清晰，特征明显。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187704950-b5d2fd48-5c12-4cd3-85ab-534f5666409f.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187716292-e79a2204-acd6-40a9-b88d-1a446f7cb89d.png" alt=""></p>
<p>图像反转就是线性变换的一种</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187745033-556c99d3-887f-4523-82f1-e6103a165b22.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725187758982-0b28201b-5944-4279-9ebc-a6ac8a3ff49f.png" alt=""></p>
<h3 id="1线性变换">①线性变换 </h3>
<p>线性变换：原理：线性变换是一种简单的亮度和对比度调整方法，通过对每个像素的灰度级别应用线性变换公式来实现。对每个像素应用公式 output_pixel = input_pixel * alpha + beta，其中 alpha 控制对比度，beta 控制亮度。增大 alpha 值可以增加对比度，增大 beta 值可以增加亮度。</p>
<pre data-role="codeBlock" data-info="plain" class="language-plain plain"><code>/*
线性变换（亮度和对比度调整）：
原理：线性变换是一种简单的亮度和对比度调整方法，通过对每个像素的灰度级别应用线性变换公式来实现。
对每个像素应用公式 output_pixel = input_pixel * alpha + beta，其中 alpha 控制对比度，beta 控制亮度。增大 alpha 值可以增加对比度，增大 beta 值可以增加亮度。
*/
#include&lt;iostream&gt;
#include&lt;opencv2/opencv.hpp&gt;

using namespace cv;
using namespace std;

int main()
{
    Mat image1, output_image, image1_gray;   //定义输入图像，输出图像，灰度图像
    image1 = imread("person.jpg");  //读取图像；
    if (image1.empty())
    {
        cout &lt;&lt; "读取错误" &lt;&lt; endl;
        return -1;
    }

    cvtColor(image1, image1_gray, COLOR_BGR2GRAY);  //灰度化
    imshow(" image1_gray", image1_gray);   //显示灰度图像

    output_image = image1_gray.clone();
    for (int i = 0; i &lt; image1_gray.rows; i++)
    {
        for (int j = 0; j &lt; image1_gray.cols; j++)
        {
            output_image.at&lt;uchar&gt;(i, j) = 1.5 * double(image1_gray.at&lt;uchar&gt;(i, j)) + 30;  //线性变换 s=1.5r+30
        }
    }
    normalize(output_image, output_image, 0, 255, NORM_MINMAX);  //图像归一化，转到0~255范围内
    convertScaleAbs(output_image, output_image);  //数据类型转换到CV_8U
    imshow(" output_image", output_image);  //显示变换图像


    waitKey(0);  //暂停，保持图像显示，等待按键结束
    return 0;
}
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200028196-9456d52a-1e2c-4942-8e84-924c12038a27.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200036807-ea68734b-7855-44d1-be1e-078f77048c2d.png" alt=""></p>
<pre data-role="codeBlock" data-info="plain" class="language-plain plain"><code>/*
灰度反转：将图像亮暗对调，可以增强图像中暗色区域细节
s = T(r) = L - 1 - r

其中L为图像灰度级，0~255灰度图像的灰度级为256.
*/
#include&lt;iostream&gt;
#include&lt;opencv2/opencv.hpp&gt;

using namespace cv;
using namespace std;

int main()
{
	Mat image1, output_image, image1_gray;   //定义输入图像，输出图像，灰度图像
	image1 = imread("person.jpg");  //读取图像；
	if (image1.empty())
	{
		cout &lt;&lt; "读取错误" &lt;&lt; endl;
		return -1;
	}

	cvtColor(image1, image1_gray, COLOR_BGR2GRAY);  //灰度化
	imshow(" image1_gray", image1_gray);   //显示灰度图像

	output_image = image1_gray.clone();
	for (int i = 0; i &lt; image1_gray.rows; i++)
	{
		for (int j = 0; j &lt; image1_gray.cols; j++)
		{
			output_image.at&lt;uchar&gt;(i, j) = 256 - 1 - image1_gray.at&lt;uchar&gt;(i, j);  //灰度反转
		}
	}
	imshow("output_image", output_image);  //显示反转图像


	waitKey(0);  //暂停，保持图像显示，等待按键结束
	return 0;
}
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200306637-25d5d423-0e20-45a9-b358-758a8cc290bc.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200315115-98cad7a6-8368-496e-adfe-e674ab491fc1.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200345045-966ca51b-4a3b-49fd-bc06-6389ab8d4985.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200357892-1dc660a3-9717-4e3f-8659-21a9a3dc16b6.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200368314-d9efa7b9-4013-4704-9736-40444566ce66.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200397111-31b36917-6759-4572-81b2-a321c651a730.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200409096-69ce4bd8-f6ce-40af-8cb5-cd840afb0b9a.png" alt=""></p>
<h3 id="2对数变换">②对数变换 </h3>
<p>对数变换：原理：对数变换通过应用对数函数对图像的每个像素值进行修改。这种变换适用于增强图像的低灰度级别，因为它拉伸了低灰度级别之间的差异。公式为 output_pixel = c * log(1 + input_pixel)，其中 c 是缩放常数。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200511271-51c330a3-141b-46f7-8a80-934ceb65156c.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200523918-944f551e-62c8-497f-8c38-e9c82c2b2d94.png" alt=""></p>
<pre data-role="codeBlock" data-info="plain" class="language-plain plain"><code>/*
对数变换：
原理：对数变换通过应用对数函数对图像的每个像素值进行修改。这种变换适用于增强图像的低灰度级别，因为它拉伸了低灰度级别之间的差异。
公式为 output_pixel = c * log(1 + input_pixel)，其中 c 是缩放常数。
*/
#include&lt;iostream&gt;
#include&lt;opencv2/opencv.hpp&gt;

using namespace cv;
using namespace std;

int main()
{
    Mat image1, output_image, image1_gray;   //定义输入图像，输出图像，灰度图像
    image1 = imread("person.jpg");  //读取图像；
    if (image1.empty())
    {
        cout &lt;&lt; "读取错误" &lt;&lt; endl;
        return -1;
    }

    cvtColor(image1, image1_gray, COLOR_BGR2GRAY);  //灰度化
    imshow(" image1_gray", image1_gray);   //显示灰度图像

    output_image = image1_gray.clone();
    for (int i = 0; i &lt; image1_gray.rows; i++)
    {
        for (int j = 0; j &lt; image1_gray.cols; j++)
        {
            output_image.at&lt;uchar&gt;(i, j) = 6 * log((double)(image1_gray.at&lt;uchar&gt;(i, j)) + 1);  //对数变换 s=6*log(r+1)
        }
    }
    normalize(output_image, output_image, 0, 255, NORM_MINMAX);  //图像归一化，转到0~255范围内
    convertScaleAbs(output_image, output_image);  //数据类型转换到CV_8U
    imshow(" output_image", output_image);  //显示变换图像


    waitKey(0);  //暂停，保持图像显示，等待按键结束
    return 0;
}
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200649488-2844a603-688e-4456-b41c-f4e228074ef9.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200656156-d0de8af5-5454-46ff-bcaf-0acfc1eda5b4.png" alt=""></p>
<h3 id="3伽马变换">③伽马变换 </h3>
<p>伽马变换：原理：伽马变换通过应用幂函数对图像的每个像素值进行修改。伽马校正可以用于调整图像的对比度和亮度。公式为 output_pixel = c * (input_pixel ^ gamma)，其中 c 是缩放常数，gamma 是伽马值。增大 gamma 值可以增加对比度。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200736490-de1e86f7-5b8b-4961-84e4-f20066939212.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200746553-affffb33-a67e-4030-838c-f2751c781440.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200762038-67bfd4b4-db5b-4164-9173-fef8578e7865.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200773206-c9bebdd1-2d08-49a2-9c2a-6af9305b9c99.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200785546-bae5a1d2-c35f-4485-be05-523ef94d36e9.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200795490-b8b4f555-0d3b-4f9f-b9ad-9ea02593ce5c.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200803478-67e0495c-3d3a-418f-8d58-a9d68a291df0.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725200815173-3f17b87e-b223-45ce-84d3-e61b82a11b62.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//uchar用于单通道灰度图像，Vec3f和Vec3b用于三通道彩色图像，但前者使用浮点数表示颜色值，后者使用字节表示。</span>

<span class="token comment">/*
伽马校正：
原理：伽马校正通过应用幂函数对图像的每个像素值进行修改。伽马校正可以用于调整图像的对比度和亮度。
公式为 output_pixel = c * (input_pixel ^ gamma)，其中 c 是缩放常数，gamma 是伽马值。增大 gamma 值可以增加对比度。
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Mat image1<span class="token punctuation">,</span> output_image<span class="token punctuation">,</span> image1_gray<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，输出图像，灰度图像</span>
    image1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image1<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> image1_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">" image1_gray"</span><span class="token punctuation">,</span> image1_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//显示灰度图像</span>

    output_image <span class="token operator">=</span> image1_gray<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> image1_gray<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> image1_gray<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    output_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span>image1_gray<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//幂律变换 s=6*r^0.5</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> output_image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//图像归一化，转到0~255范围内</span>
    <span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> output_image<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//数据类型转换到CV_8U</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">" output_image"</span><span class="token punctuation">,</span> output_image<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//显示变换图像</span>


    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201015479-70f4022e-daf4-49f9-a6a4-2d4b1217007f.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201021853-c109a885-7053-4f94-b1db-e3ac94c5b749.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span>  </span>

<span class="token comment">// 使用给定的伽马值对彩色图像进行伽马变换  </span>
cv<span class="token double-colon punctuation">::</span>Mat <span class="token function">gammaTransformation</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> cv<span class="token double-colon punctuation">::</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> gamma<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cv<span class="token double-colon punctuation">::</span>Mat transformedImage<span class="token punctuation">;</span>

    <span class="token comment">// 将图像转换为浮点型，以避免整数溢出  </span>
    image<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>transformedImage<span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 手动应用伽马变换公式  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> transformedImage<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> transformedImage<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> transformedImage<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取当前像素的值  </span>
                <span class="token keyword keyword-float">float</span> pixelValue <span class="token operator">=</span> transformedImage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>cv<span class="token double-colon punctuation">::</span>Vec3f<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token comment">// 应用伽马变换：先将像素值归一化到[0, 1]，然后应用伽马变换，最后再映射回[0, 255]  </span>
                pixelValue <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">pow</span><span class="token punctuation">(</span>pixelValue <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> gamma<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255.0</span><span class="token punctuation">;</span>

                <span class="token comment">// 将处理后的像素值存回图像中  </span>
                transformedImage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>cv<span class="token double-colon punctuation">::</span>Vec3f<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> pixelValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将浮点图像转换回8位无符号整数格式  </span>
    transformedImage<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>transformedImage<span class="token punctuation">,</span> CV_8U<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> transformedImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Load an image  </span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Could not open or find the image"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Apply gamma transformation  </span>
    <span class="token keyword keyword-double">double</span> gamma <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span> <span class="token comment">// Example gamma value  </span>
    cv<span class="token double-colon punctuation">::</span>Mat gammaCorrectedImage <span class="token operator">=</span> <span class="token function">gammaTransformation</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Save the gamma-corrected image  </span>
    <span class="token comment">//cv::imwrite("gamma_corrected_image.jpg", gammaCorrectedImage);</span>

    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"origin_image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gamma_corrected_image"</span><span class="token punctuation">,</span> gammaCorrectedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201197395-d3878699-6d90-4c9d-b3e4-67a69ccee34e.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201204091-7e32f6f8-eea9-4931-96da-7b0d7fc8a68d.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>线性变换，对数变换和伽马变换通常需要进行归一化，尤其是在将变换后的像素值映射回原始图像的数据范围（通常是<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span>）时。归一化的目的是确保变换后的像素值落在有效的显示和存储范围内。

cv<span class="token double-colon punctuation">::</span>Mat src<span class="token punctuation">;</span> <span class="token comment">// 假设这是一个浮点类型的图像  </span>
cv<span class="token double-colon punctuation">::</span>Mat dst<span class="token punctuation">;</span> <span class="token comment">// 用于存储归一化后的图像  </span>
  
<span class="token comment">// 将浮点图像进行最小-最大归一化到0-255范围，并转换为8位无符号整数图像  </span>
cv<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>NORM_MINMAX<span class="token punctuation">,</span> CV_8U<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><h2 id="二-灰度直方图">二、灰度直方图 </h2>
<p>灰度直方图反映的是一幅图像中灰度级与各灰度级像素出现的频率之间的关系。以灰度级为横坐标，纵坐标为灰度级的频率，绘制频率同灰度级的关系就是灰度直方图。频率计算公式为</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201357802-080013a0-2ede-49ed-aa6d-f3783c5e854d.png" alt=""></p>
<p>式中：  <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201389909-1acbc454-618e-474c-a244-76e2bc004d47.png" alt="">是图像中灰度为i的像素数，n为图像总像素数。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201415048-682ccba3-8afd-4edf-8865-230cc232e1b7.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> hist<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像, 直方图  img/red_panda.jpg   img/white_panda.jpg  img/orange.jpg   img/football_ball.jpg   img/baseball_ball.png     </span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；cat.jpg   LenaNoise.png   img/hand.jpg  img/black_to_white.jpg  img/early_1800.jpg   A013.jpg   person.jpg  </span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化           关联  HSV（色相，饱和度和明度）化是：COLOR_BGR2HSV</span>
    <span class="token comment">//namedWindow("image_gray", WINDOW_FREERATIO);//创建一个可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//显示灰度图像</span>

	<span class="token comment">//获取图像直方图</span>
	<span class="token keyword keyword-int">int</span> histsize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-float">float</span> ranges<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span><span class="token operator">*</span> histRanges <span class="token operator">=</span> <span class="token punctuation">{</span> ranges <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>image_gray<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRanges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//创建直方图显示图像</span>
	<span class="token keyword keyword-int">int</span> hist_h <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span><span class="token comment">//直方图的图像的高</span>
	<span class="token keyword keyword-int">int</span> hist_w <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span> <span class="token comment">//直方图的图像的宽</span>
	<span class="token keyword keyword-int">int</span> bin_w <span class="token operator">=</span> hist_w <span class="token operator">/</span> histsize<span class="token punctuation">;</span><span class="token comment">//指定每个等级直方图条形的宽度,2</span>
	Mat <span class="token function">histImage</span><span class="token punctuation">(</span>hist_h<span class="token punctuation">,</span> hist_w<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//黑色图片上绘制直方图显示的图像</span>

	<span class="token comment">//绘制并显示直方图</span>
	<span class="token function">normalize</span><span class="token punctuation">(</span>hist<span class="token punctuation">,</span> hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> hist_h<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//归一化直方图</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> histsize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
        <span class="token comment">// 直方图是以条形图的形式从图像的底部开始绘制的，每个条形的顶部对应着该直方图条目的值，但实际左上角才是图像原点</span>
        <span class="token comment">// hist_h - cvRound(hist.at&lt;float&gt;(i - 1)) 这个表达式计算的是每个直方图条目的顶部在图像中的y坐标</span>
		<span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">*</span>bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//BGR 蓝色</span>
	<span class="token punctuation">}</span>

	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"histImage"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为Image的可调节的窗口 以免图片显示不全</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"histImage"</span><span class="token punctuation">,</span> histImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201590908-dd12f1a0-72b9-498a-aebe-6e8dd90075f7.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201597689-ba202655-95a4-449f-8a45-71439b4efb2d.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>

<span class="token comment">//显示彩色图像三通道直方图</span>
<span class="token keyword keyword-void">void</span> <span class="token function">showHist</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> img<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//1、创建3个矩阵来处理每个通道输入图像通道。</span>
    <span class="token comment">//我们用向量类型变量来存储每个通道，并用split函数将输入图像划分成3个通道。</span>
    vector<span class="token operator">&lt;</span>Mat<span class="token operator">&gt;</span>bgr<span class="token punctuation">;</span>
    <span class="token function">split</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> bgr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2、定义变量范围并创建3个矩阵来存储每个直方图</span>
    <span class="token keyword keyword-int">int</span> histsize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> range<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span><span class="token operator">*</span> histRange <span class="token operator">=</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Mat b_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">;</span>

    <span class="token comment">//3、使用calcHist函数计算直方图</span>
    <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bgr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bgr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bgr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRange<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//4、创建一个512*300像素大小的彩色图像，用于绘制显示</span>
    <span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    Mat <span class="token function">histImage</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//5、将最小值与最大值标准化直方图矩阵</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">,</span> b_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//6、使用彩色通道绘制直方图</span>
    <span class="token keyword keyword-int">int</span> binStep <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>histsize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//通过将宽度除以区间数来计算binStep变量</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> histsize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dst <span class="token operator">=</span> histImage<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//显示灰度直方图</span>
<span class="token keyword keyword-void">void</span> <span class="token function">showgrayHist</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> img_gray<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token comment">//1、定义变量范围并创建3个矩阵来存储每个直方图</span>
    <span class="token keyword keyword-int">int</span> histsize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> range<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span><span class="token operator">*</span> histRange <span class="token operator">=</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Mat grayhist<span class="token punctuation">;</span>

    <span class="token comment">//2、使用calcHist函数计算直方图</span>
    <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>img_gray<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> grayhist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRange<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//3、创建一个512*300像素大小的彩色图像，用于绘制显示</span>
    <span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    Mat <span class="token function">histImage</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//4、将最小值与最大值标准化直方图矩阵</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>grayhist<span class="token punctuation">,</span> grayhist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//5、使用彩色通道绘制直方图</span>
    <span class="token keyword keyword-int">int</span> binStep <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>histsize<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//通过将宽度除以区间数来计算binStep变量</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> histsize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">line</span><span class="token punctuation">(</span>histImage<span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>grayhist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Point</span><span class="token punctuation">(</span>binStep <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>grayhist<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dst <span class="token operator">=</span> histImage<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Mat src <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat histImage<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>src<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"No src data!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">showHist</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> histImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat image_gray<span class="token punctuation">,</span> grayhistImage<span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化           关联  HSV（色相，饱和度和明度）化是：COLOR_BGR2HSV</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">showgrayHist</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span>grayhistImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//namedWindow("histImage", WINDOW_FREERATIO);//创建一个名为Image的可调节的窗口 以免图片显示不全</span>

    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"histImage"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"histImage"</span><span class="token punctuation">,</span> histImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"grayhistImage"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"grayhistImage"</span><span class="token punctuation">,</span> grayhistImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201858164-26430f16-a728-4948-a04d-257d42d3070a.png" alt=""></p>
<p><strong>其他图片直方图：</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201895054-a8ea8f91-d3f0-4f5e-b323-ba532a60ef26.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201925649-cb9cc31a-3785-449b-91a2-3ff9413d7b16.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201953072-ab145c20-d6c4-4218-803b-438ea67489ec.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725201960889-59a8298c-2247-43af-8c8e-6880a4d1fa4a.png" alt=""></p>
<h2 id="三-直方图均衡化">三、直方图均衡化 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202079283-4d5d841a-ae0a-4d1d-857a-c980b01cb873.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202094935-a3a1f5b1-88a4-4ae2-93dc-bb297d4954ee.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202104467-39e0a53c-1f1e-4faa-addf-c4ce6b56166a.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202113146-f2522480-67dd-416f-a773-48130ad0a469.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">/*
直方图均衡化：
原理：直方图均衡化旨在拉伸图像的灰度级别分布，使其更均匀。这通过重新分配像素值以增加亮度级别的数量来实现。
这有助于增强图像的对比度，并突出图像中的细节。该方法的原理是重新映射图像的累积分布函数，使其变为均匀分布。
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_enhanced<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像, 直方图</span>
    image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">" image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//显示灰度图像</span>

    <span class="token function">equalizeHist</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_enhanced<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//直方图均衡化</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">" image_enhanced"</span><span class="token punctuation">,</span> image_enhanced<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//显示增强图像</span>

    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202205959-17a09162-d0e9-48d8-9f0c-3c2041d34b12.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202230443-7e86e8af-96ad-451c-af3f-ba42c9dee1a8.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202222985-adbbf0ef-39f1-46b8-bc61-1f4956843941.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202238104-040013ca-6e45-4504-a957-7547676c78f1.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">/*自适应直方图均衡化：
原理：自适应直方图均衡化将图像划分为小块，然后对每个块进行直方图均衡化。
这使得图像在不同区域的灰度级别分布更加均匀，尤其是当图像具有明显的亮度变化时。
*/</span>
<span class="token comment">/**
#include &lt;opencv2/opencv.hpp&gt;  
#include &lt;opencv2/highgui/highgui.hpp&gt;  

int main()
{
    // 读取图像  
    cv::Mat src = cv::imread("cat.jpg", cv::IMREAD_GRAYSCALE);
    if (src.empty())
    {
        std::cout &lt;&lt; "不可以打开图像" &lt;&lt; std::endl;
        return -1;
    }

    // 创建CLAHE对象  Contrast Limited Adaptive Histogram Equalization  用于对图像进行自适应直方图均衡化
    // 参数2.0是对比度限制（clipLimit），cv::Size(8, 8)是图像分割的块大小（tileGridSize）  
    cv::Ptr&lt;cv::CLAHE&gt; clahe = cv::createCLAHE(2.0, cv::Size(8, 8));

    // 应用CLAHE到图像  使用CLAHE对象的apply方法将CLAHE处理应用到原始图像src上，并将处理后的图像存储在dst中
    cv::Mat dst;
    clahe-&gt;apply(src, dst);

    // 显示原始图像和CLAHE处理后的图像  
    cv::namedWindow("image_gray", cv::WINDOW_AUTOSIZE);
    cv::imshow("image_gray", src);

    cv::namedWindow("CLAHE Image", cv::WINDOW_AUTOSIZE);
    cv::imshow("CLAHE Image", dst);

    // 等待用户按键，然后关闭窗口  
    cv::waitKey(0);
    return 0;
}
</span></code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202308043-61c8acbf-d249-4e43-8369-5b16e3822b74.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202498177-4f49f128-53e0-4d3c-a9cd-e44d2216e21e.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202315562-39a5897f-6fd9-4ef9-83cd-f43b1897450e.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202515380-472afd8f-a7eb-4122-bb4f-bfd5900b3f01.png" alt=""></p>
<p>图像均衡化通常会拓展灰度级范围，进而增强图像的对比度，因此输入图像覆盖的灰度级区间越小，直方图均衡对其影响越大。</p>
<h4 id="ps直方图规定化">PS：直方图规定化 </h4>
<p>直方图匹配（直方图规定化）：用于生成具有规定直方图的图像的方法。将某幅影像或某一区域的直方图匹配到另一幅影像上，以使两幅影像的色调保持一致。两幅图像比对前，通常要使其直方图形式一致。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202570241-c084cf78-f969-4939-9565-6f1982429f19.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202590932-28f25d6a-85e1-491e-a3fd-75a753cfbabe.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202672228-ecd450c8-601b-41cc-a660-cc6567ee422c.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image1<span class="token punctuation">,</span> image1_gray<span class="token punctuation">,</span> hist1<span class="token punctuation">,</span> image2<span class="token punctuation">,</span> image2_gray<span class="token punctuation">,</span> hist2<span class="token punctuation">,</span> image_enhanced<span class="token punctuation">;</span>   <span class="token comment">//定义修改图像，灰度修改图像, 修改直方图，目标图像，灰度目标图像，目标直方图, 规定化增强图像</span>
	image1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image1<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> image1_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">" image1_gray"</span><span class="token punctuation">,</span> image1_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//显示灰度图像</span>

	image2 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"img/red_panda.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image2<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image2<span class="token punctuation">,</span> image2_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">" image2_gray"</span><span class="token punctuation">,</span> image2_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//显示灰度图像</span>

	<span class="token comment">//均衡化处理</span>
	<span class="token function">equalizeHist</span><span class="token punctuation">(</span>image1_gray<span class="token punctuation">,</span> image1_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">equalizeHist</span><span class="token punctuation">(</span>image2_gray<span class="token punctuation">,</span> image2_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token comment">//获取两个均衡化图像的直方图</span>
	<span class="token keyword keyword-int">int</span> histsize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-float">float</span> ranges<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span><span class="token operator">*</span> histRanges <span class="token operator">=</span> <span class="token punctuation">{</span> ranges <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>image1_gray<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRanges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>image2_gray<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histsize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRanges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//计算两个均衡化图像直方图的累积概率</span>
	<span class="token keyword keyword-float">float</span> hist1_cdf<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> hist1<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-float">float</span> hist2_cdf<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> hist2<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		hist1_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>hist1_cdf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> hist1<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		hist2_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>hist2_cdf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> hist2<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		hist1_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> hist1_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token punctuation">(</span>image1_gray<span class="token punctuation">.</span>rows <span class="token operator">*</span> image1_gray<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
		hist2_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> hist2_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token punctuation">(</span>image2_gray<span class="token punctuation">.</span>rows <span class="token operator">*</span> image2_gray<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 两个累计概率之间的差值，用于找到最接近的点</span>
	<span class="token keyword keyword-float">float</span> diff_cdf<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			diff_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>hist1_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> hist2_cdf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Mat <span class="token function">lut</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> CV_8U<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//查找源灰度级为i的映射灰度和i的累积概率差最小(灰度接近)的规定化灰度</span>
		<span class="token keyword keyword-float">float</span> min <span class="token operator">=</span> diff_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-int">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>min <span class="token operator">&gt;</span> diff_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				min <span class="token operator">=</span> diff_cdf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				index <span class="token operator">=</span> j<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		lut<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> index<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">LUT</span><span class="token punctuation">(</span>image1_gray<span class="token punctuation">,</span> lut<span class="token punctuation">,</span> image_enhanced<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//图像中进行映射</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_enhanced"</span><span class="token punctuation">,</span> image_enhanced<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202860604-841d4e9e-0174-47a0-a131-ad272caea532.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202902358-86df729c-33ba-47d6-b379-4eb3492f4032.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202909807-9a429bf4-e5e1-4fc7-b275-8a5fbf3c27c4.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202917029-04c5c4e9-2d7f-4aa4-b453-2749fe795f04.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202924702-22ca4939-c14a-4bc7-b733-925bb5182474.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725202932355-0a719ecd-cc72-4646-b7cb-be661e702abf.png" alt=""></p>
<h1 id="图像平滑">图像平滑 </h1>
<p>图像平滑（通过积分过程使得图像边缘模糊）</p>
<p>概念：为抑制噪声、改善图像质量所进行的处理称为图像平滑或去噪。可以在空间域和频率域中进行。</p>
<p>空间滤波通过把每个像素的值替换为该像素及其邻域的函数值来修改图像。如果对图像像素执行的运算是线性的，那么称该滤波器为线性空间滤波器。否则，称该滤波器为非线性空间滤波器。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725203066480-e017deae-b881-4047-b778-82777da30403.png" alt=""></p>
<p>线性滤波就是找到合适的方法来修改图像的频率内容。在空间域中，我们是通过卷积滤波来实现这一要求的。在频率域中，我们则是用乘法滤波器来实现这一要求的。</p>
<h2 id="1中值滤波">1.中值滤波 </h2>
<p>一种非线性平滑滤波方法，用于消除椒盐噪声等异常值的影响。中值滤波将每个像素点的灰度值设置为该点某邻域窗口内的所有像素点灰度值的中值。它基于排序统计理论，通过选择合适的点来替代污染点的值，可以很好地保护图像的尖锐边缘。中值滤波对于去除由异常值引起的噪声特别有效，但在处理高斯噪声方面效果较差。</p>
<h3 id="opencv调用">Opencv调用 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">/*
            // 方框滤波
            Mat boxFilteredImage;
            boxFilter(image, boxFilteredImage, CV_32F, Size(5, 5));
            display_MatInQT(ui-&gt;label_1, boxFilteredImage);

            // 均值滤波
            Mat meanFilteredImage;
            blur(image, meanFilteredImage, Size(5, 5));
            display_MatInQT(ui-&gt;label_1, meanFilteredImage);

            // 中值滤波
            Mat medianFilteredImage;
            medianBlur(image, medianFilteredImage, 5);
            display_MatInQT(ui-&gt;label_1, medianFilteredImage);

            // 高斯滤波
            Mat gaussianFilteredImage;
            GaussianBlur(image, gaussianFilteredImage, Size(5, 5), 0);
            display_MatInQT(ui-&gt;label_1, gaussianFilteredImage);

            // 双边滤波
            Mat filteredImage;     //滤波器直径15  颜色空间的标准差50  空间空间的标准差50
            bilateralFilter(image, filteredImage, 15, 50, 50);
            display_MatInQT(ui-&gt;label_1, filteredImage);
   */</span>
</code></pre><h3 id="加入椒盐噪声">加入椒盐噪声 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>

<span class="token comment">// 添加白色或黑色椒盐噪声  </span>
<span class="token keyword keyword-void">void</span> <span class="token function">addSaltAndPepperNoise</span><span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> probability<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> image<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> image<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//生成一个随机数（rand()返回的值）并将其转换为双精度浮点数。</span>
            <span class="token comment">//然后，我们将其除以RAND_MAX（这是rand()函数能够返回的最大值），得到一个在0到1之间的随机数。</span>
            <span class="token comment">//如果这个随机数小于我们设定的噪声概率probability(介于0和1之间的浮点数)，则我们决定在这个位置添加噪声。</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> RAND_MAX<span class="token punctuation">)</span> <span class="token operator">&lt;</span> probability<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 随机设置为0（黑色）或255（白色）   rand() % 2会返回一个0或1的随机数，当返回0时，我们将像素设置为0，否则设置为255。</span>
                image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">255</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取灰度图像  </span>
    cv<span class="token double-colon punctuation">::</span>Mat grayImage <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>grayImage<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Could not open or find the image"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 显示原始图像  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> grayImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 添加椒盐噪声  </span>
    <span class="token keyword keyword-double">double</span> noiseProbability <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span> <span class="token comment">// 噪声概率，5% 的像素受到噪声影响，可以根据需要调整  </span>
    <span class="token function">addSaltAndPepperNoise</span><span class="token punctuation">(</span>grayImage<span class="token punctuation">,</span> noiseProbability<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示带噪声的图像  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Noisy Image"</span><span class="token punctuation">,</span> grayImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 应用中值滤波器去噪  </span>
    <span class="token keyword keyword-int">int</span> filterSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 滤波器大小，通常为3, 5, 7等奇数  </span>
    cv<span class="token double-colon punctuation">::</span>Mat filteredImage<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">medianBlur</span><span class="token punctuation">(</span>grayImage<span class="token punctuation">,</span> filteredImage<span class="token punctuation">,</span> filterSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示去噪后的图像  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Filtered Image"</span><span class="token punctuation">,</span> filteredImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待按键，然后关闭窗口  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725238970635-22b297dc-062f-4b14-9b5b-969857f5ed33.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725238977854-ee5bb023-e61b-45b3-837c-59c7f5584dc2.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725238985745-de70ab62-c35f-4b6e-b235-935f32dca630.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span>  <span class="token comment">//随机数头文件</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Salt</span><span class="token punctuation">(</span>Mat image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//n：加入噪声点数</span>

<span class="token comment">// 获取窗口内像素的中值  </span>
<span class="token keyword keyword-int">int</span> <span class="token function">getMedian</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">sortedWindow</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">nth_element</span><span class="token punctuation">(</span>sortedWindow<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sortedWindow<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> window<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> sortedWindow<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> sortedWindow<span class="token punctuation">[</span>window<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 应用中值滤波器  </span>
<span class="token keyword keyword-void">void</span> <span class="token function">medianFilter</span><span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> filterSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> halfSize <span class="token operator">=</span> filterSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat filteredImage <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> image<span class="token punctuation">.</span>rows <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> image<span class="token punctuation">.</span>cols <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> window<span class="token punctuation">;</span>

            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    window<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> m<span class="token punctuation">,</span> j <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword keyword-int">int</span> median <span class="token operator">=</span> <span class="token function">getMedian</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
            filteredImage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> median<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    image <span class="token operator">=</span> filteredImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取图像  </span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//LenaNoise.png</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Could not open or find the image"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"origin"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Salt</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//加入5000个噪声点</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"SaltAndPepperNoise"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//显示噪声图像；</span>

    <span class="token comment">// 应用中值滤波器  </span>
    <span class="token function">medianFilter</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示处理后的图像    保存 cv::imwrite("output.jpg", image);</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在图像中加入白色椒盐噪声</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Salt</span><span class="token punctuation">(</span>Mat image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//随机数生成器</span>
    default_random_engine generater<span class="token punctuation">;</span>
    uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token function">randomRow</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token function">randomCol</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        i <span class="token operator">=</span> <span class="token function">randomCol</span><span class="token punctuation">(</span>generater<span class="token punctuation">)</span><span class="token punctuation">;</span>
        j <span class="token operator">=</span> <span class="token function">randomRow</span><span class="token punctuation">(</span>generater<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
            image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
            image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725239246500-14e3695a-6ae8-4e5e-a01f-a457453cd138.png" alt=""></p>
<h3 id="中值滤波原理">中值滤波原理 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">/*
中值滤波的原理如下：
        中值滤波器的基本原理是用像素在其邻域中的中值来代替该像素的值
1、选择一个奇数大小的滤波器窗口（如3x3, 5x5等），确保窗口中心有一个像素。
2、将滤波器窗口在图像上滑动，对窗口内的像素进行排序。
3、将排序后的像素数组的中值赋给窗口中心的像素。
4、重复步骤2和3，直到处理完图像中的所有像素。
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span> <span class="token comment">// 为了使用 std::nth_element  </span></span>

<span class="token comment">//填充边界 计算中值时填充不会计入</span>

<span class="token comment">// 获取窗口内像素的中值  </span>
<span class="token keyword keyword-int">int</span> <span class="token function">getMedian</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">sortedWindow</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//std::nth_element 函数会重新排列元素，使得第 n 个元素（从 0 开始计数）位于它在完全排序后应该出现的位置，而所有小于它的元素都在它前面，所有大于它的元素都在它后面。</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">nth_element</span><span class="token punctuation">(</span>sortedWindow<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sortedWindow<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> sortedWindow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> sortedWindow<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sortedWindow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果窗口大小是偶数，返回中间两个数的平均值  中位数不要小数</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>sortedWindow<span class="token punctuation">[</span>sortedWindow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> sortedWindow<span class="token punctuation">[</span>sortedWindow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果窗口大小是奇数，返回中间那个数  </span>
        <span class="token keyword keyword-return">return</span> sortedWindow<span class="token punctuation">[</span>sortedWindow<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 应用中值滤波器  </span>
<span class="token keyword keyword-void">void</span> <span class="token function">medianFilter</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> filterSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> halfSize <span class="token operator">=</span> filterSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> rows <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> cols <span class="token operator">=</span> image<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建输出图像  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">filteredImage</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 遍历图像中的每个像素  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cols <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建窗口并填充像素值  </span>
            std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> window<span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//直接通过当前遍历的索引 i 和 j 加上偏移量 m 和 n 来获取像素值。 所以边界值中位数为0</span>
                    window<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image<span class="token punctuation">[</span>i <span class="token operator">+</span> m<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 获取中值并设置到输出图像  </span>
            filteredImage<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getMedian</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 更新原图像  </span>
    image <span class="token operator">=</span> filteredImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725239477551-6c2a0bf7-ec8d-44f9-a435-4c5fdb357a6c.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 应用中值滤波器 </span>
<span class="token keyword keyword-void">void</span> <span class="token function">medianFilter</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> filterSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>filterSize <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">"Filter size must be odd."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-int">int</span> halfSize <span class="token operator">=</span> filterSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> rows <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> cols <span class="token operator">=</span> image<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建带有边界扩展的新图像  </span>
    <span class="token keyword keyword-int">int</span> paddedRows <span class="token operator">=</span> rows <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> halfSize<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> paddedCols <span class="token operator">=</span> cols <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> halfSize<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">paddedImage</span><span class="token punctuation">(</span>paddedRows<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>paddedCols<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建输出图像  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">filteredImage</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 遍历扩展图像中的每个像素  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paddedRows <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> paddedCols <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建窗口并填充像素值  </span>
            std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> window<span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 使用 originalRow 和 originalCol 的方式首先计算出像素在原始图像中的实际位置，然后再检查这个位置是否在图像边界内。</span>
                    <span class="token comment">// 如果是，则将该像素值添加到窗口中。这种方式确保了只有位于图像内部的像素才会被包括在内。</span>
                    <span class="token keyword keyword-int">int</span> originalRow <span class="token operator">=</span> i <span class="token operator">-</span> halfSize <span class="token operator">+</span> m<span class="token punctuation">;</span>
                    <span class="token keyword keyword-int">int</span> originalCol <span class="token operator">=</span> j <span class="token operator">-</span> halfSize <span class="token operator">+</span> n<span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>originalRow <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> originalRow <span class="token operator">&lt;</span> rows <span class="token operator">&amp;&amp;</span> originalCol <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> originalCol <span class="token operator">&lt;</span> cols<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        window<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image<span class="token punctuation">[</span>originalRow<span class="token punctuation">]</span><span class="token punctuation">[</span>originalCol<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 获取中值并设置到输出图像 </span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                filteredImage<span class="token punctuation">[</span>i <span class="token operator">-</span> halfSize<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> halfSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getMedian</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新原图像  </span>
    image <span class="token operator">=</span> filteredImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725239625077-7bfebe7f-1ab8-4b81-ad40-3fd677075c76.png" alt="">填充的0不算入排序 不要小数</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 示例图像（灰度）  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> image <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 应用3x3中值滤波器  </span>
    <span class="token function">medianFilter</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 输出滤波后的图像  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span><span class="token operator">&amp;</span> row <span class="token operator">:</span> image<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> pixel <span class="token operator">:</span> row<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> pixel <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="2均值滤波">2.均值滤波 </h2>
<p>一种简单的平滑滤波方法，使用滤波窗口内像素的平均值来代替中心像素的值。对于滤波窗口内的每个像素，计算其邻域内所有像素的平均值，然后将结果作为中心像素的值。均值滤波可以有效地平滑图像并去除高频噪声，但会模糊图像并失去细节。</p>
<h3 id="opencv调用-1">Opencv调用 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cv<span class="token double-colon punctuation">::</span>Mat src<span class="token punctuation">,</span> dst<span class="token punctuation">;</span>

    <span class="token comment">// 读取图像  </span>
    src <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Could not read the image!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建目标图像  </span>
    <span class="token comment">//dst.create(src.size(), src.type());</span>

    <span class="token comment">// 应用3x3均值滤波器  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">blur</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示原图像和处理后的图像  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Averaging Filter"</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待用户按键，然后关闭窗口  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725240900559-6f391bec-3800-4972-9f30-42da30ee8384.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725240908672-103b9c33-907b-49ff-981a-ad8deaa24a41.png" alt=""></p>
<h3 id="均值滤波原理">均值滤波原理 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 基本思想是用像素点周围像素的均值来代替该像素点的值</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span> <span class="token comment">// for round()   </span></span>

<span class="token comment">// 填充边界 计算均值时填充不会计入</span>

<span class="token comment">// 计算窗口内像素的平均值  </span>
<span class="token keyword keyword-float">float</span> <span class="token function">getAverage</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> pixel <span class="token operator">:</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> pixel<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span> <span class="token operator">/</span> window<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">meanFilter</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> filterSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>filterSize <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">"Filter size must be odd."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-int">int</span> halfSize <span class="token operator">=</span> filterSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> rows <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> cols <span class="token operator">=</span> image<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建带有边界扩展的新图像  初始化了带有扩张边界的新图像 paddedImage，将所有像素值设置为0</span>
    <span class="token keyword keyword-int">int</span> paddedRows <span class="token operator">=</span> rows <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> halfSize<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> paddedCols <span class="token operator">=</span> cols <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> halfSize<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">paddedImage</span><span class="token punctuation">(</span>paddedRows<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>paddedCols<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建输出图像  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">filteredImage</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历扩展图像中的每个像素  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paddedRows <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> halfSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> paddedCols <span class="token operator">-</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建窗口并填充像素值  </span>
            std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> window<span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>halfSize<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> halfSize<span class="token punctuation">;</span> <span class="token operator">++</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 检查当前像素是否在原始图像范围内  </span>
                    <span class="token keyword keyword-int">int</span> originalRow <span class="token operator">=</span> i <span class="token operator">-</span> halfSize <span class="token operator">+</span> m<span class="token punctuation">;</span>
                    <span class="token keyword keyword-int">int</span> originalCol <span class="token operator">=</span> j <span class="token operator">-</span> halfSize <span class="token operator">+</span> n<span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>originalRow <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> originalRow <span class="token operator">&lt;</span> rows <span class="token operator">&amp;&amp;</span> originalCol <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> originalCol <span class="token operator">&lt;</span> cols<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        window<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>image<span class="token punctuation">[</span>originalRow<span class="token punctuation">]</span><span class="token punctuation">[</span>originalCol<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 获取平均值并设置到输出图像，四舍五入  </span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 确保窗口不为空  </span>
                filteredImage<span class="token punctuation">[</span>i <span class="token operator">-</span> halfSize<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> halfSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token function">getAverage</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新原图像  </span>
    image <span class="token operator">=</span> filteredImage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 示例：创建一个简单的图像和一个3x3均值滤波器  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> image <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> filterSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token function">meanFilter</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> filterSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印滤波后的图像  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span><span class="token operator">&amp;</span> row <span class="token operator">:</span> image<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> val <span class="token operator">:</span> row<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> val <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725241085064-6a5a5e7e-9fe4-4c71-b59f-381a39983f4f.png" alt="">填充的0不算平均</p>
<h2 id="3高斯滤波">3.高斯滤波 </h2>
<p>基于高斯分布的平滑滤波方法。它认为像素点的邻域内的像素值与中心像素点的距离越近，其权重越大。高斯滤波通过计算高斯函数来赋予邻域内每个像素一个权重，然后使用加权平均来平滑图像。高斯滤波能够更好地保留图像的细节和边缘信息，同时有效地去除噪声。</p>
<p>高斯滤波是一种线性平滑滤波方法，广泛应用于图像处理的减噪过程。它的主要原理是通过对图像中的每个像素应用高斯函数加权平均其邻近像素的值来实现。</p>
<p>高斯滤波器的操作可以描述为：用一个用户指定的模板（也称为卷积核或掩膜）扫描图像中的每一个像素，用模板确定的邻域内像素的加权平均灰度值去替代模板中心像素点的值。这个模板的系数是根据高斯函数生成的，其形状和大小决定了对图像平滑的程度。</p>
<p>高斯函数是一个钟形曲线，其数学表达式为：G(x, y) = 1 / (2πσ^2) * e<sup>-((x</sup>2 + y^2) / (2σ^2))</p>
<p>其中，(x, y) 是像素的坐标，σ 是高斯函数的标准差，G(x, y) 是高斯权重。</p>
<p>这个高斯函数决定了模板的系数，距离模板中心越近，系数越大；距离越远，系数越小。因此，高斯滤波器相比于均值滤波器对图像的模糊程度较小。</p>
<h3 id="opencv调用-2">Opencv调用 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取图像  </span>
    Mat image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"无法加载图像"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化</span>

    Mat gaussianFilteredImage<span class="token punctuation">;</span>
    <span class="token comment">// 核需要是奇数  sigmaX和sigmaY参数默认是0(自动计算）  borderType参数的默认值是cv::BORDER_DEFAULT，零填充</span>
    <span class="token comment">// sigmaX和sigmaY会被设置为核大小的一半减去1，然后再除以2。也就是说，如果核的大小是(5, 5)，则sigmaX和sigmaY会被计算为1.40625（因为(5 - 1) / 2 / 2 = 1.40625）</span>
    <span class="token comment">//GaussianBlur(image, gaussianFilteredImage, Size(29, 29), 0, 0, BORDER_DEFAULT);  //核越大，标准差越大，越模糊</span>
    <span class="token function">GaussianBlur</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> gaussianFilteredImage<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示原图像和滤波后的图像  </span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Gaussian Blurred Image"</span><span class="token punctuation">,</span> gaussianFilteredImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待按键  </span>
    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725241798842-71e074c4-9fd2-47a5-aa63-527d3c1bc06a.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725241807019-13055dda-68dc-401b-9e54-124060265f65.png" alt=""></p>
<h3 id="rngfill生成高斯分布">rng.fill生成高斯分布 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//高斯噪声</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Gaussian_noise</span><span class="token punctuation">(</span>Mat image<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"orign"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//展示原图</span>
    Mat gray<span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat image_noise <span class="token operator">=</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> image<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat gray_noise <span class="token operator">=</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>gray<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> gray<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> gray<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//展示灰度图</span>

    RNG rng<span class="token punctuation">;</span><span class="token comment">//创建一个RNG类      </span>
    rng<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>image_noise<span class="token punctuation">,</span> RNG<span class="token double-colon punctuation">::</span>NORMAL<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成三通道的高斯分布随机数  RNG::NORMAL可能是一个枚举值，指示要生成的随机数的分布类型，这里是正态分布（高斯分布） 均值10和标准差20</span>
    rng<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>gray_noise<span class="token punctuation">,</span> RNG<span class="token double-colon punctuation">::</span>NORMAL<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_noise"</span><span class="token punctuation">,</span> image_noise<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//三通道的高斯噪声</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray_noise"</span><span class="token punctuation">,</span> gray_noise<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//单通道的高斯噪声</span>

    image <span class="token operator">=</span> image <span class="token operator">+</span> image_noise<span class="token punctuation">;</span><span class="token comment">//在彩色图像中添加高斯噪声</span>
    gray <span class="token operator">=</span> gray <span class="token operator">+</span> gray_noise<span class="token punctuation">;</span><span class="token comment">//在灰度图像中添加高斯噪声</span>

    <span class="token comment">//显示添加高斯噪声后的图像</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_Gaussian"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray_Gaussian"</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    Mat image<span class="token punctuation">;</span>
    image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
    <span class="token function">Gaussian_noise</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725241892600-a5a12455-9710-4a90-bf35-62753df6cf43.png" alt=""></p>
<h3 id="高斯滤波原理">高斯滤波原理 </h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242024960-e2380cc1-689d-4a42-b658-ca347da02ef7.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//C++实现高斯滤波</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//1 高斯滤波</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> Sigma<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//保证高斯核大小为大于等于3的奇数</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gauss_size <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> Gauss_size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span> Gauss_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Gauss_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">//生成高斯卷积核</span>
    <span class="token keyword keyword-double">double</span><span class="token operator">*</span><span class="token operator">*</span> Gausskernel <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-double">double</span><span class="token operator">*</span> <span class="token punctuation">[</span>Gauss_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">[</span>Gauss_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-int">int</span> center <span class="token operator">=</span> Gauss_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Sigma <span class="token operator">*</span> Sigma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sum <span class="token operator">+=</span> Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//高斯卷积核归一化</span>
    <span class="token keyword keyword-double">double</span> sum1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> sum<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*=</span> sum1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//滤波</span>
    Mat tem_image <span class="token operator">=</span> input_image<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> rows <span class="token operator">=</span> input_image<span class="token punctuation">.</span>rows <span class="token operator">-</span> center<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> cols <span class="token operator">=</span> input_image<span class="token punctuation">.</span>cols <span class="token operator">-</span> center<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> center<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> center<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cols<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>center<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> center<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>center<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> center<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    sum <span class="token operator">+=</span> Gausskernel<span class="token punctuation">[</span>center <span class="token operator">+</span> m<span class="token punctuation">]</span><span class="token punctuation">[</span>center <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">*</span> input_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> m<span class="token punctuation">,</span> j <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            tem_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    output_image <span class="token operator">=</span> tem_image<span class="token punctuation">;</span>

    <span class="token comment">//释放内存</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Gausskernel<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取图像</span>
    Mat image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"无法加载图像"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//灰度化</span>

    Mat gaussianFilteredImage<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> Gauss_size <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> Sigma <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
    <span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> gaussianFilteredImage<span class="token punctuation">,</span> Gauss_size <span class="token punctuation">,</span> Sigma<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示原图像和滤波后的图像</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Gaussian Blurred Image"</span><span class="token punctuation">,</span> gaussianFilteredImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待按键</span>
    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242547492-67a8b68a-01a4-49f1-81bc-b4b50aae8ff3.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242553931-4395dcf3-dfb3-4240-8455-7899e527f718.png" alt=""></p>
<h1 id="图像锐化">图像锐化 </h1>
<p>图像锐化（通过微分过程使得图像边缘突出、清晰）</p>
<p>锐化通常称为高通滤波。此时，通过(负责细节的)高频，而衰减或抑制低频。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242658073-604e0e6c-7ace-4032-8421-ba5b556834f6.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242669233-27327d5b-4210-4e64-bcae-430d1eb437a8.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242679496-12948cba-e497-41f3-b2ea-ba9cd286c689.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242691784-de94f95e-bc07-47b8-8595-796d61021eac.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242701472-705a14f2-2fc4-40aa-91e1-63f357b31ad6.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242713357-c0f0741e-672b-4e59-b3b2-9b36d7b41233.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242806498-e1166550-d392-4e22-8350-040f9afdbb9c.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242778243-947e057a-4ecd-41a1-915e-ae255bbf2518.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242855090-5de558a9-881f-487d-bc7f-1c76cca312ff.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242829047-3729a2c1-cb70-44ff-b940-3cafe8d3e664.png" alt=""></p>
<h2 id="1laplacian锐化">1.Laplacian锐化 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242897507-7b5ae3e9-1807-4b0e-9442-d0f81483d102.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725242930490-dd0a3f4c-966c-482a-80d0-e176d1253dc9.png" alt=""></p>
<h3 id="cvfilter2d应用拉普拉斯核">cv::filter2D应用拉普拉斯核 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 读取图像  </span>
	cv<span class="token double-colon punctuation">::</span>Mat srcImage <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_COLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>srcImage<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"无法读取图像"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 创建拉普拉斯滤波器  </span>
	<span class="token comment">//cv::Mat laplacianKernel = (cv::Mat_&lt;float&gt;(3, 3) &lt;&lt; 0, 1, 0, 1, -4, 1, 0, 1, 0);</span>
	<span class="token comment">// 创建锐化滤波器（拉普拉斯算子）   调整中心值为5大于周围的值，可以在边缘处产生更大正的响应</span>
	cv<span class="token double-colon punctuation">::</span>Mat laplacianKernel <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 应用拉普拉斯滤波器  </span>
	cv<span class="token double-colon punctuation">::</span>Mat dstImage<span class="token punctuation">;</span>
	<span class="token comment">// void cv::filter2D(InputArray src, OutputArray dst, int ddepth, InputArray kernel, Point anchor=Point(-1,-1), double delta=0, int borderType=BORDER_DEFAULT)</span>
	<span class="token comment">// 该函数允许你使用自定义的卷积核（或称为滤波器、核）来对图像进行卷积处理，从而实现各种图像处理效果，如锐化、模糊、边缘检测等</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">filter2D</span><span class="token punctuation">(</span>srcImage<span class="token punctuation">,</span> dstImage<span class="token punctuation">,</span> srcImage<span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> laplacianKernel<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//ddepth设置为 -1，则输出图像将具有与原图像相同的数据类型和深度</span>

	<span class="token comment">// 将滤波后的图像与原始图像相加，实现锐化效果  </span>
	cv<span class="token double-colon punctuation">::</span>Mat sharpenedImage <span class="token operator">=</span> srcImage <span class="token operator">+</span> dstImage<span class="token punctuation">;</span>

	<span class="token comment">// 显示原始图像和锐化后的图像  </span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> srcImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Sharpened Image"</span><span class="token punctuation">,</span> sharpenedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 等待用户按键，然后关闭窗口  </span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243148207-a86da253-8725-4584-b926-35e9a774236e.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243154813-a841f94e-e436-4824-a190-25b10053d0d0.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243162250-957adf7a-62b5-4122-bfb9-604306ac6be2.png" alt=""></p>
<h3 id="相邻像素之间的差分等效">相邻像素之间的差分等效 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//定义滤波函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">myfilter</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image_input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> image_output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//四邻域</span>
<span class="token keyword keyword-void">void</span> <span class="token function">myfilter2</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image_input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> image_output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//八邻域</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_output<span class="token punctuation">,</span> image_output2<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像，输出图像</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//自编函数</span>
	<span class="token function">myfilter</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//4邻域</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_output"</span><span class="token punctuation">,</span> image_output<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">myfilter2</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_output2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//8邻域</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_output2"</span><span class="token punctuation">,</span> image_output2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-void">void</span> <span class="token function">myfilter</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image_input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> image_output<span class="token punctuation">)</span> <span class="token comment">//4</span>
<span class="token punctuation">{</span>
	image_output <span class="token operator">=</span> image_input<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> la<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>image_input<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>image_input<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//这行代码计算了像素 (i, j) 及其四个相邻像素（上、下、左、右）之间的差分。利用像素及其邻域之间的差分来增强图像中的边缘信息</span>
			<span class="token comment">//具体来说，它计算了中心像素值的四倍减去其四个相邻像素值的和。这个操作类似于一个离散微分或拉普拉斯算子，用于检测图像中的边缘或快速变化区域。</span>
			la <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			image_output<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">saturate_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>image_output<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> la<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">myfilter2</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image_input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> image_output<span class="token punctuation">)</span> <span class="token comment">//8</span>
<span class="token punctuation">{</span>
	image_output <span class="token operator">=</span> image_input<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> la2<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>image_input<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>image_input<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			la2 <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> image_input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			image_output<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">saturate_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>image_output<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> la2<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243543899-b07bb62b-1cbd-4eeb-a060-400630d2e833.png" alt=""></p>
<h2 id="2梯度锐化">2.梯度锐化 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243640227-a8ae393b-d607-4b3d-a487-6abc9e5e5b43.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243744217-b793d474-910d-439b-b8d7-5d7aa6a0f9b4.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//定义一个梯度算子矩阵，通常使用Prewitt算子、Sobel算子或Roberts算子等</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取图像  </span>
    cv<span class="token double-colon punctuation">::</span>Mat src <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用灰度图像  </span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"无法读取图像"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义Sobel算子矩阵 (3x3)  </span>
    cv<span class="token double-colon punctuation">::</span>Mat sobelX <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token double-colon punctuation">::</span>Mat sobelY <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token double-colon punctuation">::</span>Mat dstX<span class="token punctuation">,</span> dstY<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">filter2D</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dstX<span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sobelX<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//ddepth设置为 -1，则输出图像将具有与原图像相同的数据类型和深度</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">filter2D</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dstY<span class="token punctuation">,</span> src<span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sobelY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 将滤波后的图像与原始图像相加，实现锐化效果  </span>
    cv<span class="token double-colon punctuation">::</span>Mat sharpenedImageX <span class="token operator">=</span> src <span class="token operator">+</span> dstX<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat sharpenedImageY <span class="token operator">=</span> src <span class="token operator">+</span> dstY<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat sharpenedImage <span class="token operator">=</span> src <span class="token operator">+</span> dstX <span class="token operator">+</span> dstY<span class="token punctuation">;</span>

    <span class="token comment">// 显示原始图像和梯度幅度图像  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Gradient MagnitudeX"</span><span class="token punctuation">,</span> sharpenedImageX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Gradient MagnitudeY"</span><span class="token punctuation">,</span> sharpenedImageY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Gradient Magnitude"</span><span class="token punctuation">,</span> sharpenedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待用户按键，然后关闭窗口  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243917992-d6e2da3b-5bb9-4f93-bf4e-4e55a2be18b6.png" alt="">  <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243933870-e420a8ef-75a8-4800-a599-69fbf4b7e0b4.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243942428-10ed6a37-6b1f-4a06-963c-1a131b6e3f6f.png" alt="">  <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725243949970-fb981556-ca06-42c8-b0fc-a80ca1e50684.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取图像（假设为灰度图）  </span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Error: Image not found."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将输入图像转换为浮点型  </span>
    cv<span class="token double-colon punctuation">::</span>Mat imageFloat<span class="token punctuation">;</span>
    image<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>imageFloat<span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算x方向和y方向的梯度  </span>
    cv<span class="token double-colon punctuation">::</span>Mat grad_x<span class="token punctuation">,</span> grad_y<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat sobelX <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sobel X滤波器  </span>
    cv<span class="token double-colon punctuation">::</span>Mat sobelY <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sobel Y滤波器  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">filter2D</span><span class="token punctuation">(</span>imageFloat<span class="token punctuation">,</span> grad_x<span class="token punctuation">,</span> CV_32F<span class="token punctuation">,</span> sobelX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">filter2D</span><span class="token punctuation">(</span>imageFloat<span class="token punctuation">,</span> grad_y<span class="token punctuation">,</span> CV_32F<span class="token punctuation">,</span> sobelY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算梯度的平方  </span>
    cv<span class="token double-colon punctuation">::</span>Mat grad_x2<span class="token punctuation">,</span> grad_y2<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">multiply</span><span class="token punctuation">(</span>grad_x<span class="token punctuation">,</span> grad_x<span class="token punctuation">,</span> grad_x2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显式指定输出类型为CV_32F  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">multiply</span><span class="token punctuation">(</span>grad_y<span class="token punctuation">,</span> grad_y<span class="token punctuation">,</span> grad_y2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显式指定输出类型为CV_32F  </span>

    <span class="token comment">// 求和并开方计算梯度幅度  </span>
    cv<span class="token double-colon punctuation">::</span>Mat grad_magnitude<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">add</span><span class="token punctuation">(</span>grad_x2<span class="token punctuation">,</span> grad_y2<span class="token punctuation">,</span> grad_magnitude<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显式指定输出类型为CV_32F  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">sqrt</span><span class="token punctuation">(</span>grad_magnitude<span class="token punctuation">,</span> grad_magnitude<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 梯度幅度已经是浮点型，无需再次指定  </span>

    <span class="token comment">// 归一化到显示范围（可选）  </span>
    cv<span class="token double-colon punctuation">::</span>Mat grad_magnitude_normalized<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>grad_magnitude<span class="token punctuation">,</span> grad_magnitude_normalized<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>NORM_MINMAX<span class="token punctuation">,</span> CV_8U<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 将梯度幅度与原始图像相加，实现锐化效果</span>
    cv<span class="token double-colon punctuation">::</span>Mat sharpenedImage <span class="token operator">=</span> image <span class="token operator">+</span> grad_magnitude_normalized<span class="token punctuation">;</span>

    <span class="token comment">// 显示结果  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Gradient Magnitude"</span><span class="token punctuation">,</span> grad_magnitude_normalized<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sharpened_img"</span><span class="token punctuation">,</span> sharpenedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待按键  </span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244084284-6d2fec90-db9f-4eec-8263-69698be899a9.png" alt=""></p>
<p>梯度：梯度表示图像中某一点处的亮度变化方向和速率。在图像处理中，梯度常用于检测图像中的强度或颜色的变化程度。梯度可以通过各种梯度算子（如Sobel、Prewitt、Scharr等）来计算。梯度图像可以显示图像中所有位置的亮度变化程度和方向。</p>
<p>边缘：边缘是图像中亮度变化显著的地方，通常是物体的轮廓或物体之间的边界。边缘检测是图像处理中的一个重要任务，用于识别图像中的不连续点或剧烈变化点。边缘检测算法（如Canny、Roberts、Laplacian等）通常基于梯度信息来工作，因为边缘处通常伴随着亮度的剧烈变化。</p>
<p>虽然梯度和边缘都与图像中的亮度变化有关，但它们并不相同。梯度更关注于亮度变化的方向和速率，而边缘则更关注于亮度变化的位置和强度。梯度图像包含了图像中所有位置的亮度变化信息，而边缘图像则只显示亮度变化显著的位置。</p>
<p>在实际应用中，梯度信息通常用于计算边缘，因为边缘处伴随着亮度的剧烈变化。</p>
<h1 id="频率域图像增强">频率域图像增强 </h1>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244567724-810643b1-b593-4e87-b395-31af58a5a2bc.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244577588-0a3b93a6-9c30-4b73-9f75-60ecd91e0eca.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244591165-ad35ad33-f9ba-4125-8154-a2b2b87560ce.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244599198-7a3c48c9-4e9e-4a8e-9929-a46a0ef5cff1.png" alt=""></p>
<p><a href="https://www.bilibili.com/video/BV1A4411Y7vj/?spm_id_from=333.999.0.0&amp;vd_source=9741da01eb5597a19fd0610df71471cc">傅立叶变换如何理解？美颜和变声都是什么原理？李永乐老师告诉你_哔哩哔哩_bilibili</a></p>
<p><a href="https://www.bilibili.com/video/BV1pW411J7s8/?spm_id_from=333.999.0.0&amp;vd_source=9741da01eb5597a19fd0610df71471cc">【官方双语】形象展示傅里叶变换_哔哩哔哩_bilibili</a></p>
<p>人的大脑可以快速进行傅里叶变换，比如不同人说话声音不同，听到低频时可能是个男人，听到高频时可能是个女人。又比如看人时，人的大脑首先快速傅里叶变换，看低频（整体的轮廓），然后再仔细看看这个人漂不漂亮（看高频细节，例如皱纹、斑点、眼睛等）。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244906690-3f46a946-6fb9-4020-871a-19ba888d5ec7.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244915236-8b5d2d7e-3b93-42dd-88d0-aa1cee8c0d79.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244927820-04218f62-b3ea-4710-b654-d896cedc3946.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244990000-173992bc-72e4-4c90-ab56-25bae728acfa.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725244998683-a2c417cb-8aa7-447b-9658-4974e56d04ca.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245012356-1f3b7c28-7693-4a67-888b-157456f7c4b4.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245023005-cc176841-fede-43de-9f41-83e75f6a642b.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245029624-cf543bf0-ce61-4785-b1d6-02e20d649b52.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245080310-dc8493db-9a69-4f6a-986a-91dbdb321e48.png" alt=""></p>
<h2 id="1傅里叶变换及频谱图">1.傅里叶变换及频谱图 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245164389-656f6e61-64c5-4560-a530-b979b3f99061.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cmath&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>


<span class="token comment">//定义傅里叶变换函数。input_image：输入图像；output_image：傅里叶频谱图；transform_array:傅里叶变换矩阵（复数）</span>
<span class="token keyword keyword-void">void</span> <span class="token function">My_DFT</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> transform_array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_output<span class="token punctuation">,</span> image_transform<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像，输出图像</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为灰度图</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示灰度图</span>

	<span class="token comment">//傅里叶变换，image_output为可显示的频谱图，image_transform为傅里叶变换的复数结果</span>
	<span class="token function">My_DFT</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_output<span class="token punctuation">,</span> image_transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_output"</span><span class="token punctuation">,</span> image_output<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//傅里叶变换得到频谱图和复数域结果</span>
<span class="token keyword keyword-void">void</span> <span class="token function">My_DFT</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> transform_image<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//1.扩展图像矩阵，为2，3，5的倍数时运算速度快     通过copyMakeBorder函数在图像周围添加零填充</span>
	<span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token function">getOptimalDFTSize</span><span class="token punctuation">(</span>input_image<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token function">getOptimalDFTSize</span><span class="token punctuation">(</span>input_image<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">copyMakeBorder</span><span class="token punctuation">(</span>input_image<span class="token punctuation">,</span> input_image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m <span class="token operator">-</span> input_image<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span> input_image<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> BORDER_CONSTANT<span class="token punctuation">,</span> <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2.创建一个双通道矩阵planes，用来储存复数的实部与虚部</span>
	Mat planes<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>input_image<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>input_image<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//3.从多个单通道数组中创建一个多通道数组:transform_image。函数Merge将几个数组合并为一个多通道阵列，即输出数组的每个元素将是输入数组元素的级联</span>
	<span class="token function">merge</span><span class="token punctuation">(</span>planes<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> transform_image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//4.进行傅立叶变换</span>
	<span class="token function">dft</span><span class="token punctuation">(</span>transform_image<span class="token punctuation">,</span> transform_image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//5.计算复数的幅值，保存在output_image（频谱图）</span>
	<span class="token function">split</span><span class="token punctuation">(</span>transform_image<span class="token punctuation">,</span> planes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将双通道分为两个单通道，一个表示实部，一个表示虚部</span>
	<span class="token function">magnitude</span><span class="token punctuation">(</span>planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output_image<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算复数的幅值，保存在output_image（频谱图）</span>

	<span class="token comment">//6.前面得到的频谱图数级过大，不好显示，因此转换</span>
	output_image <span class="token operator">+=</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 取对数前将所有的像素都加1，防止log0</span>
	<span class="token function">log</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> output_image<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 取对数</span>
	<span class="token function">normalize</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> output_image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//归一化</span>

	<span class="token comment">//7.剪切和重分布幅度图像限</span>
	output_image <span class="token operator">=</span> <span class="token function">output_image</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> output_image<span class="token punctuation">.</span>cols <span class="token operator">&amp;</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> output_image<span class="token punctuation">.</span>rows <span class="token operator">&amp;</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 重新排列傅里叶图像中的象限，使原点位于图像中心</span>
	<span class="token keyword keyword-int">int</span> cx <span class="token operator">=</span> output_image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> cy <span class="token operator">=</span> output_image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	Mat <span class="token function">q0</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 左上区域</span>
	Mat <span class="token function">q1</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 右上区域</span>
	Mat <span class="token function">q2</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 左下区域</span>
	Mat <span class="token function">q3</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 右下区域</span>

	<span class="token comment">//交换象限中心化</span>
	Mat tmp<span class="token punctuation">;</span>
	q0<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q3<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q0<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左上与右下进行交换   将直流低频分量移动到中心</span>
	q1<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q2<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q1<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右上与左下进行交换   确保高频分量对称地分布在中心周围	</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245273346-e3a864e6-439b-4e65-953e-d919e5785154.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245281984-22b190a4-cbe2-401f-8996-71a9b18a8f41.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245293366-36df0738-7728-4a6d-84f9-5ad4338da081.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245307407-b9b6e748-9508-499b-bd1c-c80ae2608234.png" alt=""></p>
<p>频率是指图像中像素值变化的快慢程度，通常与图像的细节和纹理有关。在傅里叶变换中，频率是指图像中不同频率分量的强度分布，与灰度级没有直接关系。在频谱图中，低频分量通常对应于图像中变化缓慢的部分，如整体亮度、颜色等，而高频分量则对应于图像中变化快速的部分，如边缘、纹理等。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245397716-606eec2d-49cc-4526-a1a8-772a0db5fc54.png" alt=""></p>
<h3 id="特别篇copymakeborder函数">特别篇：copyMakeBorder函数 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">/*
 copyMakeBorder 函数是 OpenCV 中用于在图像边界添加像素的函数。它可以扩展图像的边界，通常用于在图像预处理步骤中，如卷积、滤波或傅里叶变换等，其中算法需要比原始图像更大的空间。
 void copyMakeBorder(InputArray src, OutputArray dst, int top, int bottom, int left, int right, int borderType, const Scalar&amp; value = Scalar() )

参数解释：

src: 输入图像。
dst: 输出图像，大小比输入图像大，包含了边界。
top, bottom, left, right: 分别表示在图像的上、下、左、右四个方向要添加的像素数。
borderType: 边界类型，决定了如何添加像素。OpenCV 提供了几种预定义的边界类型，
			如 BORDER_CONSTANT（用常数颜色填充）、BORDER_REPLICATE（复制图像边缘的像素）、BORDER_REFLECT（反射图像边缘的像素）等。
value: 当 borderType 设置为 BORDER_CONSTANT 时，这个参数指定了用于填充边界的常数颜色或值。
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 读取图像  </span>
	cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Could not open or find the image"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 创建一个与原始图像同样类型的新图像，大小增加了 10 像素（5 像素在顶部和底部，5 像素在左侧和右侧）  </span>
	cv<span class="token double-colon punctuation">::</span>Mat borderedImage <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 使用 copyMakeBorder 在新图像上添加黑色边框  </span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">copyMakeBorder</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> borderedImage<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>BORDER_CONSTANT<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 显示原始图像和带有边框的图像  </span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Image with Border"</span><span class="token punctuation">,</span> borderedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245567712-cd32bc36-9936-4bd2-9b9f-5e5a616b170c.png" alt=""></p>
<h2 id="2低通滤波">2.低通滤波 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token comment">//#include "MY_DFT.h"</span>
<span class="token comment">//#include "Salt.h"</span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>

<span class="token comment">// 噪声代码</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Salt</span><span class="token punctuation">(</span>Mat image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	default_random_engine generater<span class="token punctuation">;</span>
	uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token function">randomRow</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span><span class="token function">randomCol</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		i <span class="token operator">=</span> <span class="token function">randomCol</span><span class="token punctuation">(</span>generater<span class="token punctuation">)</span><span class="token punctuation">;</span>
		j <span class="token operator">=</span> <span class="token function">randomRow</span><span class="token punctuation">(</span>generater<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">channels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vec3b<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 傅里叶变换代码</span>
<span class="token comment">//傅里叶变换得到频谱图和复数域结果</span>
<span class="token keyword keyword-void">void</span> <span class="token function">My_DFT</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> transform_image<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//1.扩展图像矩阵，为2，3，5的倍数时运算速度快</span>
	<span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token function">getOptimalDFTSize</span><span class="token punctuation">(</span>input_image<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token function">getOptimalDFTSize</span><span class="token punctuation">(</span>input_image<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">copyMakeBorder</span><span class="token punctuation">(</span>input_image<span class="token punctuation">,</span> input_image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m <span class="token operator">-</span> input_image<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span> input_image<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> BORDER_CONSTANT<span class="token punctuation">,</span> <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2.创建一个双通道矩阵planes，用来储存复数的实部与虚部</span>
	Mat planes<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>input_image<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>input_image<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//3.从多个单通道数组中创建一个多通道数组:transform_image。函数Merge将几个数组合并为一个多通道阵列，即输出数组的每个元素将是输入数组元素的级联</span>
	<span class="token function">merge</span><span class="token punctuation">(</span>planes<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> transform_image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//4.进行傅立叶变换</span>
	<span class="token function">dft</span><span class="token punctuation">(</span>transform_image<span class="token punctuation">,</span> transform_image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//5.计算复数的幅值，保存在output_image（频谱图）</span>
	<span class="token function">split</span><span class="token punctuation">(</span>transform_image<span class="token punctuation">,</span> planes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将双通道分为两个单通道，一个表示实部，一个表示虚部</span>
	Mat transform_image_real <span class="token operator">=</span> planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	Mat transform_image_imag <span class="token operator">=</span> planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token function">magnitude</span><span class="token punctuation">(</span>planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output_image<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算复数的幅值，保存在output_image（频谱图）</span>

	<span class="token comment">//6.前面得到的频谱图数级过大，不好显示，因此转换</span>
	output_image <span class="token operator">+=</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 取对数前将所有的像素都加1，防止log0</span>
	<span class="token function">log</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> output_image<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 取对数</span>
	<span class="token function">normalize</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> output_image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//归一化</span>

	<span class="token comment">//7.剪切和重分布幅度图像限</span>
	output_image <span class="token operator">=</span> <span class="token function">output_image</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> output_image<span class="token punctuation">.</span>cols <span class="token operator">&amp;</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> output_image<span class="token punctuation">.</span>rows <span class="token operator">&amp;</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 重新排列傅里叶图像中的象限，使原点位于图像中心</span>
	<span class="token keyword keyword-int">int</span> cx <span class="token operator">=</span> output_image<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> cy <span class="token operator">=</span> output_image<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	Mat <span class="token function">q0</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 左上区域</span>
	Mat <span class="token function">q1</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 右上区域</span>
	Mat <span class="token function">q2</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 左下区域</span>
	Mat <span class="token function">q3</span><span class="token punctuation">(</span>output_image<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 右下区域</span>

	<span class="token comment">//交换象限中心化 得到频谱图</span>
	Mat tmp<span class="token punctuation">;</span>
	q0<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q3<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q0<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左上与右下进行交换</span>
	q1<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q2<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q1<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右上与左下进行交换</span>

	<span class="token comment">//得到复数结果</span>
	Mat <span class="token function">q00</span><span class="token punctuation">(</span>transform_image_real<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 左上区域</span>
	Mat <span class="token function">q01</span><span class="token punctuation">(</span>transform_image_real<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 右上区域</span>
	Mat <span class="token function">q02</span><span class="token punctuation">(</span>transform_image_real<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 左下区域</span>
	Mat <span class="token function">q03</span><span class="token punctuation">(</span>transform_image_real<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 右下区域</span>
	q00<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q03<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q00<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q03<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左上与右下进行交换</span>
	q01<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q02<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q01<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q02<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右上与左下进行交换</span>

	Mat <span class="token function">q10</span><span class="token punctuation">(</span>transform_image_imag<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 左上区域</span>
	Mat <span class="token function">q11</span><span class="token punctuation">(</span>transform_image_imag<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 右上区域</span>
	Mat <span class="token function">q12</span><span class="token punctuation">(</span>transform_image_imag<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 左下区域</span>
	Mat <span class="token function">q13</span><span class="token punctuation">(</span>transform_image_imag<span class="token punctuation">,</span> <span class="token function">Rect</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 右下区域</span>
	q10<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q13<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q10<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q13<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左上与右下进行交换</span>
	q11<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> q12<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q11<span class="token punctuation">)</span><span class="token punctuation">;</span> tmp<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>q12<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//右上与左下进行交换</span>

	<span class="token comment">// 合并实部和虚部</span>
	planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> transform_image_real<span class="token punctuation">;</span>
	planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> transform_image_imag<span class="token punctuation">;</span>
	<span class="token function">merge</span><span class="token punctuation">(</span>planes<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> transform_image<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将傅里叶变换结果中心化</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="理想低通滤波">理想低通滤波 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 1、频率域滤波--低通滤波--理想低通滤波</span>
<span class="token comment">// 基本原理：通过设置频率半径，半径内的频率大小不变，半径外的频率置为0，即保留了低频区，滤除了高频区，达到滤波的目的。</span>
<span class="token comment">// 理想低通滤波会导致振铃效应，因此现实很少使用理想低通滤波器，多使用高斯低通滤波或巴特沃斯低通滤波。</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_output<span class="token punctuation">,</span> image_transform<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像，输出图像</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为灰度图</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示灰度图</span>

	<span class="token function">Salt</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"noise_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示噪声图</span>


	<span class="token comment">//1、傅里叶变换，image_output为可显示的频谱图，image_transform为傅里叶变换的复数结果</span>
	<span class="token function">My_DFT</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_output<span class="token punctuation">,</span> image_transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_output"</span><span class="token punctuation">,</span> image_output<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2、理想低通滤波</span>
	Mat planes<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>image_output<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>image_output<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CV_32F<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">split</span><span class="token punctuation">(</span>image_transform<span class="token punctuation">,</span> planes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//分离通道，获取实部虚部</span>
	Mat image_transform_real <span class="token operator">=</span> planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	Mat image_transform_imag <span class="token operator">=</span> planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> core_x <span class="token operator">=</span> image_transform_real<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//频谱图中心坐标</span>
	<span class="token keyword keyword-int">int</span> core_y <span class="token operator">=</span> image_transform_real<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> r <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token comment">//滤波半径</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> image_transform_real<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> image_transform_real<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//距离中心的距离大于设置半径r的点所在值设为0</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> core_x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> core_x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> core_y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> core_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> r <span class="token operator">*</span> r<span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				image_transform_real<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				image_transform_imag<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> image_transform_real<span class="token punctuation">;</span>
	planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> image_transform_imag<span class="token punctuation">;</span>
	Mat image_transform_ilpf<span class="token punctuation">;</span><span class="token comment">//定义理想低通滤波矩阵</span>
	<span class="token function">merge</span><span class="token punctuation">(</span>planes<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> image_transform_ilpf<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//3、傅里叶逆变换</span>
	Mat iDft<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>image_output<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span>image_output<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CV_32F<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">idft</span><span class="token punctuation">(</span>image_transform_ilpf<span class="token punctuation">,</span> image_transform_ilpf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//傅立叶逆变换</span>
	<span class="token function">split</span><span class="token punctuation">(</span>image_transform_ilpf<span class="token punctuation">,</span> iDft<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//分离通道，主要获取0通道</span>
	<span class="token function">magnitude</span><span class="token punctuation">(</span>iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iDft<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算复数的幅值，保存在iDft[0]</span>
	<span class="token function">normalize</span><span class="token punctuation">(</span>iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//归一化处理</span>

	<span class="token comment">// 提取与原始图像相同大小的区域  </span>
	iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> image<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"idft"</span><span class="token punctuation">,</span> iDft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示逆变换图像</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725245750847-9dd21b5f-800f-474d-aa17-3949132f6c78.png" alt=""></p>
<h3 id="高斯低通滤波">高斯低通滤波 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 2、频率域滤波--低通滤波--高斯低通滤波</span>
<span class="token comment">// 理想低通滤波会导致振铃效应，高斯低通滤波则没有。但是高斯低通滤波不好控制低与高频的过度部分。巴特沃斯低通滤波器可以通过调整系数进行控制。</span>

<span class="token comment">/**
int main()
{
	Mat image, image_gray, image_output, image_transform;   //定义输入图像，灰度图像，输出图像
	image = imread("cat.jpg");  //读取图像；
	if (image.empty())
	{
		cout &lt;&lt; "读取错误" &lt;&lt; endl;
		return -1;
	}
	imshow("image", image);

	cvtColor(image, image_gray, COLOR_BGR2GRAY); //转换为灰度图
	imshow("image_gray", image_gray); //显示灰度图

	Salt(image_gray, 1000);
	imshow("noise_gray", image_gray); //显示噪声图


	//1、傅里叶变换，image_output为可显示的频谱图，image_transform为傅里叶变换的复数结果
	My_DFT(image_gray, image_output, image_transform);
	imshow("image_output", image_output);

	//2、高斯低通滤波
	Mat planes[] = { Mat_&lt;float&gt;(image_output), Mat::zeros(image_output.size(),CV_32F) };
	split(image_transform, planes);//分离通道，获取实部虚部
	Mat image_transform_real = planes[0];
	Mat image_transform_imag = planes[1];

	int core_x = image_transform_real.rows / 2;//频谱图中心坐标
	int core_y = image_transform_real.cols / 2;
	int r = 60;  //滤波半径
	float h;   //权重值h随着点到频谱中心的距离的增加而减小,离中心越远的点（对应高频成分），乘以的权重值越小，因此它们对滤波后图像的影响就越小
	for (int i = 0; i &lt; image_transform_real.rows; i++)
	{
		for (int j = 0; j &lt; image_transform_real.cols; j++)
		{
			h = exp(-((i - core_x) * (i - core_x) + (j - core_y) * (j - core_y)) / (2 * r * r));
			image_transform_real.at&lt;float&gt;(i, j) = image_transform_real.at&lt;float&gt;(i, j) * h;
			image_transform_imag.at&lt;float&gt;(i, j) = image_transform_imag.at&lt;float&gt;(i, j) * h;

		}
	}
	planes[0] = image_transform_real;
	planes[1] = image_transform_imag;
	Mat image_transform_ilpf;//定义高斯低通滤波结果
	merge(planes, 2, image_transform_ilpf);

	//3、傅里叶逆变换
	Mat iDft[] = { Mat_&lt;float&gt;(image_output), Mat::zeros(image_output.size(),CV_32F) };
	idft(image_transform_ilpf, image_transform_ilpf);//傅立叶逆变换
	split(image_transform_ilpf, iDft);//分离通道，主要获取0通道
	magnitude(iDft[0], iDft[1], iDft[0]); //计算复数的幅值，保存在iDft[0]
	normalize(iDft[0], iDft[0], 0, 1, NORM_MINMAX);//归一化处理

	// 提取与原始图像相同大小的区域
	iDft[0] = iDft[0](Rect(0, 0, image.cols, image.rows));
	imshow("idft", iDft[0]);//显示逆变换图像

	waitKey(0);  //暂停，保持图像显示，等待按键结束
	return 0;
}
</span></code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246204838-8e210d01-eab3-4d62-81b6-4a576ba07de9.png" alt=""></p>
<h3 id="巴特沃斯低通滤波">巴特沃斯低通滤波 </h3>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 3、频率域滤波--低通滤波--巴特沃斯低通滤波</span>
<span class="token comment">// 理想低通滤波会导致振铃效应，高斯低通滤波则没有。但是高斯低通滤波不好控制低与高频的过度部分。巴特沃斯低通滤波器可以通过调整系数进行控制。</span>

<span class="token comment">/***
int main()
{
	Mat image, image_gray, image_output, image_transform;   //定义输入图像，灰度图像，输出图像
	image = imread("cat.jpg");  //读取图像；
	if (image.empty())
	{
		cout &lt;&lt; "读取错误" &lt;&lt; endl;
		return -1;
	}
	imshow("image", image);

	cvtColor(image, image_gray, COLOR_BGR2GRAY); //转换为灰度图
	imshow("image_gray", image_gray); //显示灰度图

	Salt(image_gray, 1000);
	imshow("noise_gray", image_gray); //显示噪声图


	//1、傅里叶变换，image_output为可显示的频谱图，image_transform为傅里叶变换的复数结果
	My_DFT(image_gray, image_output, image_transform);
	imshow("image_output", image_output);

	//2、巴特沃斯低通滤波
	Mat planes[] = { Mat_&lt;float&gt;(image_output), Mat::zeros(image_output.size(),CV_32F) };
	split(image_transform, planes);//分离通道，获取实部虚部
	Mat image_transform_real = planes[0];
	Mat image_transform_imag = planes[1];

	int core_x = image_transform_real.rows / 2;//频谱图中心坐标
	int core_y = image_transform_real.cols / 2;
	int r = 60;  //滤波半径
	float h;
	float n = 2; //巴特沃斯系数
	float D;  //距离中心距离
	for (int i = 0; i &lt; image_transform_real.rows; i++)
	{
		for (int j = 0; j &lt; image_transform_real.cols; j++)
		{
			D = (i - core_x) * (i - core_x) + (j - core_y) * (j - core_y);
			h = 1 / (1 + pow((D / (r * r)), n));
			image_transform_real.at&lt;float&gt;(i, j) = image_transform_real.at&lt;float&gt;(i, j) * h;
			image_transform_imag.at&lt;float&gt;(i, j) = image_transform_imag.at&lt;float&gt;(i, j) * h;

		}
	}
	planes[0] = image_transform_real;
	planes[1] = image_transform_imag;
	Mat image_transform_ilpf;//定义巴特沃斯低通滤波结果
	merge(planes, 2, image_transform_ilpf);

	//3、傅里叶逆变换
	Mat iDft[] = { Mat_&lt;float&gt;(image_output), Mat::zeros(image_output.size(),CV_32F) };
	idft(image_transform_ilpf, image_transform_ilpf);//傅立叶逆变换
	split(image_transform_ilpf, iDft);//分离通道，主要获取0通道
	magnitude(iDft[0], iDft[1], iDft[0]); //计算复数的幅值，保存在iDft[0]
	normalize(iDft[0], iDft[0], 0, 1, NORM_MINMAX);//归一化处理

	// 提取与原始图像相同大小的区域
	iDft[0] = iDft[0](Rect(0, 0, image.cols, image.rows));
	imshow("idft", iDft[0]);//显示逆变换图像

	waitKey(0);  //暂停，保持图像显示，等待按键结束
	return 0;
}
</span></code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246136820-109ae8fc-7a9a-4bc5-adc9-7954c46ccc46.png" alt=""></p>
<h1 id="形态学图像处理">形态学图像处理 </h1>
<p>膨胀、腐蚀、开运算和闭运算是数字图像处理中的形态学操作，主要用于对二值图像进行处理。以下是它们的主要功能和用途：</p>
<p>膨胀（Dilation）：膨胀是将与图像中白色像素（前景）接触的所有背景像素变为白色。换句话说，它会扩大白色区域。这种操作常用于填补物体内部的小孔或细长的凹陷。</p>
<p>腐蚀（Erosion）：与膨胀相反，腐蚀是将与图像中白色像素（前景）接触的所有背景像素变为黑色。这会导致白色区域缩小。腐蚀常用于消除小的白色噪声点或断开连接的对象。</p>
<p>开运算（Opening）：开运算是先腐蚀后膨胀的操作。这种操作常用于消除小的白色对象或噪声，而不显著改变较大对象的大小。</p>
<p>闭运算（Closing）：闭运算是先膨胀后腐蚀的操作。这种操作常用于填补物体内部的小孔或细长凹陷，同时不显著改变较大对象的大小。</p>
<p>这些操作在图像处理和计算机视觉中非常有用，例如，用于分割、噪声消除、对象识别和形状分析。通过选择合适的结构元素（通常是3x3或5x5的矩形或椭圆形窗口）并调整其大小和方向，可以进一步控制这些操作的效果。</p>
<h2 id="1形态学腐蚀">1.形态学腐蚀 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246382058-9e4add26-6872-4646-a319-116df5f3f81a.png" alt=""></p>
<p>腐蚀的目的：去除图像中的某些部分以及会缩小细化目标。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_erosion<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像，二值图像，腐蚀图像</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//转换为二值图</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过0，1调节二值图像背景颜色</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//腐蚀</span>
	Mat se <span class="token operator">=</span> <span class="token function">getStructuringElement</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//构造矩形结构元素</span>
	<span class="token function">erode</span><span class="token punctuation">(</span>image_bw<span class="token punctuation">,</span> image_erosion<span class="token punctuation">,</span> se<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行腐蚀操作</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_erosion"</span><span class="token punctuation">,</span> image_erosion<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246618191-c5a960dd-cf53-4404-97f4-661247957dcc.png" alt="">   <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246624685-3a0f739e-a3fe-4368-af1d-e73fedd05796.png" alt=""></p>
<h2 id="2形态学膨胀">2.形态学膨胀 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246708195-4dde75e0-484d-486d-8bb0-c99527a1ff91.png" alt=""></p>
<p>膨胀目的：增大图像中的目标，或者填充、连接某些目标。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_dilate<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像，二值图像，膨胀图像</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//转换为二值图</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过0，1调节二值图像背景颜色</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//膨胀</span>
	Mat se <span class="token operator">=</span> <span class="token function">getStructuringElement</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//构造矩形结构元素</span>
	<span class="token function">dilate</span><span class="token punctuation">(</span>image_bw<span class="token punctuation">,</span> image_dilate<span class="token punctuation">,</span> se<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行膨胀操作</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_dilate"</span><span class="token punctuation">,</span> image_dilate<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246770363-ebd8ac3e-d3fd-48a2-a0c3-1c127f3c3ba2.png" alt=""> <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246778460-e7eb79c6-2e5b-4b8b-86b8-8baaf2d03883.png" alt=""></p>
<h2 id="3开运算和闭运算">3.开运算和闭运算 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246831421-88401df6-a62a-4f0b-9c0c-402e69978707.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">;</span>   <span class="token comment">//定义输入图像，灰度图像，二值图像</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//转换为二值图</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过0，1调节二值图像背景颜色</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//闭运算</span>
	Mat se <span class="token operator">=</span> <span class="token function">getStructuringElement</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//构造矩形结构元素</span>
	<span class="token function">dilate</span><span class="token punctuation">(</span>image_bw<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> se<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行膨胀操作</span>
	<span class="token function">erode</span><span class="token punctuation">(</span>image_bw<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> se<span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行腐蚀操作</span>
	
	<span class="token comment">//开运算</span>
	<span class="token comment">//Mat se = getStructuringElement(0, Size(3, 3)); //构造矩形结构元素</span>
	<span class="token comment">//erode(image_bw, image_bw, se, Point(-1, -1), 2); //执行腐蚀操作</span>
	<span class="token comment">//dilate(image_bw, image_bw, se, Point(-1, -1), 2); //执行膨胀操作</span>

	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246894083-2cd718b5-321f-4bca-8e37-6b81da245aa4.png" alt="">   <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246909732-3c1cfa39-20ff-45ee-9424-69fdf791fb96.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246923127-4dabb7c4-4f1f-47fa-8b5d-f1855e9b7922.png" alt="">  <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725246934043-7bece63c-8356-4be4-b1ff-e3de8301e7ec.png" alt=""></p>
<h2 id="4morphologyex函数">4.morphologyEx函数 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">morphologyEx</span><span class="token punctuation">(</span> InputArray src<span class="token punctuation">,</span> 
                   OutputArray dst<span class="token punctuation">,</span>
                   <span class="token keyword keyword-int">int</span> op<span class="token punctuation">,</span> 
                   InputArray kernel<span class="token punctuation">,</span>
                   Point anchor <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                   <span class="token keyword keyword-int">int</span> iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                   <span class="token keyword keyword-int">int</span> borderType <span class="token operator">=</span> BORDER_CONSTANT<span class="token punctuation">,</span>
                   <span class="token keyword keyword-const">const</span> Scalar<span class="token operator">&amp;</span> borderValue <span class="token operator">=</span> <span class="token function">morphologyDefaultBorderValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
形态学操作的类型op。可以是以下值之一：
cv<span class="token double-colon punctuation">::</span>MORPH_ERODE：<span class="token number">0</span> 腐蚀操作。
cv<span class="token double-colon punctuation">::</span>MORPH_DILATE：<span class="token number">1</span> 膨胀操作。
cv<span class="token double-colon punctuation">::</span>MORPH_OPEN：<span class="token number">2</span> 开运算（先腐蚀后膨胀）。
cv<span class="token double-colon punctuation">::</span>MORPH_CLOSE：<span class="token number">3</span> 闭运算（先膨胀后腐蚀）。
cv<span class="token double-colon punctuation">::</span>MORPH_GRADIENT：<span class="token number">4</span> 形态学梯度（膨胀图与腐蚀图之差）。
cv<span class="token double-colon punctuation">::</span>MORPH_TOPHAT：<span class="token number">5</span> 顶帽操作（原图像与开运算结果之差）。
cv<span class="token double-colon punctuation">::</span>MORPH_BLACKHAT：<span class="token number">6</span> 黑帽操作（闭运算结果与原图像之差）。
cv<span class="token double-colon punctuation">::</span>MORPH_HITMISS ： <span class="token number">7</span> 击中<span class="token operator">-</span>击不中变换。

    
<span class="token comment">// 创建一个5x5的矩形结构元素  </span>
cv<span class="token double-colon punctuation">::</span>Mat kernel <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span>MORPH_RECT<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 对图像src执行闭运算</span>
cv<span class="token double-colon punctuation">::</span><span class="token function">morphologyEx</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>MORPH_CLOSE<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>  

</code></pre><p>知乎专栏 ：<a href="https://zhuanlan.zhihu.com/p/542900419">https://zhuanlan.zhihu.com/p/542900419</a></p>
<h1 id="边缘检测与阈值分割">边缘检测与阈值分割 </h1>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247242397-c1ef0ade-3eb8-4f29-891b-14066c5adcbb.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247252642-e714a091-0954-4bd5-ad2d-53a921c0b7b6.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247305233-c971a2ca-010a-46eb-ade2-1a672f25b480.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247316569-686146c9-45fb-4439-bc78-eab67f4e8af9.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247326048-3aef0e73-5a7c-4698-a24b-6df8282e1b25.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247373623-aad3668a-9719-4e06-832c-29b53313bad1.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725247354538-220b1328-6877-4501-ab5a-5d71989768e9.png" alt=""></p>
<h2 id="1图像分割-孤立点检测">1.图像分割-孤立点检测 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw2<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"cat.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//1.构建拉普拉斯孤立点检测卷积核</span>
	Mat Laplacian_kernel <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> 
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2.卷积运算</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//3.阈值处理</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过0，1调节二值图像背景颜色</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw2"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251062914-d9b7134a-1314-4848-ab27-c3c7ec93314e.png" alt=""></p>
<h2 id="2图像分割-线检测">2.图像分割-线检测 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code> <span class="token comment">//使用拉普拉斯核进行线的检测：</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw2<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"bian.bmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//构建拉普拉斯卷积核</span>
	Mat Laplacian_kernel <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> 
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//卷积运算</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//8邻域</span>
	Mat Laplacian_kerne2 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kerne2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw2"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251153816-185ce017-90a9-499f-93b7-3caf4c123e39.png" alt=""></p>
<h3 id="规定方向的线检测">规定方向的线检测 </h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251226343-ed200b28-7c66-4543-bb97-c8108c2c6f26.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//规定方向的线检测</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> image_bw3<span class="token punctuation">,</span> image_bw4<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"bian.bmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//水平</span>
	Mat Laplacian_kernel <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//45°</span>
	Mat Laplacian_kernel2 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kernel2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw2"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//垂直</span>
	Mat Laplacian_kernel3 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw3<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kernel3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw3"</span><span class="token punctuation">,</span> image_bw3<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//-45°</span>
	Mat Laplacian_kernel4 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw4<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Laplacian_kernel4<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw4"</span><span class="token punctuation">,</span> image_bw4<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251373194-261eadbf-ee03-419c-a608-b85c6f3e1a97.png" alt=""></p>
<p>原图</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251273033-9af92aa2-ca6a-4916-9c58-d81cee8c9551.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251281481-1d1e9c5c-59ad-45a4-b7b5-111ff48678dc.png" alt=""></p>
<p>水平							45°</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251289439-b7e97bd8-5465-4bd1-abcb-7de5a556420f.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251297319-f5bbfbd2-a74e-4415-9afc-ed4a9af75be2.png" alt=""></p>
<p>竖直							-45°</p>
<p>边缘检测步骤边缘检测通常包含三个步骤：</p>
<p>（1）对图像进行平滑处理，降低图像噪声。</p>
<p>（2）检测边缘点，从图像中提取所有可能是边缘的点（候选边缘点）。</p>
<p>（3）边缘定位，从候选边缘点中选择组成边缘点集中的成员点。</p>
<h2 id="3roberts-prewitt-sobel边缘检测">3.Roberts、Prewitt、Sobel边缘检测 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251529525-021ca096-c17c-4175-ae1b-0d2c857da159.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251537984-5ff87c9f-7a29-4e1a-bddf-cf4cf5e926ac.png" alt="">    <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251544317-1fca322b-c0e7-4927-97c6-1d86bdeff50f.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> image_bw2<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//构建检测核</span>
	Mat kernel1 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat kernel2 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//利用filter2D进行处理</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//结果取绝对值</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//转换为二值图</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//两个方向的结果相加</span>
	image_bw <span class="token operator">=</span> image_bw1 <span class="token operator">+</span> image_bw2<span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"robert1"</span><span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"robert2"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"robert"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251681855-690d593c-4b7e-4fd5-8ad5-52ff62c39f56.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> image_bw2<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//构建检测核</span>
	Mat kernel1 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat kernel2 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//利用filter2D进行处理</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//结果取绝对值</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//转换为二值图</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//两个方向的结果相加</span>
	image_bw <span class="token operator">=</span> image_bw1 <span class="token operator">+</span> image_bw2<span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"prewittX"</span><span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"prewittY"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"prewitt"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251751766-7aba6ecb-8cf9-477f-8ae0-918843541760.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> image_bw2<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//构建检测核</span>
	Mat kernel1 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat kernel2 <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Mat_</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//利用filter2D进行处理</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">filter2D</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//结果取绝对值</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//转换为二值图</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//两个方向的结果相加</span>
	image_bw <span class="token operator">=</span> image_bw1 <span class="token operator">+</span> image_bw2<span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sobelX"</span><span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sobelY"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sobel"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725251843550-511f18af-f45a-4edf-811d-941f314ab0a5.png" alt=""></p>
<p><strong>利用opencv的Sobel函数处理</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 利用opencv的Sobel函数处理</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> image_bw2<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取图像；</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//转换为灰度图像</span>
	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//Sobel   void Sobel(InputArray src, OutputArray dst, int ddepth, int dx, int dy, int ksize=3, double scale=1, double delta=0, int borderType=BORDER_DEFAULT)</span>
	<span class="token function">Sobel</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//dx=1 且 dy=0，则函数将计算一阶 x 导数</span>
	<span class="token function">Sobel</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//结果取绝对值</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//转换为二值图       梯度值转换为二值图像可以清晰地显示出边缘，使得后续的图像处理或分析更加简单</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw1<span class="token punctuation">,</span> image_bw1<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">threshold</span><span class="token punctuation">(</span>image_bw2<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//两个方向的结果相加</span>
	image_bw <span class="token operator">=</span> image_bw1 <span class="token operator">+</span> image_bw2<span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sobelX"</span><span class="token punctuation">,</span> image_bw1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sobelY"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"sobel"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//暂停，保持图像显示，等待按键结束</span>
	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="4canny边缘检测">4.Canny边缘检测 </h2>
<p><font style="color:rgb(25, 27, 31);">canny边缘检测算子是传统边缘检测算子中最优秀的，canny检测基于下面三个目标：</font></p>
<p><font style="color:rgb(25, 27, 31);">（1）</font><strong><font style="color:rgb(25, 27, 31);">低错误率</font></strong><font style="color:rgb(25, 27, 31);">。即所有边缘都应该找到，并且没有虚假边缘。</font></p>
<p><font style="color:rgb(25, 27, 31);">（2）</font><strong><font style="color:rgb(25, 27, 31);">准确的定位边缘</font></strong><font style="color:rgb(25, 27, 31);">。即检测到的边缘应该接近真实的边缘。</font></p>
<p><font style="color:rgb(25, 27, 31);">（3）</font><strong><font style="color:rgb(25, 27, 31);">单个边缘点响应</font></strong><font style="color:rgb(25, 27, 31);">。即对于边缘检测，只返回单点厚度的结果。</font></p>
<h3 id="font-stylecolorrgb25-27-31方法步骤font"><font style="color:rgb(25, 27, 31);">方法步骤</font> </h3>
<p><font style="color:rgb(25, 27, 31);">（1）使用</font><a href="https://zhida.zhihu.com/search?q=%E9%AB%98%E6%96%AF%E6%BB%A4%E6%B3%A2%E5%99%A8&amp;zhida_source=entity&amp;is_preview=1"><font style="color:rgb(25, 27, 31);">高斯滤波器</font></a><font style="color:rgb(25, 27, 31);">平滑图像（基本边缘检测基本都有这步，为了减少噪声的影响）</font></p>
<p><font style="color:rgb(25, 27, 31);">（2）计算梯度幅值和边缘方向</font></p>
<p><font style="color:rgb(25, 27, 31);">（3）非极大值抑制（细化边缘）</font></p>
<p><font style="color:rgb(25, 27, 31);">（4）使用双阈值处理和连通性分析检测和链接边缘</font></p>
<p><font style="color:rgb(25, 27, 31);"></font></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat img1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取灰度图像</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>img1<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	Mat img2 <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>img1<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8U<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//opencv自带canny检测函数</span>
	<span class="token function">Canny</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"canny"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725252079855-9b4ff272-0688-4323-9113-d4ccd6ebc1b3.png" alt="">   <img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725252085489-7e71e351-d9fc-4c82-95ba-0c86f9ab7e4a.png" alt=""></p>
<p>知乎专栏：<a href="https://zhuanlan.zhihu.com/p/558742282">https://zhuanlan.zhihu.com/p/558742282</a></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cmath&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//1 高斯滤波</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> Sigma<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//保证高斯核大小为大于等于3的奇数</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gauss_size <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> Gauss_size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-else">else</span> Gauss_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Gauss_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//生成高斯卷积核</span>
	<span class="token keyword keyword-double">double</span><span class="token operator">*</span><span class="token operator">*</span> Gausskernel <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-double">double</span><span class="token operator">*</span> <span class="token punctuation">[</span>Gauss_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">[</span>Gauss_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-int">int</span> center <span class="token operator">=</span> Gauss_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Sigma <span class="token operator">*</span> Sigma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sum <span class="token operator">+=</span> Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//高斯卷积核归一化</span>
	<span class="token keyword keyword-double">double</span> sum1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> sum<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*=</span> sum1<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//滤波</span>
	Mat tem_image <span class="token operator">=</span> input_image<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> rows <span class="token operator">=</span> input_image<span class="token punctuation">.</span>rows <span class="token operator">-</span> center<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> cols <span class="token operator">=</span> input_image<span class="token punctuation">.</span>cols <span class="token operator">-</span> center<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> center<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> center<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cols<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>center<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> center<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>center<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> center<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					sum <span class="token operator">+=</span> Gausskernel<span class="token punctuation">[</span>center <span class="token operator">+</span> m<span class="token punctuation">]</span><span class="token punctuation">[</span>center <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">*</span> input_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> m<span class="token punctuation">,</span> j <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			tem_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	output_image <span class="token operator">=</span> tem_image<span class="token punctuation">;</span>

	<span class="token comment">//释放内存</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Gausskernel<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//2 计算梯度幅值图像,方向图像和边缘图像</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Grad_dire_ly</span><span class="token punctuation">(</span>Mat input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Gradimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Direimage<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat tempGrad <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_16U<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat tempDire <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8U<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> input<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> input<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//计算梯度及梯度幅值</span>
			<span class="token keyword keyword-int">int</span> gx <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-int">int</span> gy <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-int">int</span> sum <span class="token operator">=</span> gx <span class="token operator">+</span> gy<span class="token punctuation">;</span>

			<span class="token comment">//梯度幅值图像</span>
			tempGrad<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//方向图像,图像中的坐标轴</span>
			<span class="token keyword keyword-double">double</span> dire <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>gy<span class="token punctuation">,</span> gx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span> <span class="token number">3.1415926</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dire <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">67.5</span> <span class="token operator">||</span> dire <span class="token operator">&gt;=</span> <span class="token number">67.5</span><span class="token punctuation">)</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//1：水平</span>
			<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dire <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">67.5</span> <span class="token operator">&amp;&amp;</span> dire <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">22.5</span><span class="token punctuation">)</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//2：45</span>
			<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dire <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">22.5</span> <span class="token operator">&amp;&amp;</span> dire <span class="token operator">&lt;</span> <span class="token number">22.5</span><span class="token punctuation">)</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">//3：垂直</span>
			<span class="token keyword keyword-else">else</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//4：-45</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	Gradimage <span class="token operator">=</span> tempGrad<span class="token punctuation">;</span>
	Direimage <span class="token operator">=</span> tempDire<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//3 非极大值抑制图像</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Nonmax_suppression_ly</span><span class="token punctuation">(</span>Mat Gradimage<span class="token punctuation">,</span> Mat Direimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Suppimage<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat tempSupp <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Gradimage<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>Direimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-else">else</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-else">else</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-else">else</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-else">else</span>
					tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-default">default</span><span class="token operator">:</span>

				<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	Suppimage <span class="token operator">=</span> tempSupp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//4 滞后阈值处理（双阈值）</span>
<span class="token keyword keyword-void">void</span> <span class="token function">doubleThread_ly</span><span class="token punctuation">(</span>Mat Suppimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Edgeimage<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_high<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_low<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-int">int</span> temp<span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>th_high <span class="token operator">&lt;</span> th_low<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		temp <span class="token operator">=</span> th_high<span class="token punctuation">;</span>
		th_high <span class="token operator">=</span> th_low<span class="token punctuation">;</span>
		th_low <span class="token operator">=</span> temp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Mat bw_h <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat bw_l <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> Suppimage<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> Suppimage<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> th_high<span class="token punctuation">)</span>
				bw_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-else">else</span>
				bw_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> th_low <span class="token operator">&amp;&amp;</span> Suppimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&lt;</span> th_high<span class="token punctuation">)</span>
				bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-else">else</span>
				bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Mat bw <span class="token operator">=</span> bw_h<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Edgeimage <span class="token operator">=</span> bw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//5 canny函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">canny_ly</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_high<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_low<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigmma<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat Gaussimage<span class="token punctuation">,</span> Gradimage<span class="token punctuation">,</span> Direimage<span class="token punctuation">,</span> Suppimage<span class="token punctuation">,</span> Edgeimage<span class="token punctuation">;</span>
	<span class="token comment">//1 高斯滤波函数</span>
	<span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>input_image<span class="token punctuation">,</span> Gaussimage<span class="token punctuation">,</span> Gauss_size<span class="token punctuation">,</span> sigmma<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2 计算梯度幅值图像和方向图像</span>
	<span class="token function">Grad_dire_ly</span><span class="token punctuation">(</span>Gaussimage<span class="token punctuation">,</span> Gradimage<span class="token punctuation">,</span> Direimage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3 非极大值抑制图像</span>
	<span class="token function">Nonmax_suppression_ly</span><span class="token punctuation">(</span>Gradimage<span class="token punctuation">,</span> Direimage<span class="token punctuation">,</span> Suppimage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//4 滞后阈值处理（双阈值）</span>
	<span class="token function">doubleThread_ly</span><span class="token punctuation">(</span>Suppimage<span class="token punctuation">,</span> Edgeimage<span class="token punctuation">,</span> th_high<span class="token punctuation">,</span> th_low<span class="token punctuation">)</span><span class="token punctuation">;</span>

	output_image <span class="token operator">=</span> Edgeimage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//#include "CannyLY.h"</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat img1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"person.jpg"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取灰度图像</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>img1<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	Mat img2<span class="token punctuation">;</span>
	<span class="token function">canny_ly</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"canny"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_CANNY_LY_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CANNY_LY_</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>

<span class="token comment">//1 高斯滤波函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>Mat input<span class="token punctuation">,</span> Mat <span class="token operator">&amp;</span>output<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> Sigma<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2 计算梯度幅值图像和方向图像</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Grad_dire_ly</span><span class="token punctuation">(</span>Mat input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Gradimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Direimage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3 非极大值抑制图像</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Nonmax_suppression_ly</span><span class="token punctuation">(</span>Mat Gradimage<span class="token punctuation">,</span> Mat Direimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Suppimage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//4 滞后阈值处理（双阈值）</span>
<span class="token keyword keyword-void">void</span> <span class="token function">doubleThread_ly</span><span class="token punctuation">(</span>Mat Suppimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Edgeimage<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_high<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_low<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//5 canny函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">canny_ly</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_high<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_low<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigmma<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CannyLY.h"</span></span>

<span class="token comment">//1 高斯滤波</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> Sigma<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//保证高斯核大小为大于等于3的奇数</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gauss_size <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> Gauss_size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-else">else</span> Gauss_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Gauss_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

	<span class="token comment">//生成高斯卷积核</span>
	<span class="token keyword keyword-double">double</span><span class="token operator">*</span><span class="token operator">*</span> Gausskernel <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-double">double</span><span class="token operator">*</span> <span class="token punctuation">[</span>Gauss_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">[</span>Gauss_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-int">int</span> center <span class="token operator">=</span> Gauss_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Sigma <span class="token operator">*</span> Sigma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sum <span class="token operator">+=</span> Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//高斯卷积核归一化</span>
	<span class="token keyword keyword-double">double</span> sum1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> sum<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*=</span> sum1<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//滤波</span>
	Mat tem_image <span class="token operator">=</span> input_image<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> rows <span class="token operator">=</span> input_image<span class="token punctuation">.</span>rows <span class="token operator">-</span> center<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> cols <span class="token operator">=</span> input_image<span class="token punctuation">.</span>cols <span class="token operator">-</span> center<span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> center<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> center<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> cols<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> m <span class="token operator">=</span> <span class="token operator">-</span>center<span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> center<span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span> 
			<span class="token punctuation">{</span>
				<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token operator">-</span>center<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> center<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> 
				<span class="token punctuation">{</span>
					sum <span class="token operator">+=</span> Gausskernel<span class="token punctuation">[</span>center <span class="token operator">+</span> m<span class="token punctuation">]</span><span class="token punctuation">[</span>center <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">*</span> input_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> m<span class="token punctuation">,</span> j <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			tem_image<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	output_image <span class="token operator">=</span> tem_image<span class="token punctuation">;</span>

	<span class="token comment">//释放内存</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Gauss_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Gausskernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-delete">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Gausskernel<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//2 计算梯度幅值图像,方向图像和边缘图像</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Grad_dire_ly</span><span class="token punctuation">(</span>Mat input<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Gradimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Direimage<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat tempGrad <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_16U<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat tempDire <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8U<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> input<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> input<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//计算梯度及梯度幅值</span>
			<span class="token keyword keyword-int">int</span> gx <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-int">int</span> gy <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> input<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-int">int</span> sum <span class="token operator">=</span> gx <span class="token operator">+</span> gy<span class="token punctuation">;</span>

			<span class="token comment">//梯度幅值图像</span>
			tempGrad<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//方向图像,图像中的坐标轴</span>
			<span class="token keyword keyword-double">double</span> dire <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>gy<span class="token punctuation">,</span> gx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span> <span class="token number">3.1415926</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dire <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">67.5</span> <span class="token operator">||</span> dire <span class="token operator">&gt;=</span> <span class="token number">67.5</span><span class="token punctuation">)</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//1：水平</span>
			<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dire <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">67.5</span> <span class="token operator">&amp;&amp;</span> dire <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">22.5</span><span class="token punctuation">)</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//2：45</span>
			<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dire <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">22.5</span> <span class="token operator">&amp;&amp;</span> dire <span class="token operator">&lt;</span> <span class="token number">22.5</span><span class="token punctuation">)</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">//3：垂直</span>
			<span class="token keyword keyword-else">else</span> tempDire<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//4：-45</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	Gradimage <span class="token operator">=</span> tempGrad<span class="token punctuation">;</span>
	Direimage <span class="token operator">=</span> tempDire<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//3 非极大值抑制图像</span>
<span class="token keyword keyword-void">void</span> <span class="token function">Nonmax_suppression_ly</span><span class="token punctuation">(</span>Mat Gradimage<span class="token punctuation">,</span> Mat Direimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Suppimage<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat tempSupp <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Gradimage<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>Direimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword keyword-case">case</span> <span class="token number">1</span> <span class="token operator">:</span>
					<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-else">else</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span>
					<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-else">else</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span>
					<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-else">else</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token operator">:</span>
					<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> Gradimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-else">else</span>
						tempSupp<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-default">default</span><span class="token operator">:</span>

					<span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	Suppimage <span class="token operator">=</span> tempSupp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//4 滞后阈值处理（双阈值）</span>
<span class="token keyword keyword-void">void</span> <span class="token function">doubleThread_ly</span><span class="token punctuation">(</span>Mat Suppimage<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> Edgeimage<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_high<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_low<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword keyword-int">int</span> temp<span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>th_high <span class="token operator">&lt;</span> th_low<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		temp <span class="token operator">=</span> th_high<span class="token punctuation">;</span>
		th_high <span class="token operator">=</span> th_low<span class="token punctuation">;</span>
		th_low <span class="token operator">=</span> temp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Mat bw_h <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat bw_l <span class="token operator">=</span> <span class="token function">Mat</span><span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> Suppimage<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> Suppimage<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> th_high<span class="token punctuation">)</span>
				bw_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-else">else</span>
				bw_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Suppimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> th_low <span class="token operator">&amp;&amp;</span> Suppimage<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>ushort<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">&lt;</span> th_high<span class="token punctuation">)</span>
				bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-else">else</span>
				bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Mat bw <span class="token operator">=</span> bw_h<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_h<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
				<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>bw_l<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
					bw<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span>uchar<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Edgeimage <span class="token operator">=</span> bw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//5 canny函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">canny_ly</span><span class="token punctuation">(</span>Mat input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_high<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> th_low<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> Gauss_size<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigmma<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat Gaussimage<span class="token punctuation">,</span> Gradimage<span class="token punctuation">,</span> Direimage<span class="token punctuation">,</span> Suppimage<span class="token punctuation">,</span> Edgeimage<span class="token punctuation">;</span>
	<span class="token comment">//1 高斯滤波函数</span>
	<span class="token function">Gaussfilter_ly</span><span class="token punctuation">(</span>input_image<span class="token punctuation">,</span> Gaussimage<span class="token punctuation">,</span> Gauss_size<span class="token punctuation">,</span> sigmma<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2 计算梯度幅值图像和方向图像</span>
	<span class="token function">Grad_dire_ly</span><span class="token punctuation">(</span>Gaussimage<span class="token punctuation">,</span> Gradimage<span class="token punctuation">,</span> Direimage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3 非极大值抑制图像</span>
	<span class="token function">Nonmax_suppression_ly</span><span class="token punctuation">(</span>Gradimage<span class="token punctuation">,</span> Direimage<span class="token punctuation">,</span> Suppimage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//4 滞后阈值处理（双阈值）</span>
	<span class="token function">doubleThread_ly</span><span class="token punctuation">(</span>Suppimage<span class="token punctuation">,</span> Edgeimage<span class="token punctuation">,</span> th_high<span class="token punctuation">,</span> th_low<span class="token punctuation">)</span><span class="token punctuation">;</span>

	output_image <span class="token operator">=</span> Edgeimage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CannyLY.h"</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat img1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"lena.png"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取灰度图像</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>img1<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取错误"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"img1"</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	Mat img2<span class="token punctuation">;</span>
	<span class="token function">canny_ly</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"img2"</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><h2 id="5阈值分割">5.阈值分割 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725252893329-5f69a7a6-fe6d-44f5-99bf-7cae87bb7899.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>   </span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span> 

<span class="token keyword keyword-double">double</span> <span class="token function">kittler</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将图像转换为浮点数类型  </span>
    Mat image_float<span class="token punctuation">;</span>
    image<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>image_float<span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算图像的直方图  </span>
    Mat hist<span class="token punctuation">,</span> hist_norm<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> histSize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> range<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span><span class="token operator">*</span> histRange <span class="token operator">=</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>image_float<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histSize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>hist<span class="token punctuation">,</span> hist_norm<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算累计直方图  </span>
    Mat hist_cum<span class="token punctuation">;</span>
    <span class="token function">accumulate</span><span class="token punctuation">(</span>hist_norm<span class="token punctuation">,</span> hist_cum<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算最佳阈值  </span>
    <span class="token keyword keyword-double">double</span> max_val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> min_val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> max_err <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> err<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> histSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-double">double</span> total <span class="token operator">=</span> hist_cum<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> left <span class="token operator">=</span> hist_cum<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err_val <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>total <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
        err<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> err_val<span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>total <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> left <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            p1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span>i <span class="token operator">/</span> histSize<span class="token punctuation">;</span>
            p2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> histSize<span class="token punctuation">;</span>
            sum <span class="token operator">+=</span> err_val<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>err_val <span class="token operator">&gt;</span> max_err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                max_err <span class="token operator">=</span> err_val<span class="token punctuation">;</span>
                max_val <span class="token operator">=</span> p1<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            min_val <span class="token operator">=</span> p2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-double">double</span> m1 <span class="token operator">=</span> sum <span class="token operator">/</span> <span class="token punctuation">(</span>max_val <span class="token operator">+</span> min_val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> m2 <span class="token operator">=</span> sum <span class="token operator">*</span> sum <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>max_val <span class="token operator">+</span> min_val<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max_val <span class="token operator">+</span> min_val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> mean <span class="token operator">=</span> m1 <span class="token operator">-</span> m2<span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> stddev <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>m2 <span class="token operator">-</span> mean <span class="token operator">*</span> mean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> thresh <span class="token operator">=</span> mean <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">*</span> stddev<span class="token punctuation">;</span> <span class="token comment">// Kittler's method threshold formula  </span>
    <span class="token keyword keyword-return">return</span> thresh<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">zero_one_img</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Mat gray<span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// threshold(灰度图, 输出图像, 阈值, 图像最大像素值, 阈值分割方法); </span>
    Mat binary<span class="token punctuation">;</span>
    <span class="token comment">//不同方法模式</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//大于阈值时置 255，否则置 0</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY_INV<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//大于阈值时置 0，否则置 255</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY_INV"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY_INV"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_TRUNC<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//大于阈值时置为阈值 thresh，否则不变（保持原色）</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TRUNC"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TRUNC"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_TOZERO<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//大于阈值时不变（保持原色），否则置 0</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_TOZERO_INV<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//大于阈值时置 0，否则不变（保持原色）</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO_INV"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO_INV"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//全局阈值分割方法: 均值法、 OTSU(大津算法)、 三角法（Triangle）</span>
    
    <span class="token comment">//均值法：统计图像像素值的均值作为阈值</span>
    Scalar m <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//printf("means : %2f\n", m[0]);</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//OTSU法（基于最小类内方差求阈值的方法）：基于像素直方图的统计结果，统计各像素点值的方差值，选类内方差最小的像素点值作为阈值。</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY <span class="token operator">|</span> THRESH_OTSU<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Triangle法：获取如下直方图后，从最高点到最低点作一线段，以α和β为45°为前提，寻找右图上使得d最大的线段，将此时α角点的像素点值作为阈值。</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY <span class="token operator">|</span> THRESH_TRIANGLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 适用情况总结:OTSU法适用于有多峰直方图的图像，三角法使用有单峰直方图的图像。</span>
    <span class="token comment">/*
    //OTSU
    double t1 = threshold(gray, binary, 0, 255, THRESH_BINARY | THRESH_OTSU);//t1为otsu分割阈值
    printf("otsu threshold T:%.2f\n", t1);
    imshow("otsu binary", binary);

    //三角法 triangle
    double t2 = threshold(gray, binary, 0, 255, THRESH_BINARY | THRESH_TRIANGLE);//t2为triangle分割阈值
    printf("triangle threshold T:%.2f\n", t2);
    imshow("triangle binary", binary);
    */</span>


    <span class="token comment">//自适应阈值</span>
    <span class="token function">adaptiveThreshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> ADAPTIVE_THRESH_GAUSSIAN_C<span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//阈值是邻域的高斯核加权均值</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-gaussian"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-gaussian"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">adaptiveThreshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> ADAPTIVE_THRESH_MEAN_C<span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//阈值是邻域的均值</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-mean"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-mean"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    
    <span class="token comment">// 应用Kittler算法进行阈值分割  </span>
    <span class="token comment">//double thresh = kittler(gray);</span>
    <span class="token comment">//threshold(gray, binary, thresh, 255, THRESH_BINARY + THRESH_OTSU);</span>
    <span class="token comment">//namedWindow("KittlerThreshold", WINDOW_FREERATIO);</span>
    <span class="token comment">//imshow("KittlerThreshold", binary);</span>

    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待用户按键，然后关闭窗口</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 读取图像  </span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"A005.png"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_COLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"无法读取图像"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 调用zero_one_img函数  </span>
    <span class="token function">zero_one_img</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>    <span class="token comment">// threshold(灰度图, 输出图像, 阈值, 图像最大像素值, 阈值分割方法); </span>
    Mat binary<span class="token punctuation">;</span>
    <span class="token comment">//不同方法模式</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//大于阈值时置 255，否则置 0</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY_INV<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//大于阈值时置 0，否则置 255</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY_INV"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY_INV"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_TRUNC<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//大于阈值时置为阈值 thresh，否则不变（保持原色）</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TRUNC"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TRUNC"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_TOZERO<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//大于阈值时不变（保持原色），否则置 0</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_TOZERO_INV<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//大于阈值时置 0，否则不变（保持原色）</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO_INV"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_TOZERO_INV"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>    <span class="token comment">//全局阈值分割方法: 均值法、 OTSU(大津算法)、 三角法（Triangle）</span>
    
    <span class="token comment">//均值法：统计图像像素值的均值作为阈值</span>
    Scalar m <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//printf("means : %2f\n", m[0]);</span>

    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_BINARY"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//OTSU法（基于最小类内方差求阈值的方法）：基于像素直方图的统计结果，统计各像素点值的方差值，选类内方差最小的像素点值作为阈值。</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY <span class="token operator">|</span> THRESH_OTSU<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Triangle法：获取如下直方图后，从最高点到最低点作一线段，以α和β为45°为前提，寻找右图上使得d最大的线段，将此时α角点的像素点值作为阈值。</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY <span class="token operator">|</span> THRESH_TRIANGLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"THRESH_OTSU"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">//自适应阈值</span>
<span class="token function">adaptiveThreshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> ADAPTIVE_THRESH_GAUSSIAN_C<span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//阈值是邻域的高斯核加权均值</span>
<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-gaussian"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-gaussian"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">adaptiveThreshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> ADAPTIVE_THRESH_MEAN_C<span class="token punctuation">,</span> THRESH_BINARY<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//阈值是邻域的均值</span>
<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-mean"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"adaptiveThreshold-mean"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>   </span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span> 

<span class="token keyword keyword-double">double</span> <span class="token function">kittler</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将图像转换为浮点数类型  </span>
    Mat image_float<span class="token punctuation">;</span>
    image<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>image_float<span class="token punctuation">,</span> CV_32F<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算图像的直方图  </span>
    Mat hist<span class="token punctuation">,</span> hist_norm<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> histSize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> range<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span><span class="token operator">*</span> histRange <span class="token operator">=</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>image_float<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histSize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>histRange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">normalize</span><span class="token punctuation">(</span>hist<span class="token punctuation">,</span> hist_norm<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> NORM_MINMAX<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算累计直方图  </span>
    Mat hist_cum<span class="token punctuation">;</span>
    <span class="token function">accumulate</span><span class="token punctuation">(</span>hist_norm<span class="token punctuation">,</span> hist_cum<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 计算最佳阈值  </span>
    <span class="token keyword keyword-double">double</span> max_val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> min_val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> max_err <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> err<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> histSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-double">double</span> total <span class="token operator">=</span> hist_cum<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> left <span class="token operator">=</span> hist_cum<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err_val <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>total <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
        err<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> err_val<span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>total <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> left <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            p1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span>i <span class="token operator">/</span> histSize<span class="token punctuation">;</span>
            p2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> histSize<span class="token punctuation">;</span>
            sum <span class="token operator">+=</span> err_val<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>err_val <span class="token operator">&gt;</span> max_err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                max_err <span class="token operator">=</span> err_val<span class="token punctuation">;</span>
                max_val <span class="token operator">=</span> p1<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            min_val <span class="token operator">=</span> p2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-double">double</span> m1 <span class="token operator">=</span> sum <span class="token operator">/</span> <span class="token punctuation">(</span>max_val <span class="token operator">+</span> min_val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> m2 <span class="token operator">=</span> sum <span class="token operator">*</span> sum <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>max_val <span class="token operator">+</span> min_val<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max_val <span class="token operator">+</span> min_val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> mean <span class="token operator">=</span> m1 <span class="token operator">-</span> m2<span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> stddev <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>m2 <span class="token operator">-</span> mean <span class="token operator">*</span> mean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> thresh <span class="token operator">=</span> mean <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">*</span> stddev<span class="token punctuation">;</span> <span class="token comment">// Kittler's method threshold formula  </span>
    <span class="token keyword keyword-return">return</span> thresh<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">zero_one_img</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> image<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Mat gray<span class="token punctuation">;</span>
    <span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Mat binary<span class="token punctuation">;</span>
    
    <span class="token comment">//应用Kittler算法进行阈值分割  </span>
    <span class="token keyword keyword-double">double</span> thresh <span class="token operator">=</span> <span class="token function">kittler</span><span class="token punctuation">(</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> binary<span class="token punctuation">,</span> thresh<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> THRESH_BINARY <span class="token operator">+</span> THRESH_OTSU<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"KittlerThreshold"</span><span class="token punctuation">,</span> WINDOW_FREERATIO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"KittlerThreshold"</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待用户按键，然后关闭窗口</span>
<span class="token punctuation">}</span>


<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 读取图像  </span>
    cv<span class="token double-colon punctuation">::</span>Mat image <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"A005.png"</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>IMREAD_COLOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"无法读取图像"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 调用zero_one_img函数  </span>
    <span class="token function">zero_one_img</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span>

</code></pre><p><strong>阈值分割-全局阈值分割</strong></p>
<p>原理步骤当目标像素的灰度值与背景像素的灰度值相差比较明显时，就可以使用一个全局阈值进行分割。一种自动计算全局阈值T的迭代计算方法步骤：</p>
<p>（1）为全局阈值T选择一个初始的估计值；</p>
<p>（2）使用初始值T进行阈值分割，此时图像分为两组像素：大于阈值的像素组G1，小于阈值的像素组G2；</p>
<p>（3）分别计算属于G1、G2像素的平均灰度值m1和m2；</p>
<p>（4）针对m1和m2计算一个新的阈值 T=（m1 + m2）/2；</p>
<p>（5）重复（2）到（4），直到连续迭代中计算的连续两个T的差小于某个预定义的值T0为止。</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>

<span class="token comment">//声明全局阈值分割函数,输入图像，输出图像，T0，初始阈值T</span>
<span class="token keyword keyword-void">void</span> <span class="token function">global_threshold_segmentation</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> T0<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> T<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	Mat image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">;</span>
	image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"Cameraman.bmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取图像出错"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> image_gray<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_gray"</span><span class="token punctuation">,</span> image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//1 在这里使用图像的平均值作为初始值T, T0=5</span>
	Scalar image_meam <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">mean</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使用opencv的mean函数求平均值</span>
	<span class="token keyword keyword-int">int</span> T <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>image_meam<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//图像的平均值作为初始值T</span>
	<span class="token function">global_threshold_segmentation</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw"</span><span class="token punctuation">,</span> image_bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2 使用任意值作为初始阈值</span>
	Mat image_bw2<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> T1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">//任意值</span>
	<span class="token function">global_threshold_segmentation</span><span class="token punctuation">(</span>image_gray<span class="token punctuation">,</span> image_bw2<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> T1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"image_bw2"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"image_bw2"</span><span class="token punctuation">,</span> image_bw2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义全局阈值分割函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">global_threshold_segmentation</span><span class="token punctuation">(</span>Mat<span class="token operator">&amp;</span> input_image<span class="token punctuation">,</span> Mat<span class="token operator">&amp;</span> output_image<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> T0<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> T<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//使用初始值T进行分组并求每组的平均值m1和m2，并计算新的阈值T2</span>
	<span class="token keyword keyword-int">int</span> width <span class="token operator">=</span> input_image<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> <span class="token comment">//图像列数</span>
	<span class="token keyword keyword-int">int</span> height <span class="token operator">=</span> input_image<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token comment">//图像行数</span>
	uchar<span class="token operator">*</span> Img <span class="token operator">=</span> input_image<span class="token punctuation">.</span>data<span class="token punctuation">;</span> <span class="token comment">//图像指针</span>
	<span class="token keyword keyword-int">int</span> G1_mean<span class="token punctuation">,</span> G2_mean<span class="token punctuation">;</span> <span class="token comment">//定义每组像素的均值</span>
	<span class="token keyword keyword-int">int</span> G1_num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> G2_num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//定义每组像素的数量，初始值设为1，以免后面出现除以0的问题</span>
	<span class="token keyword keyword-int">int</span> G1_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> G2_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//定义每组灰度值之和</span>

	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		uchar<span class="token operator">*</span> Img <span class="token operator">=</span> input_image<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//图像每行数据的指针</span>
		<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Img<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> T<span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				G1_sum <span class="token operator">+=</span> Img<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				G1_num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword keyword-else">else</span>
			<span class="token punctuation">{</span>
				G2_sum <span class="token operator">+=</span> Img<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				G2_num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	G1_mean <span class="token operator">=</span> G1_sum <span class="token operator">/</span> G1_num<span class="token punctuation">;</span>
	G2_mean <span class="token operator">=</span> G2_sum <span class="token operator">/</span> G2_num<span class="token punctuation">;</span>
	<span class="token keyword keyword-int">int</span> T2 <span class="token operator">=</span> <span class="token punctuation">(</span>G1_mean <span class="token operator">+</span> G2_mean<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span> <span class="token comment">//新阈值</span>

	<span class="token comment">//迭代计算T</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>T2 <span class="token operator">-</span> T<span class="token punctuation">)</span> <span class="token operator">&gt;</span> T0<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">global_threshold_segmentation</span><span class="token punctuation">(</span>input_image<span class="token punctuation">,</span> output_image<span class="token punctuation">,</span> T0<span class="token punctuation">,</span> T2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword keyword-else">else</span>
	<span class="token punctuation">{</span>
		<span class="token function">threshold</span><span class="token punctuation">(</span>input_image<span class="token punctuation">,</span> output_image<span class="token punctuation">,</span> T2<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><h1 id="常用算法">常用算法 </h1>
<h2 id="1霍夫变换">1.霍夫变换 </h2>
<p>OpenCV霍夫直线检测函数使用</p>
<p>霍夫直线变换是一种用来在图像空间寻找直线的方法，输入图像要求是二值图像，同时为了提高检测直线的效率和准确率，</p>
<p>在使用霍夫线变换之前，最好对图像进行边缘检测生成边缘二值图像，这样的检测效果是最好的。</p>
<p>分别进行HoughLines和HoughLinesP函数检测直线。</p>
<p>总结：使用霍夫变换检测直线具体步骤：</p>
<p>1.彩色图像-&gt;灰度图</p>
<p>2.去噪（高斯核）</p>
<p>3.边缘提取（梯度算子、拉普拉斯算子、canny、sobel）</p>
<p>4.二值化（判断此处是否为边缘点，就看灰度值==255）</p>
<p>5.映射到霍夫空间（准备两个容器，一个用来展示hough-space概况，一个数组hough-space用来储存voting的值，因为投票过程往往有某个极大值超过阈值，多达几千，不能直接用灰度图来记录投票信息）</p>
<p>6.取局部极大值，设定阈值，过滤干扰直线</p>
<p>7.绘制直线、标定角点</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Program:霍夫直线检测示例 HoughLines：标准霍夫变换、多尺度霍夫变换  输出距离和直线角度</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string img_path<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_color<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_gray<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_binary<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_canny<span class="token punctuation">;</span>

    img_path <span class="token operator">=</span> <span class="token string">"img/hand.jpg"</span><span class="token punctuation">;</span>
    mat_color <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mat_gray <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 进行形态学闭运算，闭运算可以消除图像中的小洞，填补轮廓线中的断裂  </span>
    cv<span class="token double-colon punctuation">::</span>Mat elementRect<span class="token punctuation">;</span>
    <span class="token comment">// 创建一个3x3的矩形结构元素，锚点位于左上角(-1, -1)  </span>
    elementRect <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span>MORPH_RECT<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 对灰度图像进行形态学闭运算  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">morphologyEx</span><span class="token punctuation">(</span>mat_gray<span class="token punctuation">,</span> mat_gray<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>MORPH_CLOSE<span class="token punctuation">,</span> elementRect<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 对闭运算后的图像进行二值化处理，将灰度图像转换为二值图像  </span>
    <span class="token comment">// 阈值为125，任何灰度值高于此值的像素都变为255，其余变为0  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">threshold</span><span class="token punctuation">(</span>mat_gray<span class="token punctuation">,</span> mat_binary<span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用Canny算法检测二值图像中的边缘  </span>
    <span class="token comment">// 最小阈值为50，最大阈值为125，双阈值有助于检测更完整的边缘  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">Canny</span><span class="token punctuation">(</span>mat_binary<span class="token punctuation">,</span> mat_canny<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用霍夫线变换检测Canny边缘检测后的图像中的直线  </span>
    <span class="token comment">// 参数依次为：源图像、输出向量、距离分辨率、角度分辨率、阈值、最小线段长度、最大线段间隔  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>cv<span class="token double-colon punctuation">::</span>Vec2f<span class="token operator">&gt;</span> lines<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">HoughLines</span><span class="token punctuation">(</span>mat_canny<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CV_PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 遍历检测到的直线并在原图像上绘制它们  </span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"line number: "</span> <span class="token operator">&lt;&lt;</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 获取当前直线的参数  </span>
        cv<span class="token double-colon punctuation">::</span>Vec2f linex <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"radius: "</span> <span class="token operator">&lt;&lt;</span> linex<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", angle: "</span> <span class="token operator">&lt;&lt;</span> <span class="token number">180</span> <span class="token operator">/</span> CV_PI <span class="token operator">*</span> linex<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

        <span class="token comment">// 获取直线的极坐标参数  </span>
        <span class="token keyword keyword-float">float</span> rho <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> theta <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 计算直线在图像上的两个端点  </span>
        cv<span class="token double-colon punctuation">::</span>Point pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> a <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> x0 <span class="token operator">=</span> a <span class="token operator">*</span> rho<span class="token punctuation">,</span> y0 <span class="token operator">=</span> b <span class="token operator">*</span> rho<span class="token punctuation">;</span>
        pt1<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>x0 <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pt1<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>y0 <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pt2<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>x0 <span class="token operator">-</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pt2<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>y0 <span class="token operator">-</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 在彩色图像上绘制直线  </span>
        <span class="token function">line</span><span class="token punctuation">(</span>mat_color<span class="token punctuation">,</span> pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">,</span> mat_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> mat_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"binary"</span><span class="token punctuation">,</span> mat_binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"canny"</span><span class="token punctuation">,</span> mat_canny<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725254692578-21cbd060-8330-46a9-b430-ed4377e6a48d.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725254739781-49604fd8-5722-4815-a85b-c89a38b082ba.png" alt=""></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Program:霍夫P直线检测示例 HoughLinesP：渐进概率式霍夫变换   输出直线两个点坐标</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string img_path<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_color<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_gray<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_binary<span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>Mat mat_canny<span class="token punctuation">;</span>

    img_path <span class="token operator">=</span> <span class="token string">"img/hand.jpg"</span><span class="token punctuation">;</span>
    mat_color <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mat_gray <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">imread</span><span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 进行形态学闭运算，用于连接图像中的断裂部分和填充小洞  </span>
    cv<span class="token double-colon punctuation">::</span>Mat elementRect<span class="token punctuation">;</span>  
    <span class="token comment">// 创建一个3x3的矩形结构元素，其锚点位于中心位置(-1, -1)表示中心  </span>
    elementRect <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>cv<span class="token double-colon punctuation">::</span>MORPH_RECT<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">// 对灰度图像mat_gray进行形态学闭运算，结果仍然保存在mat_gray中  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">morphologyEx</span><span class="token punctuation">(</span>mat_gray<span class="token punctuation">,</span> mat_gray<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>MORPH_CLOSE<span class="token punctuation">,</span> elementRect<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token comment">// 对闭运算后的灰度图像进行二值化处理，使得灰度值大于或等于125的像素点变为白色(255)，其余为黑色(0)  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">threshold</span><span class="token punctuation">(</span>mat_gray<span class="token punctuation">,</span> mat_binary<span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>THRESH_BINARY<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token comment">// 使用Canny算法检测二值图像mat_binary中的边缘  </span>
    <span class="token comment">// 最小阈值为50，最大阈值为125，孔径大小为3  </span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">Canny</span><span class="token punctuation">(</span>mat_binary<span class="token punctuation">,</span> mat_canny<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token comment">// 使用霍夫概率直线变换（Probabilistic Hough Transform）检测Canny边缘检测后的图像中的直线  </span>
    <span class="token comment">// 参数依次为：源图像、输出向量、距离分辨率、角度分辨率、阈值、最小线段长度、最大线段间隔  </span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>cv<span class="token double-colon punctuation">::</span>Vec4i<span class="token operator">&gt;</span> lines<span class="token punctuation">;</span>  
    <span class="token function">HoughLinesP</span><span class="token punctuation">(</span>mat_canny<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CV_PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token comment">// 遍历检测到的直线，并在原图像mat_color上绘制它们  </span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span> 
         <span class="token comment">// 获取当前直线的四个整数坐标值（x1, y1, x2, y2）  </span>
         cv<span class="token double-colon punctuation">::</span>Vec4i<span class="token operator">&amp;</span> linex <span class="token operator">=</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>  
      
         <span class="token comment">// 计算直线的x和y方向上的差  </span>
         <span class="token keyword keyword-int">int</span> dx <span class="token operator">=</span> linex<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> linex<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
         <span class="token keyword keyword-int">int</span> dy <span class="token operator">=</span> linex<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> linex<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
      
         <span class="token comment">// 计算直线与x轴之间的角度（以度为单位）  </span>
         <span class="token keyword keyword-double">double</span> angle <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">(</span>dy<span class="token punctuation">)</span><span class="token punctuation">,</span> dx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span> CV_PI<span class="token punctuation">;</span>  
      
         <span class="token comment">// 注释掉的代码段用于过滤掉接近水平（角度绝对值小于等于20度）的直线  </span>
         <span class="token comment">// if (abs(angle) &lt;= 20)  </span>
         <span class="token comment">//     continue;  </span>
      
         <span class="token comment">// 在彩色图像mat_color上绘制直线  </span>
         <span class="token function">line</span><span class="token punctuation">(</span>mat_color<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>linex<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linex<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>linex<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linex<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"gray"</span><span class="token punctuation">,</span> mat_gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"binary"</span><span class="token punctuation">,</span> mat_binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"canny"</span><span class="token punctuation">,</span> mat_canny<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">,</span> mat_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725254931712-f7f99d4a-a3a8-4f1f-ab94-186c47841b1f.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725254972244-747640da-22ed-4b93-8bf5-fdccb597147a.png" alt=""></p>
<h2 id="2orb算法">2.ORB算法 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/highgui/highgui.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Mat img <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"A005.png"</span><span class="token punctuation">,</span> IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取图像并转换为灰度图像  </span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"无法加载图像"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 实例化 ORB 特征检测器  </span>
    Ptr<span class="token operator">&lt;</span>ORB<span class="token operator">&gt;</span> orb <span class="token operator">=</span> <span class="token class-name">ORB</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 检测关键点并计算描述符  </span>
    vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span> keypoints<span class="token punctuation">;</span>
    Mat descriptors<span class="token punctuation">;</span>
    orb<span class="token operator">-&gt;</span><span class="token function">detectAndCompute</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token function">noArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keypoints<span class="token punctuation">,</span> descriptors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Num of keypoints: "</span> <span class="token operator">&lt;&lt;</span> keypoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 500  </span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Shape of kp descriptors: "</span> <span class="token operator">&lt;&lt;</span> descriptors<span class="token punctuation">.</span>rows <span class="token operator">&lt;&lt;</span> <span class="token string">"x"</span> <span class="token operator">&lt;&lt;</span> descriptors<span class="token punctuation">.</span>cols <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// (500,32)  </span>

    <span class="token comment">// 调整图像亮度并绘制关键点位置  </span>
    Mat imgS<span class="token punctuation">;</span>
    <span class="token function">convertScaleAbs</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> imgS<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat imgKp1<span class="token punctuation">;</span>
    <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>imgS<span class="token punctuation">,</span> keypoints<span class="token punctuation">,</span> imgKp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 绘制关键点大小和方向  </span>
    Mat imgKp2<span class="token punctuation">;</span>
    <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>imgS<span class="token punctuation">,</span> keypoints<span class="token punctuation">,</span> imgKp2<span class="token punctuation">,</span> <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DrawMatchesFlags<span class="token double-colon punctuation">::</span>DRAW_RICH_KEYPOINTS<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"ORB Keypoints"</span><span class="token punctuation">,</span> WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"ORB Keypoints Scaled"</span><span class="token punctuation">,</span> WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Original Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示原始图像  </span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"ORB Keypoints"</span><span class="token punctuation">,</span> imgKp1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示只绘制关键点位置的图像  </span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"ORB Keypoints Scaled"</span><span class="token punctuation">,</span> imgKp2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示绘制关键点大小和方向的图像  </span>

    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待按键事件  </span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725255233388-874151d5-8a53-47c5-a59d-42bcd03166ae.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725255254005-ced68ed1-0c83-41aa-9dbc-bcf83ef7fe18.png" alt=""></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725255272408-2b09f3d2-23c0-4b52-8e60-e2ef09c4a26a.png" alt=""></p>
<h2 id="3sift算法">3.SIFT算法 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取图像  </span>
    Mat image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"A005.png"</span><span class="token punctuation">,</span> IMREAD_GRAYSCALE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"无法加载图像"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建SIFT对象并进行特征检测  </span>
    Ptr<span class="token operator">&lt;</span>SIFT<span class="token operator">&gt;</span> sift <span class="token operator">=</span> <span class="token class-name">SIFT</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>KeyPoint<span class="token operator">&gt;</span> keypoints<span class="token punctuation">;</span>
    sift<span class="token operator">-&gt;</span><span class="token function">detect</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> keypoints<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 绘制关键点并显示图像  </span>
    Mat outputImage<span class="token punctuation">;</span>
    <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> keypoints<span class="token punctuation">,</span> outputImage<span class="token punctuation">,</span> <span class="token class-name">Scalar</span><span class="token double-colon punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DrawMatchesFlags<span class="token double-colon punctuation">::</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"SIFT特征检测结果"</span><span class="token punctuation">,</span> outputImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><img src="https://cdn.nlark.com/yuque/0/2024/png/39216292/1725255581600-a81ef024-90d5-4cb1-8bdc-17fe6946c6ed.png" alt=""></p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>