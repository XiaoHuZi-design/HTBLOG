<!DOCTYPE html><html><head>
      <title>Cartographer安装与运行</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\LingJiaXiaoHu\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="资料">资料 </h1>
<p>数据包保存方法：<a href="https://www.cnblogs.com/zhjblogs/p/16512501.html">ROS入门：保存和回放数据（bag文件的使用） - 北极星！ - 博客园</a></p>
<p>镜像下载：<a href="https://releases.ubuntu.com/18.04/">https://releases.ubuntu.com/18.04/</a></p>
<p><a href="https://developer.aliyun.com/mirror/?spm=a2c6h.265751.1364563.38.728e2621iHKW48">阿里巴巴开源镜像站-OPSX镜像站-阿里云开发者社区</a></p>
<p>鱼香Ros一键安装:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">wget</span> http://fishros.com/install <span class="token parameter variable">-O</span> fishros <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> fishros
</code></pre><p>**链接：**<a href="https://pan.baidu.com/s/1q9f5aNTfrbpFpwGCwD6E4A">https://pan.baidu.com/s/1q9f5aNTfrbpFpwGCwD6E4A</a></p>
<p>**提取码：**slam</p>
<p>vmware虚拟机双向复制粘贴：</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> open-vm-tools
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> open-vm-tools-desktop
<span class="token function">sudo</span> <span class="token function">reboot</span>
</code></pre><p>ubantu如果没网络图标或网络：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>显示 NetworkManager 的整体状态，包括网络是否已启用:
nmcli general status
</code></pre><pre data-role="codeBlock" data-info="" class="language-text"><code>启用网络：
sudo nmcli networking on 图标出现网络连接成功
禁用网络：
sudo nmcli networking off
</code></pre><h1 id="安装cartographer">安装cartographer </h1>
<p>系统环境 ubantu18.04</p>
<p><em>提前安装好ros</em></p>
<p>第一步，首先下载安装包，解压放到合适位置，</p>
<p><img src="assets/cartography%E5%AE%89%E8%A3%85%E5%8C%85.png" alt="image-20241223201724205"></p>
<p>第二步，右键打开终端运行下列命令安装依赖，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~/cartographer_install$ ll
总用量 <span class="token number">28</span>
drwxrwxr-x  <span class="token number">6</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">6</span>月  <span class="token number">13</span>  <span class="token number">2021</span> ./
drwxr-xr-x <span class="token number">16</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">12</span>月 <span class="token number">23</span> <span class="token number">20</span>:06 <span class="token punctuation">..</span>/
drwxrwxr-x  <span class="token number">6</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">6</span>月  <span class="token number">13</span>  <span class="token number">2021</span> abseil-cpp/
-rwxrwxr-x  <span class="token number">1</span> ht_llibra ht_llibra <span class="token number">1395</span> <span class="token number">6</span>月  <span class="token number">13</span>  <span class="token number">2021</span> auto-carto-build.sh*
drwxrwxr-x <span class="token number">11</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">4</span>月  <span class="token number">21</span>  <span class="token number">2021</span> cartographer/
drwxrwxr-x <span class="token number">11</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">6</span>月  <span class="token number">13</span>  <span class="token number">2021</span> ceres-solver/
drwxrwxr-x <span class="token number">22</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">6</span>月   <span class="token number">7</span>  <span class="token number">2021</span> protobuf/
ht_llibra@ht-llibra:~/cartographer_install$ <span class="token function">chmod</span> +x auto-carto-build.sh
ht_llibra@ht-llibra:~/cartographer_install$ ./auto-carto-build.sh

</code></pre><pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~/cartographer_install$ ./auto-carto-build.sh
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> ht_llibra 的密码： 
正在读取软件包列表<span class="token punctuation">..</span>. 完成
正在分析软件包的依赖关系树       
正在读取状态信息<span class="token punctuation">..</span>. 完成       
lsb-release 已经是最新版 <span class="token punctuation">(</span><span class="token number">9</span>.20170808ubuntu1<span class="token punctuation">)</span>。
lsb-release 已设置为手动安装。
google-mock 已经是最新版 <span class="token punctuation">(</span><span class="token number">1.8</span>.0-6<span class="token punctuation">)</span>。
google-mock 已设置为手动安装。
libboost-all-dev 已经是最新版 <span class="token punctuation">(</span><span class="token number">1.65</span>.1.0ubuntu1<span class="token punctuation">)</span>。
libboost-all-dev 已设置为手动安装。
libeigen3-dev 已经是最新版 <span class="token punctuation">(</span><span class="token number">3.3</span>.4-4<span class="token punctuation">)</span>。
libeigen3-dev 已设置为手动安装。
cmake 已经是最新版 <span class="token punctuation">(</span><span class="token number">3.10</span>.2-1ubuntu2.18.04.2<span class="token punctuation">)</span>。
cmake 已设置为手动安装。
g++ 已经是最新版 <span class="token punctuation">(</span><span class="token number">4</span>:7.4.0-1ubuntu2.3<span class="token punctuation">)</span>。
g++ 已设置为手动安装。
libcairo2-dev 已经是最新版 <span class="token punctuation">(</span><span class="token number">1.15</span>.10-2ubuntu0.1<span class="token punctuation">)</span>。
libcairo2-dev 已设置为手动安装。
libcurl4-openssl-dev 已经是最新版 <span class="token punctuation">(</span><span class="token number">7.58</span>.0-2ubuntu3.24<span class="token punctuation">)</span>。
libcurl4-openssl-dev 已设置为手动安装。
python-rosdep 已经是最新版 <span class="token punctuation">(</span><span class="token number">0.23</span>.1-1<span class="token punctuation">)</span>。
将会同时安装下列软件：
  bzr clang-6.0 git-man lib32gcc1 lib32stdc++6 libamd2 libatlas3-base libbtf1
  libc6-i386 libcamd2 libccolamd2 libcholmod3 libclang-common-6.0-dev
  libclang1-6.0 libcxsparse3 liberror-perl libffi-dev libgflags2.2
  libgoogle-glog0v5 libgraphblas1 libklu1 libldl2 liblua5.2-0 libmetis5
  libncurses5 libncursesw5 libobjc-7-dev libobjc4 libomp-dev libomp5 librbio2
  libreadline-dev libserf-1-1 libspqr2 libsvn1 libtinfo-dev libtinfo5
  libtool-bin libumfpack5 llvm-6.0 llvm-6.0-dev llvm-6.0-runtime mercurial
  mercurial-common python-alabaster python-babel python-babel-localedata
  python-bzrlib python-certifi python-configobj python-crypto python-httplib2
  python-imagesize python-jinja2 python-keyring python-keyrings.alt
  python-launchpadlib python-lazr.restfulclient python-lazr.uri
  python-markupsafe python-oauth python-requests python-secretstorage
  python-simplejson python-typing python-urllib3 python-vcstools
  python-wadllib sphinx-common subversion
建议安装：
  bzr-doc bzrtools python-bzrlib.tests gnustep gnustep-devel clang-6.0-doc
  git-daemon-run <span class="token operator">|</span> git-daemon-sysvinit git-doc git-el git-email git-gui gitk
  gitweb git-cvs git-mediawiki git-svn libatlas-doc liblapack-doc libomp-doc
  readline-doc llvm-6.0-doc kdiff3 <span class="token operator">|</span> kdiff3-qt <span class="token operator">|</span> kompare <span class="token operator">|</span> meld <span class="token operator">|</span> tkcvs
  <span class="token operator">|</span> mgdiff qct python-mysqldb python-bzrlib-dbg python-kerberos python-pycurl
  python-configobj-doc python-crypto-doc python-jinja2-doc libkf5wallet-bin
  gir1.2-gnomekeyring-1.0 python-fs python-gdata python-keyczar
  python-testresources python-socks python-secretstorage-doc
  python-sphinx-rtd-theme libjs-mathjax dvipng texlive-latex-recommended
  texlive-latex-extra texlive-fonts-recommended texlive-generic-extra latexmk
  sphinx-doc python-ntlm doc-base db5.3-util libapache2-mod-svn
  subversion-tools
下列【新】软件包将被安装：
  bzr clang clang-6.0 <span class="token function">git</span> git-man lib32gcc1 lib32stdc++6 libamd2
  libatlas-base-dev libatlas3-base libbtf1 libc6-i386 libcamd2 libccolamd2
  libcholmod3 libclang-common-6.0-dev libclang1-6.0 libcxsparse3 liberror-perl
  libffi-dev libgflags-dev libgflags2.2 libgoogle-glog-dev libgoogle-glog0v5
  libgraphblas1 libklu1 libldl2 liblua5.2-0 liblua5.2-dev libmetis5
  libobjc-7-dev libobjc4 libomp-dev libomp5 librbio2 libreadline-dev
  libserf-1-1 libspqr2 libsuitesparse-dev libsvn1 libtinfo-dev libtool-bin
  libumfpack5 llvm-6.0 llvm-6.0-dev llvm-6.0-runtime mercurial
  mercurial-common ninja-build python-alabaster python-babel
  python-babel-localedata python-bzrlib python-certifi python-configobj
  python-crypto python-httplib2 python-imagesize python-jinja2 python-keyring
  python-keyrings.alt python-launchpadlib python-lazr.restfulclient
  python-lazr.uri python-markupsafe python-oauth python-requests
  python-secretstorage python-simplejson python-sphinx python-typing
  python-urllib3 python-vcstools python-wadllib python-wstool sphinx-common
  stow subversion
下列软件包将被升级：
  libncurses5 libncursesw5 libtinfo5
升级了 <span class="token number">3</span> 个软件包，新安装了 <span class="token number">78</span> 个软件包，要卸载 <span class="token number">0</span> 个软件包，有 <span class="token number">266</span> 个软件包未被升级。
需要下载 <span class="token number">79.1</span> MB/79.4 MB 的归档。
解压缩后会消耗 <span class="token number">470</span> MB 的额外空间。
您希望继续执行吗？ <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> 

</code></pre><p><img src="assets/error.png" alt="image-20241224141153933"></p>
<p><strong>没有报红，不出意外顺利安装！</strong> 这里出意外了... ...</p>
<p><img src="assets/image-20241223212023449.png" alt="image-20241223212023449"></p>
<p>下面看一下auto-carto-build.sh安装脚本，</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># Install the required libraries that are available as debs.</span>
<span class="token comment"># sudo apt-get update</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>
    clang <span class="token punctuation">\</span>
    cmake <span class="token punctuation">\</span>
    g++ <span class="token punctuation">\</span>
    <span class="token function">git</span> <span class="token punctuation">\</span>
    google-mock <span class="token punctuation">\</span>
    libboost-all-dev <span class="token punctuation">\</span>
    libcairo2-dev <span class="token punctuation">\</span>
    libcurl4-openssl-dev <span class="token punctuation">\</span>
    libeigen3-dev <span class="token punctuation">\</span>
    libgflags-dev <span class="token punctuation">\</span>
    libgoogle-glog-dev <span class="token punctuation">\</span>
    liblua5.2-dev <span class="token punctuation">\</span>
    libsuitesparse-dev <span class="token punctuation">\</span>
    lsb-release <span class="token punctuation">\</span>
    ninja-build <span class="token punctuation">\</span>
    stow <span class="token punctuation">\</span>
    python-wstool <span class="token punctuation">\</span>
    python-rosdep <span class="token punctuation">\</span>
	python-sphinx <span class="token punctuation">\</span>
	libatlas-base-dev



<span class="token comment"># Build and install abseil-cpp</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span> errexit
<span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span> verbose

<span class="token builtin class-name">cd</span> abseil-cpp
<span class="token function">git</span> checkout d902eb869bcfacc1bad14933ed9af4bed006d481
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token parameter variable">-G</span> Ninja <span class="token punctuation">\</span>
  <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release <span class="token punctuation">\</span>
  <span class="token parameter variable">-DCMAKE_POSITION_INDEPENDENT_CODE</span><span class="token operator">=</span>ON <span class="token punctuation">\</span>
  <span class="token parameter variable">-DCMAKE_INSTALL_PREFIX</span><span class="token operator">=</span>/usr/local/stow/absl <span class="token punctuation">\</span>
  <span class="token punctuation">..</span>
ninja
<span class="token function">sudo</span> ninja <span class="token function">install</span>
<span class="token builtin class-name">cd</span> /usr/local/stow
<span class="token function">sudo</span> stow absl


<span class="token comment"># Build and install Ceres.</span>
<span class="token builtin class-name">cd</span> -
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/ceres-solver
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> Ninja <span class="token parameter variable">-DCXX11</span><span class="token operator">=</span>ON
ninja
<span class="token comment">#CTEST_OUTPUT_ON_FAILURE=1 ninja test</span>
<span class="token function">sudo</span> ninja <span class="token function">install</span>


<span class="token comment"># Build and install proto3.</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/protobuf
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token parameter variable">-G</span> Ninja <span class="token punctuation">\</span>
  <span class="token parameter variable">-DCMAKE_POSITION_INDEPENDENT_CODE</span><span class="token operator">=</span>ON <span class="token punctuation">\</span>
  <span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release <span class="token punctuation">\</span>
  <span class="token parameter variable">-Dprotobuf_BUILD_TESTS</span><span class="token operator">=</span>OFF <span class="token punctuation">\</span>
  <span class="token punctuation">..</span>/cmake
ninja
<span class="token function">sudo</span> ninja <span class="token function">install</span>


<span class="token comment"># Build and install Cartographer.</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/cartographer
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span> <span class="token parameter variable">-G</span> Ninja
ninja
<span class="token comment">#CTEST_OUTPUT_ON_FAILURE=1 ninja test</span>
<span class="token function">sudo</span> ninja <span class="token function">install</span>

</code></pre><p><strong>下载cartographer注释后的源码</strong></p>
<p><a href="https://github.com/xiangli0608/cartographer_detailed_comments_ws">https://github.com/xiangli0608/cartographer_detailed_comments_ws</a></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~$ <span class="token function">mkdir</span> carto_ws
ht_llibra@ht-llibra:~$ <span class="token builtin class-name">cd</span> carto_ws/
ht_llibra@ht-llibra:~/carto_ws$ <span class="token function">git</span> clone https://github.com/xiangli0608/cartographer_detailed_comments_ws.git
正克隆到 <span class="token string">'cartographer_detailed_comments_ws'</span><span class="token punctuation">..</span>.
remote: Enumerating objects: <span class="token number">3041</span>, done.
remote: Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">1360</span>/1360<span class="token punctuation">)</span>, done.
remote: Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">250</span>/250<span class="token punctuation">)</span>, done.
remote: Total <span class="token number">3041</span> <span class="token punctuation">(</span>delta <span class="token number">1218</span><span class="token punctuation">)</span>, reused <span class="token number">1110</span> <span class="token punctuation">(</span>delta <span class="token number">1110</span><span class="token punctuation">)</span>, pack-reused <span class="token number">1681</span> <span class="token punctuation">(</span>from <span class="token number">1</span><span class="token punctuation">)</span>
接收对象中: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3041</span>/3041<span class="token punctuation">)</span>, <span class="token number">15.31</span> MiB <span class="token operator">|</span> <span class="token number">2.48</span> MiB/s, 完成.
处理 delta 中: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">2120</span>/2120<span class="token punctuation">)</span>, 完成.
ht_llibra@ht-llibra:~/carto_ws$ 

</code></pre><pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~/carto_ws$ <span class="token function">ls</span>
cartographer_detailed_comments_ws
ht_llibra@ht-llibra:~/carto_ws$ <span class="token builtin class-name">cd</span> cartographer_detailed_comments_ws/
ht_llibra@ht-llibra:~/carto_ws/cartographer_detailed_comments_ws$ <span class="token function">ls</span>
catkin_make.sh     finish_slam_3d.sh  rm_build.sh
finish_slam_2d.sh  README.md          src
ht_llibra@ht-llibra:~/carto_ws/cartographer_detailed_comments_ws$ ll
总用量 <span class="token number">48</span>
drwxrwxr-x <span class="token number">5</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 ./
drwxrwxr-x <span class="token number">3</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 <span class="token punctuation">..</span>/
-rwxrwxr-x <span class="token number">1</span> ht_llibra ht_llibra  <span class="token number">174</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 catkin_make.sh*
-rw-rw-r-- <span class="token number">1</span> ht_llibra ht_llibra   <span class="token number">98</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 .catkin_workspace
-rwxrwxr-x <span class="token number">1</span> ht_llibra ht_llibra  <span class="token number">567</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 finish_slam_2d.sh*
-rwxrwxr-x <span class="token number">1</span> ht_llibra ht_llibra  <span class="token number">406</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 finish_slam_3d.sh*
drwxrwxr-x <span class="token number">8</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 .git/
-rw-rw-r-- <span class="token number">1</span> ht_llibra ht_llibra   <span class="token number">85</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 .gitignore
-rw-rw-r-- <span class="token number">1</span> ht_llibra ht_llibra <span class="token number">3832</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 README.md
-rwxrwxr-x <span class="token number">1</span> ht_llibra ht_llibra   <span class="token number">67</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 rm_build.sh*
drwxrwxr-x <span class="token number">4</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 src/
drwxrwxr-x <span class="token number">2</span> ht_llibra ht_llibra <span class="token number">4096</span> <span class="token number">12</span>月 <span class="token number">24</span> <span class="token number">10</span>:14 .vscode/
ht_llibra@ht-llibra:~/carto_ws/cartographer_detailed_comments_ws$ 

</code></pre><p><strong>下面编译</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~/carto_ws/cartographer_detailed_comments_ws$ ./catkin_make.sh
</code></pre><p><strong>报错！</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>CMake Error at CMakeLists.txt:39 (find_package):
  By not providing "FindCeres.cmake" in CMAKE_MODULE_PATH this project has
  asked CMake to find a package configuration file provided by "Ceres", but
  CMake did not find one.

  Could not find a package configuration file provided by "Ceres" with any of
  the following names:

    CeresConfig.cmake
    ceres-config.cmake

  Add the installation prefix of "Ceres" to CMAKE_PREFIX_PATH or set
  "Ceres_DIR" to a directory containing one of the above files.  If "Ceres"
  provides a separate development package or SDK, be sure it has been
  installed.


-- Configuring incomplete, errors occurred!
See also "/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/build_isolated/cartographer/install/CMakeFiles/CMakeOutput.log".
See also "/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/build_isolated/cartographer/install/CMakeFiles/CMakeError.log".
&lt;== Failed to process package 'cartographer': 
  Command '['cmake', '/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/src/cartographer', '-DCMAKE_INSTALL_PREFIX=/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated', '-G', 'Ninja']' returned non-zero exit status 1

Reproduce this error by running:
==&gt; cd /home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/build_isolated/cartographer &amp;&amp; cmake /home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/src/cartographer -DCMAKE_INSTALL_PREFIX=/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated -G Ninja

Command failed, exiting.
./catkin_make.sh: 行 8: install_isolated/setup.bash: 没有那个文件或目录
ht_llibra@ht-llibra:~/carto_ws/cartographer_detailed_comments_ws$ 

</code></pre><p>可能是前面依赖项没安装好... ...</p>
<p>没解决好，可能是虚拟机的问题！</p>
<hr>
<p><strong>其他方法可用</strong></p>
<p>下图为之前在另一个虚拟机ubantu20.04，用的另一种教程编译的，可以用</p>
<p><img src="assets/image-20241224112258022.png" alt="image-20241224112258022"></p>
<p><img src="assets/image-20241224112454630.png" alt="image-20241224112454630"></p>
<p>另外鱼香ROS也可以一键安装cartographer，ubantu20.04双系统尝试可用</p>
<hr>
<p>鱼香一键也报错，不知道啥原因...</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Run CMD Task:<span class="token punctuation">[</span>catkin_make_isolated <span class="token parameter variable">--install</span> --use-ninja<span class="token punctuation">]</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span>.00s<span class="token punctuation">]</span> CMD Result:code:127                                              

Run CMD Task:<span class="token punctuation">[</span>sudo <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> cartographer_ws<span class="token punctuation">]</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span>.00s<span class="token punctuation">]</span> CMD Result:success                                               

欢迎加入机器人学习交流QQ群：438144612<span class="token punctuation">(</span>入群口令：一键安装<span class="token punctuation">)</span>
鱼香小铺正式开业，最低499可入手一台能建图会导航的移动机器人，淘宝搜店：鱼香ROS 或打开链接查看：https://item.taobao.com/item.htm?id<span class="token operator">=</span><span class="token number">696573635888</span>
如在使用过程中遇到问题，请打开：https://fishros.org.cn/forum 进行反馈

检测到本次运行出现失败命令,直接退出按Ctrl+C,按任意键上传日志并退出
^Cbash: /home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/setup.bash: 没有那个文件或目录

</code></pre><p>工作空间检查依赖</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>rosdepc init
rosdepc update
rosdepc <span class="token function">install</span> --from-paths src <span class="token parameter variable">-y</span> --ignore-src
</code></pre><hr>
<p><strong>找到原因了</strong>，</p>
<p>我整个电脑只有10个内核，虚拟机我设置了8个，然后编译默认用满，所以虚拟机直接崩了。</p>
<p>需要改小点，改成4线程就可以</p>
<p><img src="assets/%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B.png" alt="image-20241224145312074"></p>
<p><img src="assets/image-20241224145654757.png" alt="image-20241224145654757"></p>
<p>从源头解决问题，咱用的虚拟机，重新设置一下，</p>
<p><img src="assets/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BA%BF%E7%A8%8B%E8%AE%BE%E7%BD%AE.png" alt="image-20241224151320970"></p>
<hr>
<p>注：有点玄学，我在另一台电脑上也出现，但是改了线程不行，然后先鱼香一键（虽然失败）然后再次./catkin_make.sh编译却成功。</p>
<p><strong>编译源码的方式使用carto</strong></p>
<p>首先在carto_ws下新建工作空间</p>
<p><img src="assets/image-20241224150332973.png" alt="image-20241224150332973"></p>
<p>然后把cartographer_detailed_comments_ws里的cartographer_ros文件夹复制到src目录，</p>
<p><img src="assets/image-20241224150450684.png" alt="image-20241224150450684"></p>
<p>在工作空间编译一下，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>catkin_make
</code></pre><p><img src="assets/image-20241224151838035.png" alt="image-20241224151838035"></p>
<p>编译成功。</p>
<hr>
<h1 id="运行cartographer">运行cartographer </h1>
<p>设置全局环境变量，避免每次都source，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token builtin class-name">source</span> ~/carto_ws/cartographer_detailed_comments_ws/install_isolated/setup.bash
</code></pre><p>下载数据集</p>
<p><img src="assets/%E6%95%B0%E6%8D%AE%E9%9B%86.png" alt="image-20241224152143988"></p>
<p>将三个数据集解压放于下图位置，</p>
<p><img src="assets/image-20241224153010196.png" alt="image-20241224153010196"></p>
<h3 id="二维建图"><strong>二维建图</strong> </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token builtin class-name">source</span> install_isolated/setup.bash
rospack profile //执行这个是为了避免找不到launch
roslaunch cartographer_ros lx_rs16_2d_outdoor.launch
</code></pre><p><img src="assets/rospack_profile.png" alt="image-20241224153425255"></p>
<p><img src="assets/%E6%95%B0%E6%8D%AE%E5%8C%851.png" alt="image-20241224154635215"></p>
<p>这里两个红色报错是正常的，不影响，和每个人的电脑配置有关，</p>
<p><img src="assets/image-20241224185001913.png" alt="image-20241224185001913"></p>
<p>整个地图由这些子图叠加而成。</p>
<p>lx_rs16_2d_outdoor.launch代码：</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code>注意xml网页显示，需要把 尖括号 改成 <span class="token entity named-entity" title="<">&amp;lt;</span>和<span class="token entity named-entity" title=">">&amp;gt;</span>
</code></pre><pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token entity named-entity" title="<">&amp;lt;</span>launch<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- bag的地址与名称 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>arg name="bag_filename" default="$(env HOME)/bagfiles/rslidar-outdoor-gps-notf.bag"/<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 使用bag的时间戳 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>param name="/use_sim_time" value="true" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动cartographer --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="cartographer_node" pkg="cartographer_ros"
      type="cartographer_node" args="
          -configuration_directory $(find cartographer_ros)/configuration_files
          -configuration_basename lx_rs16_2d_outdoor.lua"
      output="screen"<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="points2" to="rslidar_points" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="scan" to="front_scan" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="odom" to="odom_scout" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="imu" to="imu" /<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>/node<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 生成ros格式的地图 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="cartographer_occupancy_grid_node" pkg="cartographer_ros"
      type="cartographer_occupancy_grid_node" args="-resolution 0.05" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动rviz --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="rviz" pkg="rviz" type="rviz" required="true"
      args="-d $(find cartographer_ros)/configuration_files/lx_2d.rviz" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动rosbag --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="playbag" pkg="rosbag" type="play"
      args="--clock $(arg bag_filename)" /<span class="token entity named-entity" title=">">&amp;gt;</span>
<span class="token entity named-entity" title="<">&amp;lt;</span>/launch<span class="token entity named-entity" title=">">&amp;gt;</span>
</code></pre><p><strong>安装vscode开发环境</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>ht_llibra@ht-llibra:~/下载$ sudo dpkg -i code_1.96.2-1734607745_amd64.deb
[sudo] ht_llibra 的密码： 
正在选中未选择的软件包 code。
(正在读取数据库 ... 系统当前共安装有 255918 个文件和目录。)
正准备解包 code_1.96.2-1734607745_amd64.deb  ...
正在解包 code (1.96.2-1734607745) ...
dpkg: 依赖关系问题使得 code 的配置工作不能继续：
 code 依赖于 libc6 (&gt;= 2.28)；然而：
系统中 libc6:amd64 的版本为 2.27-3ubuntu1.6。
 code 依赖于 libxkbfile1 (&gt;= 1:1.1.0)；然而：
系统中 libxkbfile1:amd64 的版本为 1:1.0.9-2。

dpkg: 处理软件包 code (--install)时出错：
 依赖关系问题 - 仍未被配置
正在处理用于 gnome-menus (3.13.3-11ubuntu1.1) 的触发器 ...
正在处理用于 desktop-file-utils (0.23-1ubuntu3.18.04.2) 的触发器 ...
正在处理用于 mime-support (3.60ubuntu1) 的触发器 ...
正在处理用于 shared-mime-info (1.9-2) 的触发器 ...
在处理时有错误发生：
 code
ht_llibra@ht-llibra:~/下载$ 
</code></pre><p>大概版本太高了。</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~/下载$ <span class="token function">sudo</span> dpkg <span class="token parameter variable">-i</span> code_1.75.1-1675893397_amd64.deb
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> ht_llibra 的密码： 
dpkg: 警告: 即将把 code 从 <span class="token number">1.86</span>.2-1707854558 降级到 <span class="token number">1.75</span>.1-1675893397
<span class="token punctuation">(</span>正在读取数据库 <span class="token punctuation">..</span>. 系统当前共安装有 <span class="token number">257363</span> 个文件和目录。<span class="token punctuation">)</span>
正准备解包 code_1.75.1-1675893397_amd64.deb  <span class="token punctuation">..</span>.
正在将 code <span class="token punctuation">(</span><span class="token number">1.75</span>.1-1675893397<span class="token punctuation">)</span> 解包到 <span class="token punctuation">(</span><span class="token number">1.86</span>.2-1707854558<span class="token punctuation">)</span> 上 <span class="token punctuation">..</span>.
正在设置 code <span class="token punctuation">(</span><span class="token number">1.75</span>.1-1675893397<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
gpg: WARNING: unsafe ownership on homedir <span class="token string">'/home/ht_llibra/.gnupg'</span>
正在处理用于 gnome-menus <span class="token punctuation">(</span><span class="token number">3.13</span>.3-11ubuntu1.1<span class="token punctuation">)</span> 的触发器 <span class="token punctuation">..</span>.
正在处理用于 desktop-file-utils <span class="token punctuation">(</span><span class="token number">0.23</span>-1ubuntu3.18.04.2<span class="token punctuation">)</span> 的触发器 <span class="token punctuation">..</span>.
正在处理用于 mime-support <span class="token punctuation">(</span><span class="token number">3</span>.60ubuntu1<span class="token punctuation">)</span> 的触发器 <span class="token punctuation">..</span>.
正在处理用于 shared-mime-info <span class="token punctuation">(</span><span class="token number">1.9</span>-2<span class="token punctuation">)</span> 的触发器 <span class="token punctuation">..</span>.
ht_llibra@ht-llibra:~/下载$ 
</code></pre><p><img src="assets/image-20241224172411993.png" alt="image-20241224172411993"></p>
<p>安装成功。</p>
<p><strong>建好地图后保存</strong>，</p>
<p>先安装一下地图服务，</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>sudo apt-get install ros-melodic-map-server
</code></pre><p>再执行命令，</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>rosrun map_server map_saver
</code></pre><p>默认保存在当前目录。</p>
<p><img src="assets/image-20241224174056993.png" alt="image-20241224174056993"></p>
<p><img src="assets/%E6%95%B0%E6%8D%AE%E5%8C%851%E5%9C%B0%E5%9B%BE.png" alt="image-20241224173938281"></p>
<p><img src="assets/image-20241224174146899.png" alt="image-20241224174146899"></p>
<p>另一种方法，执行finish_slam_2d.sh脚本，</p>
<p><img src="assets/image-20241224174355480.png" alt="image-20241224174355480"></p>
<pre data-role="codeBlock" data-info="sh" class="language-bash sh"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">source</span> install_isolated/setup.bash

<span class="token assign-left variable">map_dir</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${<span class="token environment constant">HOME</span>}</span>/carto_ws/map"</span>  <span class="token comment"># 文件保存路径</span>
<span class="token assign-left variable">map_name</span><span class="token operator">=</span><span class="token string">"2d-1"</span>   

<span class="token comment"># 检查文件夹是否存在, 如果不存在就创建文件夹</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$map_dir</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword keyword-then">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"文件夹不存在, 正在创建文件夹"</span>
  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$map_dir</span>
<span class="token keyword keyword-fi">fi</span>


<span class="token comment"># finish slam</span>
rosservice call /finish_trajectory <span class="token number">0</span>

<span class="token comment"># make pbstream     生成2d-1.pbstream</span>
rosservice call /write_state <span class="token string">"{filename: '<span class="token variable">$map_dir</span>/<span class="token variable">$map_name</span>.pbstream'}"</span>

<span class="token comment"># pbstream to map   生成2d-1.pgm和2d-1.yaml</span>
rosrun cartographer_ros cartographer_pbstream_to_ros_map <span class="token punctuation">\</span>
<span class="token parameter variable">-pbstream_filename</span><span class="token operator">=</span><span class="token variable">$map_dir</span>/<span class="token variable">$map_name</span>.pbstream <span class="token punctuation">\</span>
<span class="token parameter variable">-map_filestem</span><span class="token operator">=</span><span class="token variable">$map_dir</span>/<span class="token variable">$map_name</span>
</code></pre><p><img src="assets/image-20241224175102107.png" alt="image-20241224175102107"></p>
<p><img src="assets/image-20241224175155202.png" alt="image-20241224175155202"></p>
<p><img src="assets/image-20241224184414614.png" alt="image-20241224184414614"></p>
<h3 id="纯定位模式"><strong>纯定位模式</strong> </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code> roslaunch cartographer_ros lx_rs16_2d_outdoor_localization.launch 
</code></pre><p><img src="assets/%E7%BA%AF%E5%AE%9A%E4%BD%8D%E6%A8%A1%E5%BC%8F.png" alt="image-20241224190410622"></p>
<p>这时候已经有了第一次建图的一个轨迹和地图</p>
<p>lx_rs16_2d_outdoor_localization.launch文件：</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token entity named-entity" title="<">&amp;lt;</span>launch<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- bag的地址与名称 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>arg name="bag_filename" default="$(env HOME)/bagfiles/rslidar-outdoor-gps-notf.bag"/<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- pbstream的地址与名称 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>arg name="load_state_filename" default="$(env HOME)/carto_ws/map/2d-1.pbstream"/<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 使用bag的时间戳 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>param name="/use_sim_time" value="true" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动cartographer --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="cartographer_node" pkg="cartographer_ros"
      type="cartographer_node" args="
          -configuration_directory $(find cartographer_ros)/configuration_files
          -configuration_basename lx_rs16_2d_outdoor_localization.lua
          -load_state_filename $(arg load_state_filename)"
      output="screen"<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="points2" to="rslidar_points" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="scan" to="front_scan" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="odom" to="odom_scout" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="imu" to="imu" /<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>/node<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动map_server --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="map_server" pkg="map_server" type="map_server"
      args="$(env HOME)/carto_ws/map/2d-1.yaml" /<span class="token entity named-entity" title=">">&amp;gt;</span> 
  --<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动rviz --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="rviz" pkg="rviz" type="rviz" required="true"
      args="-d $(find cartographer_ros)/configuration_files/demo_2d.rviz" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动rosbag --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="playbag" pkg="rosbag" type="play"
      args="--clock $(arg bag_filename)" /<span class="token entity named-entity" title=">">&amp;gt;</span>
<span class="token entity named-entity" title="<">&amp;lt;</span>/launch<span class="token entity named-entity" title=">">&amp;gt;</span>
</code></pre><p>在进行纯定位时，没有启动这样一个代码，就是没有生成map这个topic的地图，</p>
<p><img src="assets/%E5%AD%90%E5%9B%BE.png" alt="image-20241224191856343"></p>
<p>区别：<img src="assets/2d%E5%BB%BA%E5%9B%BE%E5%92%8C%E7%BA%AF%E5%AE%9A%E4%BD%8D.png" alt="image-20241224192527591"></p>
<p>由于纯定位模式，默认配置是只保存三个子图啊，所以在这儿就最多只有三个子图，</p>
<p><img src="assets/%E7%BA%AF%E5%AE%9A%E4%BD%8D%E9%BB%98%E8%AE%A4%E5%AD%90%E5%9B%BE.png" alt="image-20241224194152116"></p>
<p>（不知道为啥我跑的在3个四个反复跳）</p>
<p><img src="assets/%E7%BA%AF%E5%AE%9A%E4%BD%8D%E5%AD%90%E5%9B%BE%E9%85%8D%E7%BD%AE.png" alt="image-20241224195233333"></p>
<p>然后我们看一下，通过rose topic list来可以获取到所有的topic的名字。</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~$ rostopic list
/clicked_point
/clock
/constraint_list
/imu
/initialpose
/landmark_poses_list
/move_base_simple/goal
/rosout
/rosout_agg
/rslidar_points
/scan_matched_points2
/submap_list
/tf
/tf_static
/trajectory_node_list
</code></pre><p>可以发现没有map这个话题。</p>
<p><strong>为什么纯定位模式，没有去起这么一个节点呢？</strong></p>
<p><em>由于一个历史原因，之前起了这个节点之后，很多人说在进行纯定位定位的时候，这个地图总是在变化的，这一变化则在进行导航时肯定会有问题，所以怎么不让地图发送变化呢？</em></p>
<p>就是不起这个cartographer_occupancy_grid_node节点。</p>
<p>那如果想导航那该怎么办呢？把map_server这段<strong>注释打开</strong>，</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动map_server --<span class="token entity named-entity" title=">">&amp;gt;</span>
<span class="token entity named-entity" title="<">&amp;lt;</span>!-- 
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="map_server" pkg="map_server" type="map_server"
      args="$(env HOME)/carto_ws/map/2d-1.yaml" /<span class="token entity named-entity" title=">">&amp;gt;</span> 
--<span class="token entity named-entity" title=">">&amp;gt;</span>
</code></pre><p>由于改了launch文件，这里需要编译一下，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~$ <span class="token builtin class-name">cd</span> carto_ws/cartographer_detailed_comments_ws/
ht_llibra@ht-llibra:~/carto_ws/cartographer_detailed_comments_ws$ ./catkin_make.sh 
</code></pre><p>这时候再执行纯定位的launch，然后rostopic list发现就有/map话题了，</p>
<p><img src="assets/image-20241224200024055.png" alt="image-20241224200024055"></p>
<p>看一下/map这个topic是谁发的，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ht_llibra@ht-llibra:~$ rostopic info /map
Type: nav_msgs/OccupancyGrid

Publishers: 
 * /map_server <span class="token punctuation">(</span>http://ht-llibra:42401/<span class="token punctuation">)</span>

Subscribers: None

</code></pre><p>可以看到是map_server发的，</p>
<p>这有什么区别呢? 接下来咱把Submaps给关掉，添加一个显示地图的插件，添加一下/map这个topic，</p>
<p><img src="assets/image-20241224200645328.png" alt="image-20241224200645328"></p>
<p>Alpha改为1会更白一些，可以发现这回地图是没有变化的，</p>
<p><img src="assets/%E7%BA%AF%E5%AE%9A%E4%BD%8Dmap%E8%AF%9D%E9%A2%98.png" alt="image-20241224201015872"></p>
<p>这个时候我们把Map取消，定义Submaps，会发现Submaps还是变化的（我的是没变化的，但看的视频在变换...）。</p>
<h3 id="三维建图"><strong>三维建图</strong> </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>roslaunch cartographer_ros lx_rs16_3d.launch
</code></pre><p>不知道为啥报错！大概是内存越界或缓冲区溢出或者rviz版本问题...虚拟机还是不太行!</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code> ht_llibra@ht-llibra:~$ roslaunch cartographer_ros lx_rs16_3d.launch
<span class="token punctuation">..</span>. logging to /home/ht_llibra/.ros/log/8723e8b8-c1f1-11ef-aa04-000c29a9653a/roslaunch-ht-llibra-21351.log
Checking log directory <span class="token keyword keyword-for">for</span> disk usage. This may take a while.
Press Ctrl-C to interrupt
Done checking log <span class="token function">file</span> disk usage. Usage is <span class="token operator">&lt;</span>1GB.

started roslaunch server http://ht-llibra:32869/

SUMMARY
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

PARAMETERS
 * /rosdistro: melodic
 * /rosversion: <span class="token number">1.14</span>.13
 * /use_sim_time: True

NODES
  /
    cartographer_node <span class="token punctuation">(</span>cartographer_ros/cartographer_node<span class="token punctuation">)</span>
    playbag <span class="token punctuation">(</span>rosbag/play<span class="token punctuation">)</span>
    rviz <span class="token punctuation">(</span>rviz/rviz<span class="token punctuation">)</span>

auto-starting new master
process<span class="token punctuation">[</span>master<span class="token punctuation">]</span>: started with pid <span class="token punctuation">[</span><span class="token number">21361</span><span class="token punctuation">]</span>
<span class="token assign-left variable">ROS_MASTER_URI</span><span class="token operator">=</span>http://localhost:11311

setting /run_id to 8723e8b8-c1f1-11ef-aa04-000c29a9653a
process<span class="token punctuation">[</span>rosout-1<span class="token punctuation">]</span>: started with pid <span class="token punctuation">[</span><span class="token number">21372</span><span class="token punctuation">]</span>
started core <span class="token function">service</span> <span class="token punctuation">[</span>/rosout<span class="token punctuation">]</span>
process<span class="token punctuation">[</span>cartographer_node-2<span class="token punctuation">]</span>: started with pid <span class="token punctuation">[</span><span class="token number">21375</span><span class="token punctuation">]</span>
process<span class="token punctuation">[</span>rviz-3<span class="token punctuation">]</span>: started with pid <span class="token punctuation">[</span><span class="token number">21376</span><span class="token punctuation">]</span>
process<span class="token punctuation">[</span>playbag-4<span class="token punctuation">]</span>: started with pid <span class="token punctuation">[</span><span class="token number">21377</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.615601133</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer_ros/configuration_files/lx_rs16_3d.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'lx_rs16_3d.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617167102</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/map_builder.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'map_builder.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617224705</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/map_builder.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'map_builder.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617282517</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/pose_graph.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'pose_graph.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617360503</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/pose_graph.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'pose_graph.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617586498</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/trajectory_builder.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'trajectory_builder.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617619361</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/trajectory_builder.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'trajectory_builder.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617722587</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/trajectory_builder_2d.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'trajectory_builder_2d.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617752077</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/trajectory_builder_2d.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'trajectory_builder_2d.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617928403</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/trajectory_builder_3d.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'trajectory_builder_3d.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.617960107</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> configuration_file_resolver.cc:53<span class="token punctuation">]</span> Found <span class="token string">'/home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer/configuration_files/trajectory_builder_3d.lua'</span> <span class="token keyword keyword-for">for</span> <span class="token string">'trajectory_builder_3d.lua'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.629688818</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> map_builder_bridge.cc:156<span class="token punctuation">]</span> Added trajectory with ID <span class="token string">'0'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.951415750</span>, <span class="token number">1606808649.538669897</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> ordered_multi_queue.cc:265<span class="token punctuation">]</span> All sensor data <span class="token keyword keyword-for">for</span> trajectory <span class="token number">0</span> is available starting at <span class="token string">'637424054495384530'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span> INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1735042857.973989186</span>, <span class="token number">1606808649.559946144</span><span class="token punctuation">]</span>: I1224 <span class="token number">20</span>:20:57.000000 <span class="token number">21375</span> pose_graph_3d.cc:136<span class="token punctuation">]</span> Inserted submap <span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">)</span>.
*** stack smashing detected ***: <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span> terminated
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>REQUIRED process <span class="token punctuation">[</span>rviz-3<span class="token punctuation">]</span> has died<span class="token operator">!</span>
process has died <span class="token punctuation">[</span>pid <span class="token number">21376</span>, <span class="token builtin class-name">exit</span> code -6, cmd /opt/ros/melodic/lib/rviz/rviz <span class="token parameter variable">-d</span> /home/ht_llibra/carto_ws/cartographer_detailed_comments_ws/install_isolated/share/cartographer_ros/configuration_files/lx_3d.rviz __name:<span class="token operator">=</span>rviz __log:<span class="token operator">=</span>/home/ht_llibra/.ros/log/8723e8b8-c1f1-11ef-aa04-000c29a9653a/rviz-3.log<span class="token punctuation">]</span>.
log file: /home/ht_llibra/.ros/log/8723e8b8-c1f1-11ef-aa04-000c29a9653a/rviz-3*.log
Initiating shutdown<span class="token operator">!</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">[</span>playbag-4<span class="token punctuation">]</span> killing on <span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>rviz-3<span class="token punctuation">]</span> killing on <span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>cartographer_node-2<span class="token punctuation">]</span> killing on <span class="token builtin class-name">exit</span>
F1224 <span class="token number">20</span>:21:01.074517 <span class="token number">21395</span> problem_impl.cc:635<span class="token punctuation">]</span> Parameter block not found: 0x7f34f4000e00. You must <span class="token function">add</span> the parameter block to the problem before you can <span class="token builtin class-name">set</span> a lower bound on one of its components.
*** Check failure stack trace: ***
    @     0x7f35331680cd  google::LogMessage::Fail<span class="token punctuation">(</span><span class="token punctuation">)</span>
    @     0x7f3533169f33  google::LogMessage::SendToLog<span class="token punctuation">(</span><span class="token punctuation">)</span>
    @     0x7f3533167c28  google::LogMessage::Flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
    @     0x7f353316a999  google::LogMessageFatal::~LogMessageFatal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    @     0x7f35334cc1bc  ceres::internal::ProblemImpl::SetParameterLowerBound<span class="token punctuation">(</span><span class="token punctuation">)</span>
    @     0x5620575a79d6  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x56205755b5a0  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x56205755c008  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x56205757f0d4  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x5620575f05e1  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x562057514f7c  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x7f3530af66df  <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>
    @     0x7f35323756db  start_thread
    @     0x7f35301b361f  clone
<span class="token punctuation">[</span>rosout-1<span class="token punctuation">]</span> killing on <span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>master<span class="token punctuation">]</span> killing on <span class="token builtin class-name">exit</span>
shutting down processing monitor<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>. shutting down processing monitor complete
<span class="token keyword keyword-done">done</span>

</code></pre><p><strong>！！！！！！！！！！！！！！！！！！！！！！！</strong></p>
<p>可显示实时三维点云地图（报错打不开暂时没实现），</p>
<p><img src="assets/%E6%88%AA%E5%9B%BE.png" alt="image-20241224203153138"></p>
<p>保存3D地图，执行工作空间里的finish_slam_3s.sh，</p>
<p><img src="assets/image-20241224203717459.png" alt="image-20241224203717459"></p>
<h3 id="2d栅格地图和3d点云地图">2d栅格地图和3d点云地图 </h3>
<p><img src="assets/image-20241224204631363.png" alt="image-20241224204631363"></p>
<p><strong>2D栅格地图</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>roslaunch cartographer_ros assets_writer_2d.launch
</code></pre><p><img src="assets/image-20241224204735173.png" alt="image-20241224204735173"></p>
<p>目的是根据与pbstream文件和之前的bag文件来再生成一个map.pgm的地图图片，会在map文件夹</p>
<p><img src="assets/image-20241224205020351.png" alt="image-20241224205020351"></p>
<p><img src="assets/image-20241224205334692.png" alt="image-20241224205334692"></p>
<p>可以看到最终生成的地图如上，由于是多线16线点云，还有打到地面上的点也一并生成了地图，所以这样这种方式生成的地图不可用。</p>
<p><strong>3d点云地图</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>roslaunch cartographer_ros assets_writer_3d.launch
</code></pre><p>由于前面3d建图rviz打开失败没有成功生成3d-1.pbstream文件，所以这里也用不了。</p>
<p>正常处理完后会生成b3-1.pcd，</p>
<p>可视化3D点云地图，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> pcl-tools
</code></pre><pre data-role="codeBlock" data-info="" class="language-text"><code>pcl_viewer b3_1.pcd
</code></pre><p><img src="assets/%E4%B8%B4%E6%97%B61.png" alt="image-20241224220041096"></p>
<p>按一下4，会自动按照不同的高度来进行着色，</p>
<p><img src="assets/%E4%B8%B4%E6%97%B62.png" alt="image-20241224220146126"></p>
<p>下面看看2d和3d的lua文件分别是怎么设置的，</p>
<p><img src="assets/2d3dlua.png" alt="image-20241224210658311"></p>
<h3 id="landmark使用示例">landmark使用示例 </h3>
<p><strong>执行一下landmarks_demo_uncalibrated.bag</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>roslaunch cartographer_ros landmark_mir_100.launch
</code></pre><p><img src="assets/landmarks1.png" alt="image-20241225133029784"></p>
<p><img src="assets/landmarks1%E6%94%BE%E5%A4%A7%E7%89%88.png" alt="image-20241225133218600"></p>
<p>在views栏（没有就点击panels--&gt;views）可以转换一下视角，可以看到一些小球，就是landmarks的一个可视化，</p>
<p><img src="assets/landmarks_view.png" alt="image-20241225133511764"></p>
<p>可以看到随着机器人的不断运动，小球的位置也是在发生变化的，新增的小球约束也发生了变化。</p>
<h1 id="如何配置launch与lua文件">如何配置Launch与Lua文件 </h1>
<h3 id="第一步-了解-bag-文件">第一步 了解 bag 文件 </h3>
<p>播放 bag 文件需要在 <strong>bag</strong> <strong>的文件夹内</strong>启动五个终端</p>
<p><em>• <strong>第一个</strong>终端执行 roscore</em></p>
<p><em>• <strong>第二个</strong>终端执行 rosbag info rslidar-outdoor-gps.bag了解 bag 中 topic 的名称与类型</em></p>
<p><em>• <strong>第三个</strong>执行 rosbag play rslidar-outdoor-gps.bag</em></p>
<p><em>• <strong>第四个</strong>终端执行 rqt，了解 bag 中的 tf 树</em></p>
<p><em>注意, rqt 的所有显示插件都在菜单栏的 plugins 内, 再点击 visualization, 再点击 tf</em></p>
<p><em>tree, 即可显示视频中的 tf 树的可视化界面.</em></p>
<p><em>• <strong>第五个</strong>终端执行 rviz</em></p>
<p><em>可视化雷达数据与 tf 数据.</em></p>
<p><em>rviz 左侧最顶上的 Fixed frame 除了下拉菜单可以选择之外, 还是<strong>可以手动输入的</strong>,</em></p>
<p><em>现在手动输入成 odom ,</em></p>
<p><em>rviz 左侧下方的 Add 按钮, 可以添加显示的插件, 自己选择添加 pointcloud2,</em></p>
<p><em>laserscan 等格式的数据, 之后把插件订阅的 topic 选择一下, 如果不会就自己摸索一下,</em></p>
<p><em>很简单的.</em></p>
<p><img src="assets/image-20241225140455767.png" alt="image-20241225140455767"></p>
<p><img src="assets/image-20241225140556264.png" alt="image-20241225140556264"></p>
<p>按空格停止播放，再按空格继续播放，停止后按s单步播放</p>
<p><img src="assets/image-20241225140959223.png" alt="image-20241225140959223"></p>
<p><img src="assets/image-20241225141206589.png" alt="image-20241225141206589"></p>
<p><img src="assets/image-20241225141900311.png" alt="image-20241225141900311"></p>
<p><img src="assets/image-20241225142235154.png" alt="image-20241225142235154"></p>
<p><img src="assets/image-20241225142448489.png" alt="image-20241225142448489"></p>
<p>可以看到odom和机器人的一个相对位置是在发生变化的，即odom指向footprint的一个tf是发生变化的，它就叫TF（transform），机器人上几个相对不变的就是静态TF。</p>
<p><img src="assets/6%E7%BA%BF%E7%82%B9%E4%BA%91%E6%95%B0%E6%8D%AE.png" alt="image-20241225144008928"></p>
<p><img src="assets/image-20241225144458743.png" alt="image-20241225144458743"></p>
<h3 id="第二步-配置-launch-文件">第二步 配置 launch 文件 </h3>
<p>launch 文件中需要如下几个设置</p>
<p>• bag 文件的地址与 bag 文件的名字</p>
<p>• lua 文件的名字</p>
<p>• topic 需要 remap 成 bag 文件中发布的 topic</p>
<p>新建一个test.launch文件，把之前的lx_rs16_2d_outdoor.launch复制一下，</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token entity named-entity" title="<">&amp;lt;</span>!--
  Copyright 2016 The Cartographer Authors

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0 

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--<span class="token entity named-entity" title=">">&amp;gt;</span>

<span class="token entity named-entity" title="<">&amp;lt;</span>launch<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- bag的地址与名称 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>arg name="bag_filename" default="$(env HOME)/bagfiles/rslidar-outdoor-gps-notf.bag"/<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 使用bag的时间戳 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>param name="/use_sim_time" value="true" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动cartographer --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="cartographer_node" pkg="cartographer_ros"
      type="cartographer_node" args="
          -configuration_directory $(find cartographer_ros)/configuration_files
          -configuration_basename lx_rs16_2d_outdoor.lua"
      output="screen"<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="points2" to="rslidar_points" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="scan" to="front_scan" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="odom" to="odom_scout" /<span class="token entity named-entity" title=">">&amp;gt;</span>
    <span class="token entity named-entity" title="<">&amp;lt;</span>remap from="imu" to="imu" /<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>/node<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 生成ros格式的地图 --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="cartographer_occupancy_grid_node" pkg="cartographer_ros"
      type="cartographer_occupancy_grid_node" args="-resolution 0.05" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动rviz --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="rviz" pkg="rviz" type="rviz" required="true"
      args="-d $(find cartographer_ros)/configuration_files/lx_2d.rviz" /<span class="token entity named-entity" title=">">&amp;gt;</span>

  <span class="token entity named-entity" title="<">&amp;lt;</span>!-- 启动rosbag --<span class="token entity named-entity" title=">">&amp;gt;</span>
  <span class="token entity named-entity" title="<">&amp;lt;</span>node name="playbag" pkg="rosbag" type="play"
      args="--clock $(arg bag_filename)" /<span class="token entity named-entity" title=">">&amp;gt;</span>
<span class="token entity named-entity" title="<">&amp;lt;</span>/launch<span class="token entity named-entity" title=">">&amp;gt;</span>

</code></pre><p>然后我们针对刚才做可视化的这样一个bag来做一下适配，</p>
<p><img src="assets/image-20241225152821406.png" alt="image-20241225152821406"></p>
<p>改一下这两个地方。</p>
<h3 id="第三步-配置-lua-文件">第三步 配置 lua 文件 </h3>
<p><img src="assets/lua%E9%85%8D%E7%BD%AE.png" alt="image-20241225153020997"></p>
<p>新建一个test.lua文件，从backpack.lua文件复制</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">-- Copyright 2016 The Cartographer Authors</span>
<span class="token comment">--</span>
<span class="token comment">-- Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="token comment">-- you may not use this file except in compliance with the License.</span>
<span class="token comment">-- You may obtain a copy of the License at</span>
<span class="token comment">--</span>
<span class="token comment">--      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">--</span>
<span class="token comment">-- Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment">-- distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token comment">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment">-- See the License for the specific language governing permissions and</span>
<span class="token comment">-- limitations under the License.</span>

include <span class="token string">"map_builder.lua"</span>
include <span class="token string">"trajectory_builder.lua"</span>

options <span class="token operator">=</span> <span class="token punctuation">{</span>
  map_builder <span class="token operator">=</span> MAP_BUILDER<span class="token punctuation">,</span>
  trajectory_builder <span class="token operator">=</span> TRAJECTORY_BUILDER<span class="token punctuation">,</span>
  map_frame <span class="token operator">=</span> <span class="token string">"map"</span><span class="token punctuation">,</span>
  tracking_frame <span class="token operator">=</span> <span class="token string">"base_link"</span><span class="token punctuation">,</span>
  published_frame <span class="token operator">=</span> <span class="token string">"base_link"</span><span class="token punctuation">,</span>
  odom_frame <span class="token operator">=</span> <span class="token string">"odom"</span><span class="token punctuation">,</span>
  provide_odom_frame <span class="token operator">=</span> <span class="token keyword keyword-true">true</span><span class="token punctuation">,</span>
  publish_frame_projected_to_2d <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
  use_pose_extrapolator <span class="token operator">=</span> <span class="token keyword keyword-true">true</span><span class="token punctuation">,</span>
  use_odometry <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
  use_nav_sat <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
  use_landmarks <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
  num_laser_scans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  num_multi_echo_laser_scans <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  num_subdivisions_per_laser_scan <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  num_point_clouds <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  lookup_transform_timeout_sec <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
  submap_publish_period_sec <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
  pose_publish_period_sec <span class="token operator">=</span> <span class="token number">5e-3</span><span class="token punctuation">,</span>
  trajectory_publish_period_sec <span class="token operator">=</span> <span class="token number">30e-3</span><span class="token punctuation">,</span>
  rangefinder_sampling_ratio <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">,</span>
  odometry_sampling_ratio <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">,</span>
  fixed_frame_pose_sampling_ratio <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">,</span>
  imu_sampling_ratio <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">,</span>
  landmarks_sampling_ratio <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

MAP_BUILDER<span class="token punctuation">.</span>use_trajectory_builder_2d <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
TRAJECTORY_BUILDER_2D<span class="token punctuation">.</span>num_accumulated_range_data <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword keyword-return">return</span> options

</code></pre><p>TF树最上面的一个是published_frame</p>
<p><img src="assets/image-20241225154435845.png" alt="image-20241225154435845"></p>
<p><img src="assets/image-20241225155106356.png" alt="image-20241225155106356"></p>
<p>​		多线点云会打到地面，如果你想这时候去建二维地图，但是你要使用这个全部的点云数据区建图呢，这个打到地面上的一圈一圈的点也会被建到地图里，这时候你就会发现地图上全是一圈一圈的印，那这个地图就没法使用，所以在你订阅多线点云数据的时候，这个值也要设置为大于0，那这里就出现一个矛盾：当你既有单线又有多线的时候，这个min_z就需要有一定的考量了，你是要地面，还是要单线，你要是想把地面过滤掉，你单线也会同时过滤掉。这里我们先把min_z设置为-0.1。</p>
<p>​		重新编译一下，</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code> roslaunch cartographer_ros test.launch 
</code></pre><p>​		可以发现终端一直有报错，但不影响建图，可能是既订阅了单线又订阅了多线的原因。</p>
<p>由于设置的min_z为-0.1，可以发现点云没有打在地上的或者说很少，因为这个雷达是装在高处的，这个z坐标是相对于雷达自身的，所以它这个点就会很少出现在这个雷达下面，</p>
<p><img src="assets/image-20241225164007763.png" alt="image-20241225164007763"></p>
<p><img src="assets/image-20241225164457396.png" alt="image-20241225164457396"></p>
<p>只用多线不用单线，min_z改为0.2，也就是0.2以下的都不要</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code>  num_laser_scans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  num_point_clouds <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
</code></pre><p>重新编译一下，再次运行，可以发现这次终端不报错，说明原因就是之前说的同时订阅了单线和多线的原因。</p>
<p><img src="assets/image-20241225165520408.png" alt="image-20241225165520408"></p>
<p><img src="assets/image-20241225170020778.png" alt="image-20241225170020778"></p>
<p>这个显示出来的点就是过滤掉的点，就是过滤之后的点会比之前高了。</p>
<h1 id="命令功能汇总">命令功能汇总 </h1>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment">##  运行相关命令</span>

其中的bag文件可以在我的公众号: 从零开始搭SLAM  里找到，在底部菜单栏的数据集链接里

<span class="token comment">### 2d建图指令</span>
<span class="token variable"><span class="token variable">`</span>roslaunch cartographer_ros lx_rs16_2d_outdoor.launch<span class="token variable">`</span></span>

<span class="token comment">### 保存2d轨迹,并生成ros格式的地图</span>
<span class="token variable"><span class="token variable">`</span>./finish_slam_2d.sh<span class="token variable">`</span></span>

<span class="token comment">### 纯定位模式</span>
<span class="token variable"><span class="token variable">`</span>roslaunch cartographer_ros lx_rs16_2d_outdoor_localization.launch<span class="token variable">`</span></span>

<span class="token comment">### 3d建图指令</span>
<span class="token variable"><span class="token variable">`</span>roslaunch cartographer_ros lx_rs16_3d.launch<span class="token variable">`</span></span>

<span class="token comment">### 保存3d轨迹</span>
<span class="token variable"><span class="token variable">`</span>./finish_slam_3d.sh<span class="token variable">`</span></span>

<span class="token comment">### 使用asset生成ros格式的2d栅格地图</span>
<span class="token variable"><span class="token variable">`</span>roslaunch cartographer_ros assets_writer_2d.launch<span class="token variable">`</span></span>

<span class="token comment">### 使用asset生成3d点云地图</span>
<span class="token variable"><span class="token variable">`</span>roslaunch cartographer_ros assets_writer_3d.launch<span class="token variable">`</span></span>

<span class="token comment">### landmark使用示例</span>
<span class="token variable"><span class="token variable">`</span>roslaunch cartographer_ros landmark_mir_100.launch<span class="token variable">`</span></span>


<span class="token comment">##  实时显示三维点云地图与保存地图的功能简述</span>
显示三维点云地图需要是在建3d轨迹的情况下才可以显示, 点云地图默认发布在 <span class="token variable"><span class="token variable">`</span>/point_cloud_map<span class="token variable">`</span></span> 话题中.

默认关闭了保存pcd格式点云的功能, 如需要这个功能, 需要将node.cc文件的第1029行的 <span class="token variable"><span class="token variable">`</span>constexpr bool save_pcd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token variable">`</span></span> 改成true.

编译之后在建图结束后通过调用 <span class="token variable"><span class="token variable">`</span>/write_state<span class="token variable">`</span></span> 服务, 会在生成pbstream文件的同时也对pcd文件进行保存, 保存目录与pbstream文件同一个文件夹.
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>